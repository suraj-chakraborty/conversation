!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).firebase)}(this,function(_g){"use strict";try{(function(){function t(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var l,e=t(_g);function s(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}(Ee=l=l||{})[Ee.DEBUG=0]="DEBUG",Ee[Ee.VERBOSE=1]="VERBOSE",Ee[Ee.INFO=2]="INFO",Ee[Ee.WARN=3]="WARN",Ee[Ee.ERROR=4]="ERROR",Ee[Ee.SILENT=5]="SILENT";function n(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=u[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,s(["["+i+"]  "+t.name+":"],n))}}var r={debug:l.DEBUG,verbose:l.VERBOSE,info:l.INFO,warn:l.WARN,error:l.ERROR,silent:l.SILENT},i=l.INFO,u=((_e={})[l.DEBUG]="log",_e[l.VERBOSE]="log",_e[l.INFO]="info",_e[l.WARN]="warn",_e[l.ERROR]="error",_e),o=(Object.defineProperty(a.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in l))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),a.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?r[t]:t},Object.defineProperty(a.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),a.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.DEBUG],t)),this._logHandler.apply(this,s([this,l.DEBUG],t))},a.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.VERBOSE],t)),this._logHandler.apply(this,s([this,l.VERBOSE],t))},a.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.INFO],t)),this._logHandler.apply(this,s([this,l.INFO],t))},a.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.WARN],t)),this._logHandler.apply(this,s([this,l.WARN],t))},a.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.ERROR],t)),this._logHandler.apply(this,s([this,l.ERROR],t))},a);function a(t){this.name=t,this._logLevel=i,this._logHandler=n,this._userLogHandler=null}var c=function(t,e){return(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function h(t,e){function n(){this.constructor=t}c(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function y(t,s,u,a){return new(u=u||Promise)(function(n,e){function r(t){try{o(a.next(t))}catch(t){e(t)}}function i(t){try{o(a.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof u?e:new u(function(t){t(e)})).then(r,i)}o((a=a.apply(t,s||[])).next())})}function v(n,r){var i,o,s,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,o=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){u.label=e[1];break}if(6===e[0]&&u.label<s[1]){u.label=s[1],s=e;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(e);break}s[2]&&u.ops.pop(),u.trys.pop();continue}e=r.call(n,u)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function f(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function p(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var d,g="FirebaseError",m=(h(w,d=Error),w);function w(t,e,n){e=d.call(this,e)||this;return e.code=t,e.customData=n,e.name=g,Object.setPrototypeOf(e,w.prototype),Error.captureStackTrace&&Error.captureStackTrace(e,b.prototype.create),e}var b=(I.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r,i=e[0]||{},o=this.service+"/"+t,t=this.errors[t],t=t?(r=i,t.replace(E,function(t,e){var n=r[e];return null!=n?String(n):"<"+e+"?>"})):"Error",t=this.serviceName+": "+t+" ("+o+").";return new m(o,t,i)},I);function I(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var E=/\{\$([^}]+)}/g,_=function(t,e){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function T(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var A,N="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},S={},O=N||self;function D(){}function x(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function k(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var P="closure_uid_"+(1e9*Math.random()>>>0),R=0;function L(t,e,n){return t.call.apply(t.bind,arguments)}function C(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function U(t,e,n){return(U=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?L:C).apply(null,arguments)}function V(e){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function M(){return Date.now()}function j(t,o){function e(){}e.prototype=o.prototype,t.X=o.prototype,t.prototype=new e,(t.prototype.constructor=t).Kb=function(t,e,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[e].apply(t,r)}}function F(){this.j=this.j,this.i=this.i}F.prototype.j=!1,F.prototype.ja=function(){var t;!this.j&&(this.j=!0,this.G(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,P)&&t[P]||(t[P]=++R))},F.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var q=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},B=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function G(){return Array.prototype.concat.apply([],arguments)}function z(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function H(t){return/^[\s\xa0]*$/.test(t)}var K,W=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Q(t,e){return-1!=t.indexOf(e)}function Y(t,e){return t<e?-1:e<t?1:0}t:{var J=O.navigator;if(J){J=J.userAgent;if(J){K=J;break t}}K=""}function X(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function $(t){var e,n={};for(e in t)n[e]=t[e];return n}var Z="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function tt(t){for(var e,n,r=1;r<arguments.length;r++){for(e in n=arguments[r])t[e]=n[e];for(var i=0;i<Z.length;i++)e=Z[i],Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}}function et(t){return et[" "](t),t}et[" "]=D;var nt,rt=Q(K,"Opera"),it=Q(K,"Trident")||Q(K,"MSIE"),ot=Q(K,"Edge"),st=ot||it,ut=Q(K,"Gecko")&&!(Q(K.toLowerCase(),"webkit")&&!Q(K,"Edge"))&&!(Q(K,"Trident")||Q(K,"MSIE"))&&!Q(K,"Edge"),at=Q(K.toLowerCase(),"webkit")&&!Q(K,"Edge");function ct(){var t=O.document;return t?t.documentMode:void 0}t:{var ht="",ft=(ft=K,ut?/rv:([^\);]+)(\)|;)/.exec(ft):ot?/Edge\/([\d\.]+)/.exec(ft):it?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(ft):at?/WebKit\/(\S+)/.exec(ft):rt?/(?:Version)[ \/]?(\S+)/.exec(ft):void 0);if(ft&&(ht=ft?ft[1]:""),it){ft=ct();if(null!=ft&&ft>parseFloat(ht)){nt=String(ft);break t}}nt=ht}var lt={};function pt(u){return t=u,e=function(){for(var t=0,e=W(String(nt)).split("."),n=W(String(u)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=Y(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||Y(0==o[2].length,0==s[2].length)||Y(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t},n=lt,Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t);var t,e,n}var dt=O.document&&it?ct()||(parseInt(nt,10)||void 0):void 0,yt=!it||9<=Number(dt),vt=it&&!pt("9"),gt=function(){if(!O.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{O.addEventListener("test",D,e),O.removeEventListener("test",D,e)}catch(t){}return t}();function mt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function wt(t,e){if(mt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(ut){t:{try{et(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:bt[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}mt.prototype.b=function(){this.defaultPrevented=!0},j(wt,mt);var bt={2:"touch",3:"pen",4:"mouse"};wt.prototype.b=function(){wt.X.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,vt)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var It="closure_listenable_"+(1e6*Math.random()|0),Et=0;function _t(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ca=i,this.key=++Et,this.Y=this.Z=!1}function Tt(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function At(t){this.src=t,this.a={},this.b=0}function Nt(t,e){var n,r,i,o=e.type;o in t.a&&(n=t.a[o],(i=0<=(r=q(n,e)))&&Array.prototype.splice.call(n,r,1),i&&(Tt(e),0==t.a[o].length&&(delete t.a[o],t.b--)))}function St(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Y&&o.listener==e&&o.capture==!!n&&o.ca==r)return i}return-1}At.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=St(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new _t(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Ot="closure_lm_"+(1e6*Math.random()|0),Dt={};function xt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}r=Mt(r);return e&&e[It]?e.wa(n,r,k(i)?!!i.capture:!!i,o):kt(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)xt(t,e[o],n,r,i);return null}return n=Mt(n),t&&t[It]?t.va(e,n,k(r)?!!r.capture:!!r,i):kt(t,e,n,!1,r,i)}function kt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=k(i)?!!i.capture:!!i;if(s&&!yt)return null;var u,a,c=Ut(t);if(c||(t[Ot]=c=new At(t)),(n=c.add(e,n,r,s,o)).proxy)return n;if(u=Ct,r=a=yt?function(t){return u.call(a.src,a.listener,t)}:function(t){if(!(t=u.call(a.src,a.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)gt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Rt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Pt(t){var e,n,r;"number"!=typeof t&&t&&!t.Y&&((e=t.src)&&e[It]?Nt(e.c,t):(n=t.type,r=t.proxy,e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Rt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ut(e))?(Nt(n,t),0==n.b&&(n.src=null,e[Ot]=null)):Tt(t)))}function Rt(t){return t in Dt?Dt[t]:Dt[t]="on"+t}function Lt(t,e){var n=t.listener,r=t.ca||t.src;return t.Z&&Pt(t),n.call(r,e)}function Ct(t,e){if(t.Y)return!0;if(yt)return Lt(t,new wt(e,this));if(!e)t:{e=["window","event"];for(var n=O,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return Lt(t,e=new wt(e,this))}function Ut(t){return(t=t[Ot])instanceof At?t:null}var Vt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Mt(e){return"function"==typeof e?e:(e[Vt]||(e[Vt]=function(t){return e.handleEvent(t)}),e[Vt])}function jt(){F.call(this),this.c=new At(this),(this.J=this).C=null}function Ft(t,e){var n,r=t.C;if(r)for(n=[];r;r=r.C)n.push(r);if(t=t.J,r=e.type||e,"string"==typeof e?e=new mt(e,t):e instanceof mt?e.target=e.target||t:(s=e,tt(e=new mt(r,t),s)),s=!0,n)for(var i=n.length-1;0<=i;i--)var o=e.a=n[i],s=qt(o,r,!0,e)&&s;if(s=qt(o=e.a=t,r,!0,e)&&s,s=qt(o,r,!1,e)&&s,n)for(i=0;i<n.length;i++)s=qt(o=e.a=n[i],r,!1,e)&&s}function qt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s,u,a=e[o];a&&!a.Y&&a.capture==n&&(s=a.listener,u=a.ca||a.src,a.Z&&Nt(t.c,a),i=!1!==s.call(u,r)&&i)}return i&&!r.defaultPrevented}j(jt,F),jt.prototype[It]=!0,(A=jt.prototype).addEventListener=function(t,e,n,r){xt(this,t,e,n,r)},A.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=k(i)?!!i.capture:!!i,r=Mt(r),e&&e[It]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=St(s=e.a[n],r,i,o))&&(Tt(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&Ut(e))&&(n=e.a[n.toString()],e=-1,n&&(e=St(n,r,i,o)),(r=-1<e?n[e]:null)&&Pt(r))}(this,t,e,n,r)},A.G=function(){if(jt.X.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Tt(n[r]);delete e.a[t],e.b--}}this.C=null},A.va=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},A.wa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Bt=O.JSON.stringify;function Gt(){this.b=this.a=null}var zt,Ht=(Kt.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},new Kt(function(){return new Wt},function(t){t.reset()}));function Kt(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function Wt(){this.next=this.b=this.a=null}function Qt(t,e){var n;zt||(n=O.Promise.resolve(void 0),zt=function(){n.then(Xt)}),Yt||(zt(),Yt=!0),Jt.add(t,e)}Gt.prototype.add=function(t,e){var n=Ht.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Wt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var Yt=!(Wt.prototype.reset=function(){this.next=this.b=this.a=null}),Jt=new Gt;function Xt(){for(var t,e;n=e=void 0,n=null,(e=Jt).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){!function(t){O.setTimeout(function(){throw t},0)}(t)}var n=Ht;n.f(t),n.b<100&&(n.b++,t.next=n.a,n.a=t)}Yt=!1}function $t(t,e){jt.call(this),this.b=t||1,this.a=e||O,this.f=U(this.Za,this),this.g=M()}function Zt(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function te(t,e,n){if("function"==typeof t)n&&(t=U(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=U(t.handleEvent,t)}return 2147483647<Number(e)?-1:O.setTimeout(t,e||0)}j($t,jt),(A=$t.prototype).aa=!1,A.M=null,A.Za=function(){var t;this.aa&&(0<(t=M()-this.g)&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),Ft(this,"tick"),this.aa&&(Zt(this),this.start())))},A.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=M())},A.G=function(){$t.X.G.call(this),Zt(this),delete this.a};var ee,ne,re,ie=(_(ne=se,re=ee=F),ne.prototype=null===re?Object.create(re):(oe.prototype=re.prototype,new oe),se.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:function t(e){e.a=te(function(){e.a=null,e.c&&(e.c=!1,t(e))},e.h);var n=e.b;e.b=null,e.g.apply(null,n)}(this)},se.prototype.G=function(){ee.prototype.G.call(this),this.a&&(O.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},se);function oe(){this.constructor=ne}function se(t,e){var n=ee.call(this)||this;return n.g=t,n.h=e,n.b=null,n.c=!1,n.a=null,n}function ue(t){F.call(this),this.b=t,this.a={}}j(ue,F);var ae=[];function ce(t,e,n,r){Array.isArray(n)||(n&&(ae[0]=n.toString()),n=ae);for(var i=0;i<n.length;i++){var o=xt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function he(t){X(t.a,function(t,e){this.a.hasOwnProperty(e)&&Pt(t)},t),t.a={}}function fe(){this.a=!0}function le(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)){r=i[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<i.length;o++)i[o]=""}}}return Bt(n)}catch(t){return e}}(t,n)+(r?" "+r:"")})}ue.prototype.G=function(){ue.X.G.call(this),he(this)},ue.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},fe.prototype.info=function(){};var pe={},de=null;function ye(){return de=de||new jt}function ve(t){mt.call(this,pe.Fa,t)}function ge(t){var e=ye();Ft(e,new ve(e))}function me(t,e){mt.call(this,pe.STAT_EVENT,t),this.stat=e}function we(t){var e=ye();Ft(e,new me(e,t))}function be(t){mt.call(this,pe.Ga,t)}function Ie(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return O.setTimeout(function(){t()},e)}pe.Fa="serverreachability",j(ve,mt),pe.STAT_EVENT="statevent",j(me,mt),pe.Ga="timingevent",j(be,mt);var Ee={NO_ERROR:0,$a:1,nb:2,mb:3,hb:4,lb:5,ob:6,Da:7,TIMEOUT:8,rb:9},_e={fb:"complete",Bb:"success",Ea:"error",Da:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",ib:"downloadprogress",Jb:"uploadprogress"};function Te(){}function Ae(t){var e;return(e=t.a)||(e=t.a={}),e}function Ne(){}Te.prototype.a=null;var Se,N={OPEN:"a",eb:"b",Ea:"c",qb:"d"};function Oe(){mt.call(this,"d")}function De(){mt.call(this,"c")}function xe(){}function ke(t,e,n,r){this.g=t,this.c=e,this.f=n,this.S=r||1,this.J=new ue(this),this.P=Pe,t=st?125:void 0,this.R=new $t(t),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}j(Oe,mt),j(De,mt),j(xe,Te),Se=new xe;var Pe=45e3,Re={},Le={};function Ce(t,e,n){t.H=1,t.i=nn(Je(e)),t.j=n,t.I=!0,Ue(t,null)}function Ue(t,e){t.u=M(),Me(t),t.l=Je(t.i);var s,u,a,c,h,f,n=t.l,r=t.S;Array.isArray(r)||(r=[String(r)]),vn(n.b,"t",r),t.D=0,t.a=cr(t.g,t.g.C?e:null),0<t.O&&(t.F=new ie(U(t.Ca,t,t.a),t.O)),ce(t.J,t.a,"readystatechange",t.Xa),e=t.B?$(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),ge(1),s=t.c,u=t.m,a=t.l,c=t.f,h=t.S,f=t.j,s.info(function(){if(s.a)if(f)for(var t="",e=f.split("&"),n=0;n<e.length;n++){var r,i,o=e[n].split("=");1<o.length&&(r=o[0],o=o[1],t=2<=(i=r.split("_")).length&&"type"==i[1]?t+(r+"=")+o+"&":t+(r+"=redacted&"))}else t=null;else t=f;return"XMLHTTP REQ ("+c+") [attempt "+h+"]: "+u+"\n"+a+"\n"+t})}function Ve(t,e,n){for(var r,i,o,s=!0;!t.A&&t.D<n.length;){var u=(u=n,o=i=void 0,i=(r=t).D,-1==(o=u.indexOf("\n",i))?Le:(i=Number(u.substring(i,o)),isNaN(i)?Re:(o+=1)+i>u.length?Le:(u=u.substr(o,i),r.D=o+i,u)));if(u==Le){4==e&&(t.h=4,we(14),s=!1),le(t.c,t.f,null,"[Incomplete Response]");break}if(u==Re){t.h=4,we(15),le(t.c,t.f,n,"[Invalid Chunk]"),s=!1;break}le(t.c,t.f,u,null),Ge(t,u)}4==e&&0==n.length&&(t.h=1,we(16),s=!1),t.b=t.b&&s,s?0<n.length&&!t.V&&(t.V=!0,(e=t.g).a==t&&e.U&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),er(e),e.F=!0,we(11))):(le(t.c,t.f,n,"[Invalid Chunked Response]"),Be(t),qe(t))}function Me(t){t.T=M()+t.P,je(t,t.P)}function je(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=Ie(U(t.Va,t),e)}function Fe(t){t.o&&(O.clearTimeout(t.o),t.o=null)}function qe(t){0==t.g.v||t.A||ir(t.g,t)}function Be(t){Fe(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,Zt(t.R),he(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function Ge(t,e){try{var n,r,i,o,s,u=t.g;if(0!=u.v&&(u.a==t||_n(u.b,t)))if(u.I=t.N,!t.C&&_n(u.b,t)&&3==u.v){try{var a=u.ka.a.parse(e)}catch(t){a=null}if(Array.isArray(a)&&3==a.length){var c=a;if(0==c[0]){t:if(!u.j){if(u.a){if(!(u.a.u+3e3<t.u))break t;rr(u),Kn(u)}tr(u),we(18)}}else u.oa=c[1],0<u.oa-u.P&&c[2]<37500&&u.H&&0==u.o&&!u.m&&(u.m=Ie(U(u.Sa,u),6e3));if(En(u.b)<=1&&u.ea){try{u.ea()}catch(t){}u.ea=void 0}}else sr(u,11)}else if(!t.C&&u.a!=t||rr(u),!H(e))for(e=a=u.ka.a.parse(e),a=0;a<e.length;a++){c=e[a],u.P=c[0],c=c[1],2==u.v?"c"==c[0]?(u.J=c[1],u.ga=c[2],null!=(r=c[3])&&(u.ha=r,u.c.info("VER="+u.ha)),null!=(o=c[4])&&(u.pa=o,u.c.info("SVER="+u.pa)),null!=(r=c[5])&&"number"==typeof r&&0<r&&(n=1.5*r,u.D=n,u.c.info("backChannelRequestTimeoutMs_="+n)),n=u,(o=t.a)&&(!(r=o.a?o.a.getResponseHeader("X-Client-Wire-Protocol"):null)||!(i=n.b).a&&(Q(r,"spdy")||Q(r,"quic")||Q(r,"h2"))&&(i.f=i.g,i.a=new Set,i.b&&(Tn(i,i.b),i.b=null)),!n.A||(s=o.a?o.a.getResponseHeader("X-HTTP-Session-Id"):null)&&(n.na=s,en(n.B,n.A,s))),u.v=3,u.f&&u.f.ta(),u.U&&(u.N=M()-t.u,u.c.info("Handshake RTT: "+u.N+"ms")),i=t,(n=u).la=ar(n,n.C?n.ga:null,n.fa),i.C?(An(n.b,i),o=i,(s=n.D)&&o.setTimeout(s),o.o&&(Fe(o),Me(o)),n.a=i):Zn(n),0<u.g.length&&Yn(u)):"stop"!=c[0]&&"close"!=c[0]||sr(u,7):3==u.v&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?sr(u,7):Hn(u):"noop"!=c[0]&&u.f&&u.f.sa(c),u.o=0)}ge(4)}catch(t){}}function ze(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(x(t)||"string"==typeof t)B(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(x(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(x(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function He(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof He)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Ke(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];We(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){for(var i={},n=e=0;e<t.a.length;)We(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function We(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(A=ke.prototype).setTimeout=function(t){this.P=t},A.Xa=function(t){t=t.target;var e=this.F;e&&3==qn(t)?e.f():this.Ca(t)},A.Ca=function(t){try{if(t==this.a)t:{var e=qn(this.a),n=this.a.ua(),r=this.a.W();if(!(e<3||3==e&&!st&&!this.a.$())){this.A||4!=e||7==n||ge(8==n||r<=0?3:2),Fe(this);var i=this.a.W();this.N=i;n=this.a.$();if(this.b=200==i,r=this.c,u=this.m,a=this.l,c=this.f,h=this.S,f=e,l=i,r.info(function(){return"XMLHTTP RESP ("+c+") [ attempt "+h+"]: "+u+"\n"+a+"\n"+f+" "+l}),this.b){if(this.U&&!this.C){e:{if(this.a){var o=this.a;if((o=o.a?o.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!H(o)){var s=o;break e}}s=null}if(!s){this.b=!1,this.h=3,we(12),Be(this),qe(this);break t}le(this.c,this.f,s,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Ge(this,s)}this.I?(Ve(this,e,n),st&&this.b&&3==e&&(ce(this.J,this.R,"tick",this.Wa),this.R.start())):(le(this.c,this.f,n,null),Ge(this,n)),4==e&&Be(this),this.b&&!this.A&&(4==e?ir(this.g,this):(this.b=!1,Me(this)))}else 400==i&&0<n.indexOf("Unknown SID")?(this.h=3,we(12)):(this.h=0,we(13)),Be(this),qe(this)}}}catch(t){}var u,a,c,h,f,l},A.Wa=function(){var t,e;this.a&&(t=qn(this.a),e=this.a.$(),this.D<e.length&&(Fe(this),Ve(this,t,e),this.b&&4!=t&&Me(this)))},A.cancel=function(){this.A=!0,Be(this)},A.Va=function(){this.o=null;var t,e,n=M();0<=n-this.T?(t=this.c,e=this.l,t.info(function(){return"TIMEOUT: "+e}),2!=this.H&&(ge(3),we(17)),Be(this),this.h=2,qe(this)):je(this,this.T-n)},(A=He.prototype).K=function(){Ke(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},A.L=function(){return Ke(this),this.a.concat()},A.get=function(t,e){return We(this.b,t)?this.b[t]:e},A.set=function(t,e){We(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},A.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Qe=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ye(t,e){var n;this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof Ye?(this.a=void 0!==e?e:t.a,Xe(this,t.f),this.j=t.j,$e(this,t.c),Ze(this,t.h),this.g=t.g,e=t.b,(n=new ln).c=e.c,e.a&&(n.a=new He(e.a),n.b=e.b),tn(this,n),this.i=t.i):t&&(n=String(t).match(Qe))?(this.a=!!e,Xe(this,n[1]||"",!0),this.j=rn(n[2]||""),$e(this,n[3]||"",!0),Ze(this,n[4]),this.g=rn(n[5]||"",!0),tn(this,n[6]||"",!0),this.i=rn(n[7]||"")):(this.a=!!e,this.b=new ln(null,this.a))}function Je(t){return new Ye(t)}function Xe(t,e,n){t.f=n?rn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function $e(t,e,n){t.c=n?rn(e,!0):e}function Ze(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.h=e}else t.h=null}function tn(t,e,n){var r,i;e instanceof ln?(t.b=e,r=t.b,(i=t.a)&&!r.f&&(pn(r),r.c=null,r.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(dn(this,e),vn(this,n,t))},r)),r.f=i):(n||(e=on(e,hn)),t.b=new ln(e,t.a))}function en(t,e,n){t.b.set(e,n)}function nn(t){return en(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^M()).toString(36)),t}function rn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function on(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,sn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function sn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Ye.prototype.toString=function(){var t=[],e=this.f;e&&t.push(on(e,un,!0),":");var n=this.c;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(on(e,un,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(on(n,"/"==n.charAt(0)?cn:an,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",on(n,fn)),t.join("")};var un=/[#\/\?@]/g,an=/[#\?:]/g,cn=/[#\?]/g,hn=/[#\?@]/g,fn=/#/g;function ln(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function pn(n){n.a||(n.a=new He,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r,i=t[n].indexOf("="),o=null;0<=i?(r=t[n].substring(0,i),o=t[n].substring(i+1)):r=t[n],e(r,o?decodeURIComponent(o.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function dn(t,e){pn(t),e=gn(t,e),We(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,We((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Ke(t)))}function yn(t,e){return pn(t),e=gn(t,e),We(t.a.b,e)}function vn(t,e,n){dn(t,e),0<n.length&&(t.c=null,t.a.set(gn(t,e),z(n)),t.b+=n.length)}function gn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(A=ln.prototype).add=function(t,e){pn(this),this.c=null,t=gn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},A.forEach=function(n,r){pn(this),this.a.forEach(function(t,e){B(t,function(t){n.call(r,t,e,this)},this)},this)},A.L=function(){pn(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},A.K=function(t){pn(this);var e=[];if("string"==typeof t)yn(this,t)&&(e=G(e,this.a.get(gn(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=G(e,t[n])}return e},A.set=function(t,e){return pn(this),this.c=null,yn(this,t=gn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},A.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},A.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++)for(var r=e[n],i=encodeURIComponent(String(r)),r=this.K(r),o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}return this.c=t.join("&")};var mn=function(t,e){this.b=t,this.a=e};function wn(t){this.g=t||bn,t=O.PerformanceNavigationTiming?0<(t=O.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(O.ia&&O.ia.ya&&O.ia.ya()&&O.ia.ya().Lb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}var bn=10;function In(t){return t.b||t.a&&t.a.size>=t.f}function En(t){return t.b?1:t.a?t.a.size:0}function _n(t,e){return t.b?t.b==e:t.a&&t.a.has(e)}function Tn(t,e){t.a?t.a.add(e):t.b=e}function An(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function Nn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null==t.a||0===t.a.size)return z(t.c);var r=t.c;try{for(var i=T(t.a.values()),o=i.next();!o.done;o=i.next())var s=o.value,r=r.concat(s.s)}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function Sn(){}function On(){this.a=new Sn}function Dn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}wn.prototype.cancel=function(){var e,t;if(this.c=Nn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=T(this.a.values()),r=n.next();!r.done;r=n.next()){r.value.cancel()}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.a.clear()}},Sn.prototype.stringify=function(t){return O.JSON.stringify(t,void 0)},Sn.prototype.parse=function(t){return O.JSON.parse(t,void 0)};var xn=O.JSON.parse;function kn(t){jt.call(this),this.headers=new He,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=Pn,this.D=this.F=!1}j(kn,jt);var Pn="",Rn=/^https?$/i,Ln=["POST","PUT"];function Cn(t){return"content-type"==t.toLowerCase()}function Un(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Vn(t),jn(t)}function Vn(t){t.u||(t.u=!0,Ft(t,"complete"),Ft(t,"error"))}function Mn(t){if(t.b&&void 0!==S&&(!t.s[1]||4!=qn(t)||2!=t.W()))if(t.l&&4==qn(t))te(t.za,0,t);else if(Ft(t,"readystatechange"),4==qn(t)){t.b=!1;try{var e,n,r,i,o=t.W();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}(e=s)||((n=0===o)&&(!(i=String(t.B).match(Qe)[1]||null)&&O.self&&O.self.location&&(i=(r=O.self.location.protocol).substr(0,r.length-1)),n=!Rn.test(i?i.toLowerCase():"")),e=n);if(e)Ft(t,"complete"),Ft(t,"success");else{t.h=6;try{var u=2<qn(t)?t.a.statusText:""}catch(o){u=""}t.f=u+" ["+t.W()+"]",Vn(t)}}finally{jn(t)}}}function jn(t,e){if(t.a){Fn(t);var n=t.a,r=t.s[0]?D:null;t.a=null,t.s=null,e||Ft(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function Fn(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(O.clearTimeout(t.m),t.m=null)}function qn(t){return t.a?t.a.readyState:0}function Bn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}var i;r||(i="",X(n,function(t,e){i+=e,i+=":",i+=t,i+="\r\n"}),n=i,"string"==typeof t?null!=n&&encodeURIComponent(String(n)):en(t,e,n))}function Gn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function zn(t){this.pa=0,this.g=[],this.c=new fe,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.V=this.i=this.O=this.l=null,this.Oa=this.R=0,this.La=Gn("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.oa=this.P=-1,this.T=this.o=this.u=0,this.Ha=Gn("baseRetryDelayMs",5e3,t),this.Ra=Gn("retryDelaySeedMs",1e4,t),this.Ma=Gn("forwardChannelMaxRetries",2,t),this.ma=Gn("forwardChannelRequestTimeoutMs",2e4,t),this.Na=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new wn(t&&t.concurrentRequestLimit),this.ka=new On,this.da=t&&t.fastHandshake||!1,this.Ia=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.S=!1),this.U=!this.da&&this.S&&t&&t.detectBufferingProxy||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null,(this.Ka=t&&t.c||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}function Hn(t){var e,n;Wn(t),3==t.v&&(e=t.R++,en(n=Je(t.B),"SID",t.J),en(n,"RID",e),en(n,"TYPE","terminate"),Xn(t,n),(e=new ke(t,t.c,e,void 0)).H=2,e.i=nn(Je(n)),n=!1,O.navigator&&O.navigator.sendBeacon&&(n=O.navigator.sendBeacon(e.i.toString(),"")),!n&&O.Image&&((new Image).src=e.i,n=!0),n||(e.a=cr(e.g,null),e.a.ba(e.i)),e.u=M(),Me(e)),ur(t)}function Kn(t){t.a&&(er(t),t.a.cancel(),t.a=null)}function Wn(t){Kn(t),t.j&&(O.clearTimeout(t.j),t.j=null),rr(t),t.b.cancel(),t.h&&("number"==typeof t.h&&O.clearTimeout(t.h),t.h=null)}function Qn(t,e){t.g.push(new mn(t.Oa++,e)),3==t.v&&Yn(t)}function Yn(t){In(t.b)||t.h||(t.h=!0,Qt(t.Ba,t),t.u=0)}function Jn(t,e){var n=e?e.f:t.R++,r=Je(t.B);en(r,"SID",t.J),en(r,"RID",n),en(r,"AID",t.P),Xn(t,r),t.i&&t.l&&Bn(r,t.i,t.l),n=new ke(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=$n(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),Tn(t.b,n),Ce(n,r,e)}function Xn(t,n){t.f&&ze({},function(t,e){en(n,e,t)})}function $n(t,e,n){n=Math.min(t.g.length,n);var r=t.f?U(t.f.Ja,t.f,t):null;t:for(var i=t.g,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var u=!0,a=0;a<n;a++){var c=i[a].b,h=i[a].a;if((c-=o)<0)o=Math.max(0,i[a].b-100),u=!1;else try{!function(t,r,e){var i=e||"";try{ze(t,function(t,e){var n=t;k(t)&&(n=Bt(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}(h,s,"req"+c+"_")}catch(t){r&&r(h)}}if(u){r=s.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function Zn(t){t.a||t.j||(t.T=1,Qt(t.Aa,t),t.o=0)}function tr(t){return!(t.a||t.j||3<=t.o)&&(t.T++,t.j=Ie(U(t.Aa,t),or(t,t.o)),t.o++,1)}function er(t){null!=t.s&&(O.clearTimeout(t.s),t.s=null)}function nr(t){t.a=new ke(t,t.c,"rpc",t.T),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=Je(t.la);en(e,"RID","rpc"),en(e,"SID",t.J),en(e,"CI",t.H?"0":"1"),en(e,"AID",t.P),Xn(t,e),en(e,"TYPE","xmlhttp"),t.i&&t.l&&Bn(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=nn(Je(e)),n.j=null,n.I=!0,Ue(n,t)}function rr(t){null!=t.m&&(O.clearTimeout(t.m),t.m=null)}function ir(t,e){var n,r=null;if(t.a==e){rr(t),er(t),t.a=null;var i=2}else{if(!_n(t.b,e))return;r=e.s,An(t.b,e),i=1}if(t.I=e.N,0!=t.v)if(e.b){1==i?(r=e.j?e.j.length:0,e=M()-e.u,n=t.u,Ft(i=ye(),new be(i)),Yn(t)):Zn(t)}else if(3==(n=e.h)||0==n&&0<t.I||!(1==i&&function(t,e){if(!(En(t.b)>=t.b.f-(t.h?1:0))){if(t.h)return t.g=e.s.concat(t.g),1;if(!(1==t.v||2==t.v||t.u>=(t.La?0:t.Ma)))return t.h=Ie(U(t.Ba,t,e),or(t,t.u)),t.u++,1}}(t,e)||2==i&&tr(t)))switch(r&&0<r.length&&(e=t.b,e.c=e.c.concat(r)),n){case 1:sr(t,5);break;case 4:sr(t,10);break;case 3:sr(t,6);break;default:sr(t,2)}}function or(t,e){var n=t.Ha+Math.floor(Math.random()*t.Ra);return t.f||(n*=2),n*e}function sr(t,e){var n,r,i,o;t.c.info("Error code "+e),2==e?(r=null,t.f&&(r=null),o=U(t.Ya,t),r||(r=new Ye("//www.google.com/images/cleardot.gif"),O.location&&"http"==O.location.protocol||Xe(r,"https"),nn(r)),n=r.toString(),r=o,o=new fe,O.Image?((i=new Image).onload=V(Dn,o,i,"TestLoadImage: loaded",!0,r),i.onerror=V(Dn,o,i,"TestLoadImage: error",!1,r),i.onabort=V(Dn,o,i,"TestLoadImage: abort",!1,r),i.ontimeout=V(Dn,o,i,"TestLoadImage: timeout",!1,r),O.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=n):r(!1)):we(2),t.v=0,t.f&&t.f.ra(e),ur(t),Wn(t)}function ur(t){t.v=0,t.I=-1,t.f&&(0==Nn(t.b).length&&0==t.g.length||(t.b.c.length=0,z(t.g),t.g.length=0),t.f.qa())}function ar(t,e,n){var r,i,o,s,u,a=(s=n)instanceof Ye?Je(s):new Ye(s,void 0);return""!=a.c?(e&&$e(a,e+"."+a.c),Ze(a,a.h)):(u=O.location,r=u.protocol,i=e?e+"."+u.hostname:u.hostname,o=+u.port,s=n,u=new Ye(null,void 0),r&&Xe(u,r),i&&$e(u,i),o&&Ze(u,o),s&&(u.g=s),a=u),t.V&&X(t.V,function(t,e){en(a,e,t)}),e=t.A,n=t.na,e&&n&&en(a,e,n),en(a,"VER",t.ha),Xn(t,a),a}function cr(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new kn(t.Na)).F=t.C,e}function hr(){}function fr(){if(it&&!(10<=Number(dt)))throw Error("Environmental error: no available transport.")}function lr(t,e){jt.call(this),this.a=new zn(e),this.o=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!H(t)&&(this.a.i=t),this.m=e&&e.supportsCrossDomainXhr||!1,this.l=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!H(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new yr(this)}function pr(t){Oe.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function dr(){De.call(this),this.status=1}function yr(t){this.a=t}(A=kn.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?Ae(this.H):Ae(Se),this.a.onreadystatechange=U(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(t){return void Un(this,t)}t=n||"";var i,o=new He(this.headers);r&&ze(r,function(t,e){o.set(e,t)}),r=function(t){t:{for(var e=Cn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:"string"==typeof t?t.charAt(e):t[e]}(o.L()),n=O.FormData&&t instanceof O.FormData,0<=q(Ln,e)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Fn(this),0<this.o&&((this.D=(i=this.a,it&&pt(9)&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.a.timeout=this.o,this.a.ontimeout=U(this.xa,this)):this.m=te(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Un(this,t)}},A.xa=function(){void 0!==S&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,Ft(this,"timeout"),this.abort(8))},A.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,Ft(this,"complete"),Ft(this,"abort"),jn(this))},A.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),jn(this,!0)),kn.X.G.call(this)},A.za=function(){this.j||(this.A||this.l||this.g?Mn(this):this.Ua())},A.Ua=function(){Mn(this)},A.W=function(){try{return 2<qn(this)?this.a.status:-1}catch(t){return-1}},A.$=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},A.Pa=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),xn(e)}},A.ua=function(){return this.h},A.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(A=zn.prototype).ha=8,A.v=1,A.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new ke(this,this.c,t,void 0),r=this.l;if(this.O&&(r?tt(r=$(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)t:{for(var i=e=0;i<this.g.length;i++){var o=this.g[i];if("__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o=o.length:o=void 0,void 0===o)break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=$n(this,n,e),en(i=Je(this.B),"RID",t),en(i,"CVER",22),this.A&&en(i,"X-HTTP-Session-Id",this.A),Xn(this,i),this.i&&r&&Bn(i,this.i,r),Tn(this.b,n),this.Ia&&en(i,"TYPE","init"),this.da?(en(i,"$req",e),en(i,"SID","null"),n.U=!0,Ce(n,i,null)):Ce(n,i,e),this.v=2}}else 3==this.v&&(t?Jn(this,t):0==this.g.length||In(this.b)||Jn(this))},A.Aa=function(){var t;this.j=null,nr(this),this.U&&!(this.F||null==this.a||this.N<=0)&&(t=2*this.N,this.c.info("BP detection timer enabled: "+t),this.s=Ie(U(this.Ta,this),t))},A.Ta=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,we(10),Kn(this),nr(this))},A.Sa=function(){null!=this.m&&(this.m=null,Kn(this),tr(this),we(19))},A.Ya=function(t){t?(this.c.info("Successfully pinged google.com"),we(2)):(this.c.info("Failed to ping google.com"),we(1))},(A=hr.prototype).ta=function(){},A.sa=function(){},A.ra=function(){},A.qa=function(){},A.Ja=function(){},fr.prototype.a=function(t,e){return new lr(t,e)},j(lr,jt),lr.prototype.g=function(){this.a.f=this.f,this.m&&(this.a.C=!0);var t=this.a,e=this.o,n=this.b||void 0;we(0),t.fa=e,t.V=n||{},t.H=t.S,t.B=ar(t,null,t.fa),Yn(t)},lr.prototype.close=function(){Hn(this.a)},lr.prototype.h=function(t){var e;"string"==typeof t?((e={}).__data__=t,Qn(this.a,e)):this.l?((e={}).__data__=Bt(t),Qn(this.a,e)):Qn(this.a,t)},lr.prototype.G=function(){this.a.f=null,delete this.f,Hn(this.a),delete this.a,lr.X.G.call(this)},j(pr,Oe),j(dr,De),j(yr,hr),yr.prototype.ta=function(){Ft(this.a,"a")},yr.prototype.sa=function(t){Ft(this.a,new pr(t))},yr.prototype.ra=function(t){Ft(this.a,new dr)},yr.prototype.qa=function(){Ft(this.a,"b")},fr.prototype.createWebChannel=fr.prototype.a,lr.prototype.send=lr.prototype.h,lr.prototype.open=lr.prototype.g,Ee.NO_ERROR=0,Ee.TIMEOUT=8,Ee.HTTP_ERROR=6,_e.COMPLETE="complete",(Ne.EventType=N).OPEN="a",N.CLOSE="b",N.ERROR="c",N.MESSAGE="d",jt.prototype.listen=jt.prototype.va,kn.prototype.listenOnce=kn.prototype.wa,kn.prototype.getLastError=kn.prototype.Qa,kn.prototype.getLastErrorCode=kn.prototype.ua,kn.prototype.getStatus=kn.prototype.W,kn.prototype.getResponseJson=kn.prototype.Pa,kn.prototype.getResponseText=kn.prototype.$,kn.prototype.send=kn.prototype.ba;var vr=ye,gr=Ee,mr=_e,wr=pe,br=10,Ir=11,Er=Ne,_r=kn,Tr=new o("@firebase/firestore");function Ar(){return Tr.logLevel}function Nr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Tr.logLevel<=l.DEBUG&&(e=n.map(Dr),Tr.debug.apply(Tr,f(["Firestore (8.2.0): "+t],e)))}function Sr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Tr.logLevel<=l.ERROR&&(e=n.map(Dr),Tr.error.apply(Tr,f(["Firestore (8.2.0): "+t],e)))}function Or(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Tr.logLevel<=l.WARN&&(e=n.map(Dr),Tr.warn.apply(Tr,f(["Firestore (8.2.0): "+t],e)))}function Dr(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function xr(t){void 0===t&&(t="Unexpected state");t="FIRESTORE (8.2.0) INTERNAL ASSERTION FAILED: "+t;throw Sr(t),new Error(t)}function kr(t){t||xr()}var Pr=(Rr.t=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=function(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},Rr);function Rr(){}function Lr(t,e){return t<e?-1:e<t?1:0}function Cr(t,n,r){return t.length===n.length&&t.every(function(t,e){return r(t,n[e])})}function Ur(t){return t+"\0"}var Vr=(Mr.fromBase64String=function(t){return new Mr(atob(t))},Mr.fromUint8Array=function(t){return new Mr(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t))},Mr.prototype.toBase64=function(){return t=this.i,btoa(t);var t},Mr.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.i)},Mr.prototype.o=function(){return 2*this.i.length},Mr.prototype.u=function(t){return Lr(this.i,t.i)},Mr.prototype.isEqual=function(t){return this.i===t.i},Mr);function Mr(t){this.i=t}Vr.h=new Vr("");var jr,Fr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},qr=(h(Hr,jr=Error),Hr),Br=(zr.fromBase64String=function(t){try{return new zr(Vr.fromBase64String(t))}catch(t){throw new qr(Fr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}},zr.fromUint8Array=function(t){return new zr(Vr.fromUint8Array(t))},zr.prototype.toBase64=function(){return this.l.toBase64()},zr.prototype.toUint8Array=function(){return this.l.toUint8Array()},zr.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},zr.prototype.isEqual=function(t){return this.l.isEqual(t.l)},zr),Gr=function(t){this._=t};function zr(t){this.l=t}function Hr(t,e){var n=this;return(n=jr.call(this,e)||this).code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function Kr(){if("undefined"==typeof Uint8Array)throw new qr(Fr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Wr(){if("undefined"==typeof atob)throw new qr(Fr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Qr,Yr=(h($r,Qr=Gr),$r.fromBase64String=function(t){return Wr(),new $r(Br.fromBase64String(t))},$r.fromUint8Array=function(t){return Kr(),new $r(Br.fromUint8Array(t))},$r.prototype.toBase64=function(){return Wr(),this._.toBase64()},$r.prototype.toUint8Array=function(){return Kr(),this._.toUint8Array()},$r.prototype.isEqual=function(t){return this._.isEqual(t._)},$r.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},$r),Jr=(Xr.prototype.T=function(){return null!=this.uid},Xr.prototype.I=function(){return this.T()?"uid:"+this.uid:"anonymous-user"},Xr.prototype.isEqual=function(t){return t.uid===this.uid},Xr);function Xr(t){this.uid=t}function $r(){return null!==Qr&&Qr.apply(this,arguments)||this}Jr.UNAUTHENTICATED=new Jr(null),Jr.m=new Jr("google-credentials-uid"),Jr.A=new Jr("first-party-uid");function Zr(t,e){this.user=e,this.type="OAuth",this.R={},this.R.Authorization="Bearer "+t}var ti=(di.prototype.getToken=function(){return Promise.resolve(null)},di.prototype.g=function(){},di.prototype.V=function(t){(this.P=t)(Jr.UNAUTHENTICATED)},di.prototype.p=function(){this.P=null},di),ei=(pi.prototype.getToken=function(){var e=this,n=this.D,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){return e.D!==n?(Nr("FirebaseCredentialsProvider","getToken aborted due to token change."),e.getToken()):t?(kr("string"==typeof t.accessToken),new Zr(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},pi.prototype.g=function(){this.forceRefresh=!0},pi.prototype.V=function(t){this.P=t,this.S&&t(this.currentUser)},pi.prototype.p=function(){this.auth&&this.auth.removeAuthTokenListener(this.v),this.v=null,this.P=null},pi.prototype.C=function(){var t=this.auth&&this.auth.getUid();return kr(null===t||"string"==typeof t),new Jr(t)},pi),ni=(Object.defineProperty(li.prototype,"R",{get:function(){var t={"X-Goog-AuthUser":this.F},e=this.N.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),li),ri=(fi.prototype.getToken=function(){return Promise.resolve(new ni(this.N,this.F))},fi.prototype.V=function(t){t(Jr.A)},fi.prototype.p=function(){},fi.prototype.g=function(){},fi),ii=function(t,e,n,r,i,o){this.O=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i,this.k=o},oi=(Object.defineProperty(hi.prototype,"M",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),hi.prototype.isEqual=function(t){return t instanceof hi&&t.projectId===this.projectId&&t.database===this.database},hi),si=(ci.prototype.L=function(t){},ci.prototype.$=function(){},ci),ui=(ai.prototype.L=function(t){this.W.push(t)},ai.prototype.$=function(){window.removeEventListener("online",this.B),window.removeEventListener("offline",this.U)},ai.prototype.j=function(){window.addEventListener("online",this.B),window.addEventListener("offline",this.U)},ai.prototype.q=function(){Nr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.W;t<e.length;t++)(0,e[t])(0)},ai.prototype.K=function(){Nr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.W;t<e.length;t++)(0,e[t])(1)},ai.G=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},ai);function ai(){var t=this;this.B=function(){return t.q()},this.U=function(){return t.K()},this.W=[],this.j()}function ci(){}function hi(t,e){this.projectId=t,this.database=e||"(default)"}function fi(t,e){this.N=t,this.F=e}function li(t,e){this.N=t,this.F=e,this.type="FirstParty",this.user=Jr.A}function pi(t){var e=this;this.v=null,this.currentUser=Jr.UNAUTHENTICATED,this.S=!1,this.D=0,this.P=null,this.forceRefresh=!1,this.v=function(){e.D++,e.currentUser=e.C(),e.S=!0,e.P&&e.P(e.currentUser)},this.D=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.v):(this.v(null),t.get().then(function(t){e.auth=t,e.v&&e.auth.addAuthTokenListener(e.v)},function(){}))}function di(){this.P=null}function yi(t){return null==t}function vi(t){return 0===t&&1/t==-1/0}function gi(t){return"number"==typeof t&&Number.isInteger(t)&&!vi(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var mi,wi={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};function bi(t){switch(t){case Fr.OK:return xr(),0;case Fr.CANCELLED:case Fr.UNKNOWN:case Fr.DEADLINE_EXCEEDED:case Fr.RESOURCE_EXHAUSTED:case Fr.INTERNAL:case Fr.UNAVAILABLE:case Fr.UNAUTHENTICATED:return;case Fr.INVALID_ARGUMENT:case Fr.NOT_FOUND:case Fr.ALREADY_EXISTS:case Fr.PERMISSION_DENIED:case Fr.FAILED_PRECONDITION:case Fr.ABORTED:case Fr.OUT_OF_RANGE:case Fr.UNIMPLEMENTED:case Fr.DATA_LOSS:return 1;default:return xr(),0}}function Ii(t){if(void 0===t)return Sr("GRPC error has no .code"),Fr.UNKNOWN;switch(t){case mi.OK:return Fr.OK;case mi.CANCELLED:return Fr.CANCELLED;case mi.UNKNOWN:return Fr.UNKNOWN;case mi.DEADLINE_EXCEEDED:return Fr.DEADLINE_EXCEEDED;case mi.RESOURCE_EXHAUSTED:return Fr.RESOURCE_EXHAUSTED;case mi.INTERNAL:return Fr.INTERNAL;case mi.UNAVAILABLE:return Fr.UNAVAILABLE;case mi.UNAUTHENTICATED:return Fr.UNAUTHENTICATED;case mi.INVALID_ARGUMENT:return Fr.INVALID_ARGUMENT;case mi.NOT_FOUND:return Fr.NOT_FOUND;case mi.ALREADY_EXISTS:return Fr.ALREADY_EXISTS;case mi.PERMISSION_DENIED:return Fr.PERMISSION_DENIED;case mi.FAILED_PRECONDITION:return Fr.FAILED_PRECONDITION;case mi.ABORTED:return Fr.ABORTED;case mi.OUT_OF_RANGE:return Fr.OUT_OF_RANGE;case mi.UNIMPLEMENTED:return Fr.UNIMPLEMENTED;case mi.DATA_LOSS:return Fr.DATA_LOSS;default:return xr()}}(_e=mi=mi||{})[_e.OK=0]="OK",_e[_e.CANCELLED=1]="CANCELLED",_e[_e.UNKNOWN=2]="UNKNOWN",_e[_e.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",_e[_e.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",_e[_e.NOT_FOUND=5]="NOT_FOUND",_e[_e.ALREADY_EXISTS=6]="ALREADY_EXISTS",_e[_e.PERMISSION_DENIED=7]="PERMISSION_DENIED",_e[_e.UNAUTHENTICATED=16]="UNAUTHENTICATED",_e[_e.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",_e[_e.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",_e[_e.ABORTED=10]="ABORTED",_e[_e.OUT_OF_RANGE=11]="OUT_OF_RANGE",_e[_e.UNIMPLEMENTED=12]="UNIMPLEMENTED",_e[_e.INTERNAL=13]="INTERNAL",_e[_e.UNAVAILABLE=14]="UNAVAILABLE",_e[_e.DATA_LOSS=15]="DATA_LOSS";var Ei,_i,Ti,Ai=(Bi.prototype.Y=function(t){this.X=t},Bi.prototype.Z=function(t){this.tt=t},Bi.prototype.onMessage=function(t){this.et=t},Bi.prototype.close=function(){this.J()},Bi.prototype.send=function(t){this.H(t)},Bi.prototype.nt=function(){this.X()},Bi.prototype.st=function(t){this.tt(t)},Bi.prototype.it=function(t){this.et(t)},Bi),Ni=function(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})},Si=(qi.prototype.at=function(e,t,n,r){var i=this.ut(e,t);Nr("RestConnection","Sending: ",i,n);t={};return this.ht(t,r),this.lt(e,i,t,n).then(function(t){return Nr("RestConnection","Received: ",t),t},function(t){throw Or("RestConnection",e+" failed with error: ",t,"url: ",i,"request:",n),t})},qi.prototype._t=function(t,e,n,r){return this.at(t,e,n,r)},qi.prototype.ht=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.2.0",t["Content-Type"]="text/plain",e)for(var n in e.R)e.R.hasOwnProperty(n)&&(t[n]=e.R[n])},qi.prototype.ut=function(t,e){t=wi[t];return this.ot+"/v1/"+e+":"+t},h(Fi,Ti=qi),Fi.prototype.lt=function(o,e,s,u){return new Promise(function(n,r){var i=new _r;i.listenOnce(mr.COMPLETE,function(){try{switch(i.getLastErrorCode()){case gr.NO_ERROR:var t=i.getResponseJson();Nr("Connection","XHR received:",JSON.stringify(t)),n(t);break;case gr.TIMEOUT:Nr("Connection",'RPC "'+o+'" timed out'),r(new qr(Fr.DEADLINE_EXCEEDED,"Request time out"));break;case gr.HTTP_ERROR:var e=i.getStatus();Nr("Connection",'RPC "'+o+'" failed with status:',e,"response text:",i.getResponseText()),0<e?(t=i.getResponseJson().error)&&t.status&&t.message?(e=t.status.toLowerCase().replace(/_/g,"-"),e=0<=Object.values(Fr).indexOf(e)?e:Fr.UNKNOWN,r(new qr(e,t.message))):r(new qr(Fr.UNKNOWN,"Server responded with status "+i.getStatus())):r(new qr(Fr.UNAVAILABLE,"Connection failed."));break;default:xr()}}finally{Nr("Connection",'RPC "'+o+'" completed.')}});var t=JSON.stringify(u);i.send(e,"POST",t,s,15)})},Fi.prototype.ft=function(t,e){var n,r=[this.ot,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=new fr,o=vr(),t={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.O.projectId+"/databases/"+this.O.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.k};this.ht(t.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(p())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=p().indexOf("Electron/")||(0<=(n=p()).indexOf("MSIE ")||0<=n.indexOf("Trident/"))||0<=p().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(t.httpHeadersOverwriteParam="$httpHeaders");r=r.join("");Nr("Connection","Creating WebChannel: "+r,t);var s=i.createWebChannel(r,t),u=!1,a=!1,c=new Ai({H:function(t){a?Nr("Connection","Not sending because WebChannel is closed:",t):(u||(Nr("Connection","Opening WebChannel transport."),s.open(),u=!0),Nr("Connection","WebChannel sending:",t),s.send(t))},J:function(){return s.close()}}),t=function(t,e,n){t.listen(e,function(t){try{n(t)}catch(t){setTimeout(function(){throw t},0)}})};return t(s,Er.EventType.OPEN,function(){a||Nr("Connection","WebChannel transport opened.")}),t(s,Er.EventType.CLOSE,function(){a||(a=!0,Nr("Connection","WebChannel transport closed"),c.st())}),t(s,Er.EventType.ERROR,function(t){a||(a=!0,Or("Connection","WebChannel transport errored:",t),c.st(new qr(Fr.UNAVAILABLE,"The operation could not be completed")))}),t(s,Er.EventType.MESSAGE,function(t){var e,n,r,i;a||(kr(!!(e=t.data[0])),(n=e.error||(null===(i=e[0])||void 0===i?void 0:i.error))?(Nr("Connection","WebChannel received error:",n),r=n.status,t=function(){var t=mi[r];if(void 0!==t)return Ii(t)}(),i=n.message,void 0===t&&(t=Fr.INTERNAL,i="Unknown error status: "+r+" with message "+n.message),a=!0,c.st(new qr(t,i)),s.close()):(Nr("Connection","WebChannel received:",e),c.it(e)))}),t(o,wr.STAT_EVENT,function(t){t.stat===br?Nr("Connection","Detected buffering proxy"):t.stat===Ir&&Nr("Connection","Detected no buffering proxy")}),setTimeout(function(){c.nt()},0),c},Fi),Oi=(ji.now=function(){return ji.fromMillis(Date.now())},ji.fromDate=function(t){return ji.fromMillis(t.getTime())},ji.fromMillis=function(t){var e=Math.floor(t/1e3);return new ji(e,1e6*(t-1e3*e))},ji.prototype.toDate=function(){return new Date(this.toMillis())},ji.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},ji.prototype.dt=function(t){return this.seconds===t.seconds?Lr(this.nanoseconds,t.nanoseconds):Lr(this.seconds,t.seconds)},ji.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},ji.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},ji.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},ji.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},ji),Di=(Mi.wt=function(t){return new Mi(t)},Mi.min=function(){return new Mi(new Oi(0,0))},Mi.prototype.u=function(t){return this.timestamp.dt(t.timestamp)},Mi.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},Mi.prototype.Et=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},Mi.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},Mi.prototype.Tt=function(){return this.timestamp},Mi),o=(Object.defineProperty(Vi.prototype,"length",{get:function(){return this.It},enumerable:!1,configurable:!0}),Vi.prototype.isEqual=function(t){return 0===Vi.At(this,t)},Vi.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof Vi?t.forEach(function(t){e.push(t)}):e.push(t),this.Rt(e)},Vi.prototype.limit=function(){return this.offset+this.length},Vi.prototype.Pt=function(t){return t=void 0===t?1:t,this.Rt(this.segments,this.offset+t,this.length-t)},Vi.prototype.yt=function(){return this.Rt(this.segments,this.offset,this.length-1)},Vi.prototype.gt=function(){return this.segments[this.offset]},Vi.prototype.Vt=function(){return this.get(this.length-1)},Vi.prototype.get=function(t){return this.segments[this.offset+t]},Vi.prototype.bt=function(){return 0===this.length},Vi.prototype.vt=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Vi.prototype.St=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Vi.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},Vi.prototype.Dt=function(){return this.segments.slice(this.offset,this.limit())},Vi.At=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},Vi),xi=(h(Ui,_i=o),Ui.prototype.Rt=function(t,e,n){return new Ui(t,e,n)},Ui.prototype.Ct=function(){return this.Dt().join("/")},Ui.prototype.toString=function(){return this.Ct()},Ui.xt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=[],r=0,i=t;r<i.length;r++){var o=i[r];if(0<=o.indexOf("//"))throw new qr(Fr.INVALID_ARGUMENT,"Invalid segment ("+o+"). Paths must not contain // in them.");n.push.apply(n,o.split("/").filter(function(t){return 0<t.length}))}return new Ui(n)},Ui.Nt=function(){return new Ui([])},Ui),ki=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Pi=(h(Ci,Ei=o),Ci.prototype.Rt=function(t,e,n){return new Ci(t,e,n)},Ci.Ft=function(t){return ki.test(t)},Ci.prototype.Ct=function(){return this.Dt().map(function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ci.Ft(t)||(t="`"+t+"`"),t}).join(".")},Ci.prototype.toString=function(){return this.Ct()},Ci.prototype.Ot=function(){return 1===this.length&&"__name__"===this.get(0)},Ci.kt=function(){return new Ci(["__name__"])},Ci.Mt=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new qr(Fr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new qr(Fr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[r+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new qr(Fr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=u,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new qr(Fr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Ci(e)},Ci.Nt=function(){return new Ci([])},Ci),Ri=(Li.Lt=function(t){return new Li(xi.xt(t))},Li.$t=function(t){return new Li(xi.xt(t).Pt(5))},Li.prototype.Bt=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},Li.prototype.isEqual=function(t){return null!==t&&0===xi.At(this.path,t.path)},Li.prototype.toString=function(){return this.path.toString()},Li.At=function(t,e){return xi.At(t.path,e.path)},Li.qt=function(t){return t.length%2==0},Li.Ut=function(t){return new Li(new xi(t.slice()))},Li);function Li(t){this.path=t}function Ci(){return null!==Ei&&Ei.apply(this,arguments)||this}function Ui(){return null!==_i&&_i.apply(this,arguments)||this}function Vi(t,e,n){void 0===e?e=0:e>t.length&&xr(),void 0===n?n=t.length-e:n>t.length-e&&xr(),this.segments=t,this.offset=e,this.It=n}function Mi(t){this.timestamp=t}function ji(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new qr(Fr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new qr(Fr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new qr(Fr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new qr(Fr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function Fi(t){var e=this;return(e=Ti.call(this,t)||this).forceLongPolling=t.forceLongPolling,e.k=t.k,e}function qi(t){this.rt=t,this.O=t.O;var e=t.ssl?"https":"http";this.ot=e+"://"+t.host,this.ct="projects/"+this.O.projectId+"/databases/"+this.O.database+"/documents"}function Bi(t){this.H=t.H,this.J=t.J}function Gi(t){var e,n=0;for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&n++;return n}function zi(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Hi(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var Ki=(Qi.prototype.Qt=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].vt(t))return!0;return!1},Qi.prototype.isEqual=function(t){return Cr(this.fields,t.fields,function(t,e){return t.isEqual(e)})},Qi),Wi=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Qi(t){(this.fields=t).sort(Pi.At)}function Yi(t){if(kr(!!t),"string"!=typeof t)return{seconds:Ji(t.seconds),nanos:Ji(t.nanos)};var e=0,n=Wi.exec(t);kr(!!n),n[1]&&(n=((n=n[1])+"000000000").substr(0,9),e=Number(n));t=new Date(t);return{seconds:Math.floor(t.getTime()/1e3),nanos:e}}function Ji(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Xi(t){return"string"==typeof t?Vr.fromBase64String(t):Vr.fromUint8Array(t)}function $i(t){return"server_timestamp"===(null===(t=((null===(t=null==t?void 0:t.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Zi(t){t=Yi(t.mapValue.fields.__local_write_time__.timestampValue);return new Oi(t.seconds,t.nanos)}function to(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?$i(t)?4:10:xr()}function eo(r,i){var t,e=to(r);if(e!==to(i))return!1;switch(e){case 0:return!0;case 1:return r.booleanValue===i.booleanValue;case 4:return Zi(r).isEqual(Zi(i));case 3:return function(t){if("string"==typeof r.timestampValue&&"string"==typeof t.timestampValue&&r.timestampValue.length===t.timestampValue.length)return r.timestampValue===t.timestampValue;var e=Yi(r.timestampValue),t=Yi(t.timestampValue);return e.seconds===t.seconds&&e.nanos===t.nanos}(i);case 5:return r.stringValue===i.stringValue;case 6:return t=i,Xi(r.bytesValue).isEqual(Xi(t.bytesValue));case 7:return r.referenceValue===i.referenceValue;case 8:return e=i,Ji((t=r).geoPointValue.latitude)===Ji(e.geoPointValue.latitude)&&Ji(t.geoPointValue.longitude)===Ji(e.geoPointValue.longitude);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Ji(t.integerValue)===Ji(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){t=Ji(t.doubleValue),e=Ji(e.doubleValue);return t===e?vi(t)===vi(e):isNaN(t)&&isNaN(e)}return!1}(r,i);case 9:return Cr(r.arrayValue.values||[],i.arrayValue.values||[],eo);case 10:return function(){var t,e=r.mapValue.fields||{},n=i.mapValue.fields||{};if(Gi(e)!==Gi(n))return!1;for(t in e)if(e.hasOwnProperty(t)&&(void 0===n[t]||!eo(e[t],n[t])))return!1;return!0}();default:return xr()}}function no(t,e){return void 0!==(t.values||[]).find(function(t){return eo(t,e)})}function ro(t,e){var n,r,i=to(t),o=to(e);if(i!==o)return Lr(i,o);switch(i){case 0:return 0;case 1:return Lr(t.booleanValue,e.booleanValue);case 2:return n=e,r=Ji(t.integerValue||t.doubleValue),n=Ji(n.integerValue||n.doubleValue),r<n?-1:n<r?1:r===n?0:isNaN(r)?isNaN(n)?0:-1:1;case 3:return io(t.timestampValue,e.timestampValue);case 4:return io(Zi(t),Zi(e));case 5:return Lr(t.stringValue,e.stringValue);case 6:return function(t,e){t=Xi(t),e=Xi(e);return t.u(e)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Lr(n[i],r[i]);if(0!==o)return o}return Lr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return i=t.geoPointValue,r=e.geoPointValue,0!==(n=Lr(Ji(i.latitude),Ji(r.latitude)))?n:Lr(Ji(i.longitude),Ji(r.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=ro(n[i],r[i]);if(o)return o}return Lr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=Lr(r[s],o[s]);if(0!==u)return u;u=ro(n[r[s]],i[o[s]]);if(0!==u)return u}return Lr(r.length,o.length)}(t.mapValue,e.mapValue);default:throw xr()}}function io(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Lr(t,e);var n=Yi(t),t=Yi(e),e=Lr(n.seconds,t.seconds);return 0!==e?e:Lr(n.nanos,t.nanos)}function oo(t){return function s(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){var t=Yi(t);return"time("+t.seconds+","+t.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?Xi(t.bytesValue).toBase64():"referenceValue"in t?(e=t.referenceValue,Ri.$t(e).toString()):"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=s(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+s(t.fields[o])}return e+"}"}(t.mapValue):xr();var e}(t)}function so(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.Ct()}}function uo(t){return t&&"integerValue"in t}function ao(t){return!!t&&"arrayValue"in t}function co(t){return t&&"nullValue"in t}function ho(t){return t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function fo(t){return t&&"mapValue"in t}var lo=(vo.empty=function(){return new vo({mapValue:{}})},vo.prototype.field=function(t){if(t.bt())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!fo(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.Vt()])||null},vo.prototype.isEqual=function(t){return eo(this.proto,t.proto)},vo),po=(yo.prototype.set=function(t,e){return this.jt(t,e),this},yo.prototype.delete=function(t){return this.jt(t,null),this},yo.prototype.jt=function(t,e){for(var n=this.Wt,r=0;r<t.length-1;++r)var i=t.get(r),o=n.get(i),n=(o instanceof Map||(o=o&&10===to(o)?new Map(Object.entries(o.mapValue.fields||{})):new Map,n.set(i,o)),o);n.set(t.Vt(),e)},yo.prototype.Gt=function(){var t=this.zt(Pi.Nt(),this.Wt);return null!=t?new lo(t):this.Kt},yo.prototype.zt=function(r,t){var i=this,o=!1,e=this.Kt.field(r),s=fo(e)?Object.assign({},e.mapValue.fields):{};return t.forEach(function(t,e){var n;t instanceof Map?null!=(n=i.zt(r.child(e),t))&&(s[e]=n,o=!0):null!==t?(s[e]=t,o=!0):s.hasOwnProperty(e)&&(delete s[e],o=!0)}),o?{mapValue:{fields:s}}:null},yo);function yo(t){void 0===t&&(t=lo.empty()),this.Kt=t,this.Wt=new Map}function vo(t){this.proto=t}var go,mo,wo,_e=function(t,e){this.key=t,this.version=e},bo=(h(No,wo=_e),No.prototype.field=function(t){return this.Ht.field(t)},No.prototype.data=function(){return this.Ht},No.prototype.Yt=function(){return this.Ht.proto},No.prototype.isEqual=function(t){return t instanceof No&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.Jt===t.Jt&&this.hasCommittedMutations===t.hasCommittedMutations&&this.Ht.isEqual(t.Ht)},No.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.Ht.toString()+", {hasLocalMutations: "+this.Jt+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(No.prototype,"hasPendingWrites",{get:function(){return this.Jt||this.hasCommittedMutations},enumerable:!1,configurable:!0}),No),Io=(h(Ao,mo=_e),Ao.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(Ao.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),Ao.prototype.isEqual=function(t){return t instanceof Ao&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Ao),Eo=(h(To,go=_e),To.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(To.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),To.prototype.isEqual=function(t){return t instanceof To&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},To),_o=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.Xt=null};function To(){return null!==go&&go.apply(this,arguments)||this}function Ao(t,e,n){var r=this;return(r=mo.call(this,t,e)||this).hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}function No(t,e,n,r){var i=this;return(i=wo.call(this,t,e)||this).Ht=n,i.Jt=!!r.Jt,i.hasCommittedMutations=!!r.hasCommittedMutations,i}function So(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new _o(t,e,n,r,i,o,s)}function Oo(t){var e=t;return null===e.Xt&&(t=e.path.Ct(),null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(function(t){return(t=t).field.Ct()+t.op.toString()+oo(t.value)}).join(","),t+="|ob:",t+=e.orderBy.map(function(t){return(t=t).field.Ct()+t.dir}).join(","),yi(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=rs(e.startAt)),e.endAt&&(t+="|ub:",t+=rs(e.endAt)),e.Xt=t),e.Xt}function Do(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n,r,i=0;i<t.orderBy.length;i++)if(n=t.orderBy[i],r=e.orderBy[i],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;if(t.filters.length!==e.filters.length)return!1;for(var o,s,u=0;u<t.filters.length;u++)if(o=t.filters[u],s=e.filters[u],o.op!==s.op||!o.field.isEqual(s.field)||!eo(o.value,s.value))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!ss(t.startAt,e.startAt)&&ss(t.endAt,e.endAt)}function xo(t){return Ri.qt(t.path)&&null===t.collectionGroup&&0===t.filters.length}var ko,Po=(h(Ro,ko=function(){}),Ro.create=function(t,e,n){return t.Ot()?"in"===e||"not-in"===e?this.Zt(t,e,n):new Vo(t,e,n):"array-contains"===e?new Qo(t,n):"in"===e?new Yo(t,n):"not-in"===e?new Jo(t,n):"array-contains-any"===e?new Xo(t,n):new Ro(t,e,n)},Ro.Zt=function(t,e,n){return new("in"===e?Mo:jo)(t,n)},Ro.prototype.matches=function(t){t=t.field(this.field);return"!="===this.op?null!==t&&this.te(ro(t,this.value)):null!==t&&to(this.value)===to(t)&&this.te(ro(t,this.value))},Ro.prototype.te=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return 0<t;case">=":return 0<=t;default:return xr()}},Ro.prototype.ee=function(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)},Ro);function Ro(t,e,n){var r=this;return(r=ko.call(this)||this).field=t,r.op=e,r.value=n,r}var Lo,Co,Uo,Vo=(h(Bo,Uo=Po),Bo.prototype.matches=function(t){t=Ri.At(t.key,this.key);return this.te(t)},Bo),Mo=(h(qo,Co=Po),qo.prototype.matches=function(e){return this.keys.some(function(t){return t.isEqual(e.key)})},qo),jo=(h(Fo,Lo=Po),Fo.prototype.matches=function(e){return!this.keys.some(function(t){return t.isEqual(e.key)})},Fo);function Fo(t,e){var n=this;return(n=Lo.call(this,t,"not-in",e)||this).keys=Go(0,e),n}function qo(t,e){var n=this;return(n=Co.call(this,t,"in",e)||this).keys=Go(0,e),n}function Bo(t,e,n){var r=this;return(r=Uo.call(this,t,e,n)||this).key=Ri.$t(n.referenceValue),r}function Go(t,e){return((null===(e=e.arrayValue)||void 0===e?void 0:e.values)||[]).map(function(t){return Ri.$t(t.referenceValue)})}var zo,Ho,Ko,Wo,Qo=(h(ns,Wo=Po),ns.prototype.matches=function(t){t=t.field(this.field);return ao(t)&&no(t.arrayValue,this.value)},ns),Yo=(h(es,Ko=Po),es.prototype.matches=function(t){t=t.field(this.field);return null!==t&&no(this.value.arrayValue,t)},es),Jo=(h(ts,Ho=Po),ts.prototype.matches=function(t){if(no(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;t=t.field(this.field);return null!==t&&!no(this.value.arrayValue,t)},ts),Xo=(h(Zo,zo=Po),Zo.prototype.matches=function(t){var e=this,t=t.field(this.field);return!(!ao(t)||!t.arrayValue.values)&&t.arrayValue.values.some(function(t){return no(e.value.arrayValue,t)})},Zo),$o=function(t,e){this.position=t,this.before=e};function Zo(t,e){return zo.call(this,t,"array-contains-any",e)||this}function ts(t,e){return Ho.call(this,t,"not-in",e)||this}function es(t,e){return Ko.call(this,t,"in",e)||this}function ns(t,e){return Wo.call(this,t,"array-contains",e)||this}function rs(t){return(t.before?"b":"a")+":"+t.position.map(oo).join(",")}var is=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function os(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i],r=o.field.Ot()?Ri.At(Ri.$t(s.referenceValue),n.key):ro(s,n.field(o.field));if("desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function ss(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!eo(t.position[n],e.position[n]))return!1;return!0}var us=function(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.ne=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=u,this.se=null,this.ie=null,this.startAt,this.endAt};function as(t,e,n,r,i,o,s,u){return new us(t,e,n,r,i,o,s,u)}function cs(t){return new us(t)}function hs(t){return!yi(t.limit)&&"F"===t.limitType}function fs(t){return!yi(t.limit)&&"L"===t.limitType}function ls(t){return 0<t.ne.length?t.ne[0].field:null}function ps(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.ee())return r.field}return null}function ds(t){return null!==t.collectionGroup}function ys(t){var e=t;if(null===e.se){e.se=[];var n=ps(e),t=ls(e);if(null!==n&&null===t)n.Ot()||e.se.push(new is(n)),e.se.push(new is(Pi.kt(),"asc"));else{for(var r=!1,i=0,o=e.ne;i<o.length;i++){var s=o[i];e.se.push(s),s.field.Ot()&&(r=!0)}r||(n=0<e.ne.length?e.ne[e.ne.length-1].dir:"asc",e.se.push(new is(Pi.kt(),n)))}}return e.se}function vs(t){var e=t;if(!e.ie)if("F"===e.limitType)e.ie=So(e.path,e.collectionGroup,ys(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=ys(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new is(o.field,s))}var u=e.endAt?new $o(e.endAt.position,!e.endAt.before):null,t=e.startAt?new $o(e.startAt.position,!e.startAt.before):null;e.ie=So(e.path,e.collectionGroup,n,e.filters,e.limit,u,t)}return e.ie}function gs(t,e,n){return new us(t.path,t.collectionGroup,t.ne.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function ms(t,e){return Do(vs(t),vs(e))&&t.limitType===e.limitType}function ws(t){return Oo(vs(t))+"|lt:"+t.limitType}function bs(t){return"Query(target="+(e=vs(t),n=e.path.Ct(),null!==e.collectionGroup&&(n+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(n+=", filters: ["+e.filters.map(function(t){return(t=t).field.Ct()+" "+t.op+" "+oo(t.value)}).join(", ")+"]"),yi(e.limit)||(n+=", limit: "+e.limit),0<e.orderBy.length&&(n+=", orderBy: ["+e.orderBy.map(function(t){return(t=t).field.Ct()+" ("+t.dir+")"}).join(", ")+"]"),e.startAt&&(n+=", startAt: "+rs(e.startAt)),e.endAt&&(n+=", endAt: "+rs(e.endAt)),"Target("+n+")")+"; limitType="+t.limitType+")";var e,n}function Is(i,t){return e=i,n=t.key.path,(null!==e.collectionGroup?t.key.Bt(e.collectionGroup)&&e.path.vt(n):Ri.qt(e.path)?e.path.isEqual(n):e.path.St(n))&&function(t){for(var e=0,n=i.ne;e<n.length;e++){var r=n[e];if(!r.field.Ot()&&null===t.field(r.field))return}return 1}(t)&&function(t){for(var e=0,n=i.filters;e<n.length;e++)if(!n[e].matches(t))return;return 1}(t)&&(n=t,(!(t=i).startAt||os(t.startAt,ys(t),n))&&(!t.endAt||!os(t.endAt,ys(t),n)));var e,n}function Es(u){return function(t,e){for(var n=!1,r=0,i=ys(u);r<i.length;r++){var o=i[r],s=function(t,r,e){e=t.field.Ot()?Ri.At(r.key,e.key):function(t,e){var n=r.field(t),t=e.field(t);return null!==n&&null!==t?ro(n,t):xr()}(t.field,e);switch(t.dir){case"asc":return e;case"desc":return-1*e;default:return xr()}}(o,t,e);if(0!==s)return s;n=n||o.field.Ot()}return 0}}var _s=(Ts.prototype.ce=function(t){return new Ts(this.target,this.targetId,this.re,t,this.oe,this.lastLimboFreeSnapshotVersion,this.resumeToken)},Ts.prototype.ae=function(t,e){return new Ts(this.target,this.targetId,this.re,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},Ts.prototype.ue=function(t){return new Ts(this.target,this.targetId,this.re,this.sequenceNumber,this.oe,t,this.resumeToken)},Ts);function Ts(t,e,n,r,i,o,s){void 0===i&&(i=Di.min()),void 0===o&&(o=Di.min()),void 0===s&&(s=Vr.h),this.target=t,this.targetId=e,this.re=n,this.sequenceNumber=r,this.oe=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function As(t,e){if(t.he){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:vi(e)?"-0":e}}function Ns(t){return{integerValue:""+t}}function Ss(t,e){return gi(e)?Ns(e):As(t,e)}o=function(){this.le=void 0};function Os(t,e){return t instanceof qs?uo(t=e)||t&&"doubleValue"in t?e:{integerValue:0}:null}var Ds,xs,ks=(h(Ls,xs=o),Ls),Ps=(h(Rs,Ds=o),Rs);function Rs(t){var e=this;return(e=Ds.call(this)||this).elements=t,e}function Ls(){return null!==xs&&xs.apply(this,arguments)||this}function Cs(t,e){for(var n=zs(e),r=0,i=t.elements;r<i.length;r++)!function(e){n.some(function(t){return eo(t,e)})||n.push(e)}(i[r]);return{arrayValue:{values:n}}}var Us,Vs=(h(Ms,Us=o),Ms);function Ms(t){var e=this;return(e=Us.call(this)||this).elements=t,e}function js(t,e){for(var n=zs(e),r=0,i=t.elements;r<i.length;r++)!function(e){n=n.filter(function(t){return!eo(t,e)})}(i[r]);return{arrayValue:{values:n}}}var Fs,qs=(h(Bs,Fs=o),Bs);function Bs(t,e){var n=this;return(n=Fs.call(this)||this).fe=t,n._e=e,n}function Gs(t){return Ji(t.integerValue||t.doubleValue)}function zs(t){return ao(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function Hs(t,e){this.version=t,this.transformResults=e}var Ks=function(t,e){this.field=t,this.transform=e},Ws=(Qs.de=function(){return new Qs},Qs.exists=function(t){return new Qs(void 0,t)},Qs.updateTime=function(t){return new Qs(t)},Object.defineProperty(Qs.prototype,"we",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),Qs.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},Qs);function Qs(t,e){this.updateTime=t,this.exists=e}function Ys(t,e){return void 0!==t.updateTime?e instanceof bo&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof bo}_e=function(){};function Js(t,e,n,r){return t instanceof eu?function(t,e,n,r){if(!Ys(t.Ee,e))return e;var i=t.value;t.fieldTransforms&&(r=uu(t.fieldTransforms,n,e,r),i=au(t.fieldTransforms,i,r));e=$s(e);return new bo(t.key,e,i,{Jt:!0})}(t,e,r,n):t instanceof nu?function(t,e,n,r){if(!Ys(t.Ee,e))return e;var i=$s(e),r=ou(t,e,uu(t.fieldTransforms,n,e,r));return new bo(t.key,i,r,{Jt:!0})}(t,e,r,n):(e=e,Ys((t=t).Ee,e)?new Io(t.key,Di.min()):e)}function Xs(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.Ee.isEqual(e.Ee)&&(n=t.fieldTransforms,r=e.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&Cr(n,r,function(t,e){return e=e,(t=t).field.isEqual(e.field)&&(t=t.transform,e=e.transform,t instanceof Ps&&e instanceof Ps||t instanceof Vs&&e instanceof Vs?Cr(t.elements,e.elements,eo):t instanceof qs&&e instanceof qs?eo(t._e,e._e):t instanceof ks&&e instanceof ks)})))&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.Te.isEqual(e.Te));var n,r}function $s(t){return t instanceof bo?t.version:Di.min()}var Zs,tu,eu=(h(iu,tu=_e),iu),nu=(h(ru,Zs=_e),ru);function ru(t,e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=Zs.call(this)||this).key=t,o.data=e,o.Te=n,o.Ee=r,o.fieldTransforms=i,o.type=1,o}function iu(t,e,n,r){void 0===r&&(r=[]);var i=this;return(i=tu.call(this)||this).key=t,i.value=e,i.Ee=n,i.fieldTransforms=r,i.type=0,i}function ou(t,e,n){var r,i,o;return i=t,e=r=e instanceof bo?e.data():lo.empty(),o=new po(e),i.Te.fields.forEach(function(t){var e;t.bt()||(null!==(e=i.data.field(t))?o.set(t,e):o.delete(t))}),r=o.Gt(),au(t.fieldTransforms,r,n)}function su(t,e,n){var r=[];kr(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,u=null;e instanceof bo&&(u=e.field(o.field)),r.push((o=s,s=u,u=n[i],o instanceof Ps?Cs(o,s):o instanceof Vs?js(o,s):u))}return r}function uu(t,e,n,r){for(var i,o=[],s=0,u=t;s<u.length;s++){var a=u[s],c=a.transform,h=null;n instanceof bo&&(h=n.field(a.field)),null===h&&r instanceof bo&&(h=r.field(a.field)),o.push((i=h,a=e,h=void 0,(c=c)instanceof ks?(h={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}},i&&(h.fields.__previous_value__=i),{mapValue:h}):c instanceof Ps?Cs(c,i):c instanceof Vs?js(c,i):(c=Os(h=c,i),i=Gs(c)+Gs(h._e),uo(c)&&uo(h._e)?Ns(i):As(h.fe,i))))}return o}function au(t,e,n){for(var r=new po(e),i=0;i<t.length;i++){var o=t[i];r.set(o.field,n[i])}return r.Gt()}function cu(t){this.count=t}var hu,fu,lu=(h(Iu,fu=_e),Iu),pu=(h(bu,hu=_e),bu),du=(wu.prototype.Ie=function(t,e){return new wu(this.At,this.root.Ie(t,e,this.At).copy(null,null,vu.me,null,null))},wu.prototype.remove=function(t){return new wu(this.At,this.root.remove(t,this.At).copy(null,null,vu.me,null,null))},wu.prototype.get=function(t){for(var e=this.root;!e.bt();){var n=this.At(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},wu.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.bt();){var r=this.At(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},wu.prototype.bt=function(){return this.root.bt()},Object.defineProperty(wu.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),wu.prototype.Ae=function(){return this.root.Ae()},wu.prototype.Re=function(){return this.root.Re()},wu.prototype.Pe=function(t){return this.root.Pe(t)},wu.prototype.forEach=function(n){this.Pe(function(t,e){return n(t,e),!1})},wu.prototype.toString=function(){var n=[];return this.Pe(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},wu.prototype.ye=function(t){return this.root.ye(t)},wu.prototype.ge=function(){return new yu(this.root,null,this.At,!1)},wu.prototype.Ve=function(t){return new yu(this.root,t,this.At,!1)},wu.prototype.pe=function(){return new yu(this.root,null,this.At,!0)},wu.prototype.be=function(t){return new yu(this.root,t,this.At,!0)},wu),yu=(mu.prototype.De=function(){var t=this.Se.pop(),e={key:t.key,value:t.value};if(this.ve)for(t=t.left;!t.bt();)this.Se.push(t),t=t.right;else for(t=t.right;!t.bt();)this.Se.push(t),t=t.left;return e},mu.prototype.Ce=function(){return 0<this.Se.length},mu.prototype.xe=function(){if(0===this.Se.length)return null;var t=this.Se[this.Se.length-1];return{key:t.key,value:t.value}},mu),vu=(gu.prototype.copy=function(t,e,n,r,i){return new gu(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},gu.prototype.bt=function(){return!1},gu.prototype.Pe=function(t){return this.left.Pe(t)||t(this.key,this.value)||this.right.Pe(t)},gu.prototype.ye=function(t){return this.right.ye(t)||t(this.key,this.value)||this.left.ye(t)},gu.prototype.min=function(){return this.left.bt()?this:this.left.min()},gu.prototype.Ae=function(){return this.min().key},gu.prototype.Re=function(){return this.right.bt()?this.key:this.right.Re()},gu.prototype.Ie=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.Ie(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.Ie(t,e,n))).Ne()},gu.prototype.Fe=function(){if(this.left.bt())return gu.EMPTY;var t=this;return t.left.Oe()||t.left.left.Oe()||(t=t.ke()),(t=t.copy(null,null,null,t.left.Fe(),null)).Ne()},gu.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.bt()||r.left.Oe()||r.left.left.Oe()||(r=r.ke()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.Oe()&&(r=r.Me()),r.right.bt()||r.right.Oe()||r.right.left.Oe()||(r=r.Le()),0===e(t,r.key)){if(r.right.bt())return gu.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.Fe())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.Ne()},gu.prototype.Oe=function(){return this.color},gu.prototype.Ne=function(){var t=this;return t.right.Oe()&&!t.left.Oe()&&(t=t.$e()),t.left.Oe()&&t.left.left.Oe()&&(t=t.Me()),t.left.Oe()&&t.right.Oe()&&(t=t.Be()),t},gu.prototype.ke=function(){var t=this.Be();return t.right.left.Oe()&&(t=(t=(t=t.copy(null,null,null,null,t.right.Me())).$e()).Be()),t},gu.prototype.Le=function(){var t=this.Be();return t.left.left.Oe()&&(t=(t=t.Me()).Be()),t},gu.prototype.$e=function(){var t=this.copy(null,null,gu.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},gu.prototype.Me=function(){var t=this.copy(null,null,gu.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},gu.prototype.Be=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},gu.prototype.qe=function(){var t=this.Ue();return Math.pow(2,t)<=this.size+1},gu.prototype.Ue=function(){if(this.Oe()&&this.left.Oe())throw xr();if(this.right.Oe())throw xr();var t=this.left.Ue();if(t!==this.right.Ue())throw xr();return t+(this.Oe()?0:1)},gu);function gu(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:gu.RED,this.left=null!=r?r:gu.EMPTY,this.right=null!=i?i:gu.EMPTY,this.size=this.left.size+1+this.right.size}function mu(t,e,n,r){this.ve=r,this.Se=[];for(var i=1;!t.bt();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.ve?t.left:t.right;else{if(0===i){this.Se.push(t);break}this.Se.push(t),t=this.ve?t.right:t.left}}function wu(t,e){this.At=t,this.root=e||vu.EMPTY}function bu(t,e){var n=this;return(n=hu.call(this)||this).key=t,n.Ee=e,n.type=3,n.fieldTransforms=[],n}function Iu(t,e){var n=this;return(n=fu.call(this)||this).key=t,n.Ee=e,n.type=2,n.fieldTransforms=[],n}function Eu(){this.size=0}vu.EMPTY=null,vu.RED=!0,vu.me=!1,vu.EMPTY=(Object.defineProperty(Eu.prototype,"key",{get:function(){throw xr()},enumerable:!1,configurable:!0}),Object.defineProperty(Eu.prototype,"value",{get:function(){throw xr()},enumerable:!1,configurable:!0}),Object.defineProperty(Eu.prototype,"color",{get:function(){throw xr()},enumerable:!1,configurable:!0}),Object.defineProperty(Eu.prototype,"left",{get:function(){throw xr()},enumerable:!1,configurable:!0}),Object.defineProperty(Eu.prototype,"right",{get:function(){throw xr()},enumerable:!1,configurable:!0}),Eu.prototype.copy=function(t,e,n,r,i){return this},Eu.prototype.Ie=function(t,e,n){return new vu(t,e)},Eu.prototype.remove=function(t,e){return this},Eu.prototype.bt=function(){return!0},Eu.prototype.Pe=function(t){return!1},Eu.prototype.ye=function(t){return!1},Eu.prototype.Ae=function(){return null},Eu.prototype.Re=function(){return null},Eu.prototype.Oe=function(){return!1},Eu.prototype.qe=function(){return!0},Eu.prototype.Ue=function(){return 0},new Eu);var _u=(Su.prototype.has=function(t){return null!==this.data.get(t)},Su.prototype.first=function(){return this.data.Ae()},Su.prototype.last=function(){return this.data.Re()},Object.defineProperty(Su.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),Su.prototype.indexOf=function(t){return this.data.indexOf(t)},Su.prototype.forEach=function(n){this.data.Pe(function(t,e){return n(t),!1})},Su.prototype.Qe=function(t,e){for(var n=this.data.Ve(t[0]);n.Ce();){var r=n.De();if(0<=this.At(r.key,t[1]))return;e(r.key)}},Su.prototype.Ke=function(t,e){for(var n=void 0!==e?this.data.Ve(e):this.data.ge();n.Ce();)if(!t(n.De().key))return},Su.prototype.We=function(t){t=this.data.Ve(t);return t.Ce()?t.De().key:null},Su.prototype.ge=function(){return new Tu(this.data.ge())},Su.prototype.Ve=function(t){return new Tu(this.data.Ve(t))},Su.prototype.add=function(t){return this.copy(this.data.remove(t).Ie(t,!0))},Su.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},Su.prototype.bt=function(){return this.data.bt()},Su.prototype.je=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},Su.prototype.isEqual=function(t){if(!(t instanceof Su))return!1;if(this.size!==t.size)return!1;for(var e=this.data.ge(),n=t.data.ge();e.Ce();){var r=e.De().key,i=n.De().key;if(0!==this.At(r,i))return!1}return!0},Su.prototype.Dt=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},Su.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},Su.prototype.copy=function(t){var e=new Su(this.At);return e.data=t,e},Su),Tu=(Nu.prototype.De=function(){return this.Ge.De().key},Nu.prototype.Ce=function(){return this.Ge.Ce()},Nu),Au=new du(Ri.At);function Nu(t){this.Ge=t}function Su(t){this.At=t,this.data=new du(this.At)}var Ou=new du(Ri.At);var Du=new du(Ri.At);var xu=new _u(Ri.At);function ku(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=xu,r=0,i=t;r<i.length;r++)var o=i[r],n=n.add(o);return n}var Pu=new _u(Lr);var Ru=(Yu.Je=function(t){return new Yu(t.At)},Yu.prototype.has=function(t){return null!=this.ze.get(t)},Yu.prototype.get=function(t){return this.ze.get(t)},Yu.prototype.first=function(){return this.He.Ae()},Yu.prototype.last=function(){return this.He.Re()},Yu.prototype.bt=function(){return this.He.bt()},Yu.prototype.indexOf=function(t){t=this.ze.get(t);return t?this.He.indexOf(t):-1},Object.defineProperty(Yu.prototype,"size",{get:function(){return this.He.size},enumerable:!1,configurable:!0}),Yu.prototype.forEach=function(n){this.He.Pe(function(t,e){return n(t),!1})},Yu.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.ze.Ie(t.key,t),e.He.Ie(t,null))},Yu.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.ze.remove(t),this.He.remove(e)):this},Yu.prototype.isEqual=function(t){if(!(t instanceof Yu))return!1;if(this.size!==t.size)return!1;for(var e=this.He.ge(),n=t.He.ge();e.Ce();){var r=e.De().key,i=n.De().key;if(!r.isEqual(i))return!1}return!0},Yu.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},Yu.prototype.copy=function(t,e){var n=new Yu;return n.At=this.At,n.ze=t,n.He=e,n},Yu),Lu=(Qu.prototype.track=function(t){var e=t.doc.key,n=this.Ye.get(e);!n||0!==t.type&&3===n.type?this.Ye=this.Ye.Ie(e,t):3===t.type&&1!==n.type?this.Ye=this.Ye.Ie(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Ye=this.Ye.Ie(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Ye=this.Ye.Ie(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Ye=this.Ye.remove(e):1===t.type&&2===n.type?this.Ye=this.Ye.Ie(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Ye=this.Ye.Ie(e,{type:2,doc:t.doc}):xr()},Qu.prototype.Xe=function(){var n=[];return this.Ye.Pe(function(t,e){n.push(e)}),n},Qu),Cu=(Wu.sn=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:0,doc:t})}),new Wu(t,e,Ru.Je(e),i,n,r,!0,!1)},Object.defineProperty(Wu.prototype,"hasPendingWrites",{get:function(){return!this.tn.bt()},enumerable:!1,configurable:!0}),Wu.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.en===t.en&&this.tn.isEqual(t.tn)&&ms(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.Ze.isEqual(t.Ze)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},Wu),Uu=(Ku.un=function(t,e){var n=new Map;return n.set(t,Vu.hn(t,e)),new Ku(Di.min(),n,Pu,Au,ku())},Ku),Vu=(Hu.hn=function(t,e){return new Hu(Vr.h,e,ku(),ku(),ku())},Hu),Mu=function(t,e,n,r){this.wn=t,this.removedTargetIds=e,this.key=n,this.En=r},ju=function(t,e){this.targetId=t,this.Tn=e},Fu=function(t,e,n,r){void 0===n&&(n=Vr.h),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},qu=(Object.defineProperty(zu.prototype,"ln",{get:function(){return this.Rn},enumerable:!1,configurable:!0}),Object.defineProperty(zu.prototype,"resumeToken",{get:function(){return this.An},enumerable:!1,configurable:!0}),Object.defineProperty(zu.prototype,"yn",{get:function(){return 0!==this.In},enumerable:!1,configurable:!0}),Object.defineProperty(zu.prototype,"gn",{get:function(){return this.Pn},enumerable:!1,configurable:!0}),zu.prototype.Vn=function(t){0<t.o()&&(this.Pn=!0,this.An=t)},zu.prototype.pn=function(){var n=ku(),r=ku(),i=ku();return this.mn.forEach(function(t,e){switch(e){case 0:n=n.add(t);break;case 2:r=r.add(t);break;case 1:i=i.add(t);break;default:xr()}}),new Vu(this.An,this.Rn,n,r,i)},zu.prototype.bn=function(){this.Pn=!1,this.mn=Xu()},zu.prototype.vn=function(t,e){this.Pn=!0,this.mn=this.mn.Ie(t,e)},zu.prototype.Sn=function(t){this.Pn=!0,this.mn=this.mn.remove(t)},zu.prototype.Dn=function(){this.In+=1},zu.prototype.Cn=function(){--this.In},zu.prototype.xn=function(){this.Pn=!0,this.Rn=!0},zu),Bu=(Gu.prototype.Ln=function(t){for(var e=0,n=t.wn;e<n.length;e++){var r=n[e];t.En instanceof bo?this.$n(r,t.En):t.En instanceof Io&&this.Bn(r,t.key,t.En)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.Bn(r,t.key,t.En)},Gu.prototype.qn=function(n){var r=this;this.Un(n,function(t){var e=r.Qn(t);switch(n.state){case 0:r.Kn(t)&&e.Vn(n.resumeToken);break;case 1:e.Cn(),e.yn||e.bn(),e.Vn(n.resumeToken);break;case 2:e.Cn(),e.yn||r.removeTarget(t);break;case 3:r.Kn(t)&&(e.xn(),e.Vn(n.resumeToken));break;case 4:r.Kn(t)&&(r.Wn(t),e.Vn(n.resumeToken));break;default:xr()}})},Gu.prototype.Un=function(t,n){var r=this;0<t.targetIds.length?t.targetIds.forEach(n):this.Fn.forEach(function(t,e){r.Kn(e)&&n(e)})},Gu.prototype.jn=function(t){var e=t.targetId,n=t.Tn.count,t=this.Gn(e);t&&(xo(t=t.target)?0===n?(t=new Ri(t.path),this.Bn(e,t,new Io(t,Di.min()))):kr(1===n):this.zn(e)!==n&&(this.Wn(e),this.Mn=this.Mn.add(e)))},Gu.prototype.Hn=function(r){var i=this,o=new Map;this.Fn.forEach(function(t,e){var n=i.Gn(e);n&&(t.ln&&xo(n.target)&&(n=new Ri(n.target.path),null!==i.On.get(n)||i.Jn(e,n)||i.Bn(e,n,new Io(n,r))),t.gn&&(o.set(e,t.pn()),t.bn()))});var s=ku();this.kn.forEach(function(t,e){var n=!0;e.Ke(function(t){t=i.Gn(t);return!t||2===t.re||(n=!1)}),n&&(s=s.add(t))});var t=new Uu(r,o,this.Mn,this.On,s);return this.On=Au,this.kn=Ju(),this.Mn=new _u(Lr),t},Gu.prototype.$n=function(t,e){var n;this.Kn(t)&&(n=this.Jn(t,e.key)?2:0,this.Qn(t).vn(e.key,n),this.On=this.On.Ie(e.key,e),this.kn=this.kn.Ie(e.key,this.Yn(e.key).add(t)))},Gu.prototype.Bn=function(t,e,n){var r;this.Kn(t)&&(r=this.Qn(t),this.Jn(t,e)?r.vn(e,1):r.Sn(e),this.kn=this.kn.Ie(e,this.Yn(e).delete(t)),n&&(this.On=this.On.Ie(e,n)))},Gu.prototype.removeTarget=function(t){this.Fn.delete(t)},Gu.prototype.zn=function(t){var e=this.Qn(t).pn();return this.Nn.Xn(t).size+e._n.size-e.dn.size},Gu.prototype.Dn=function(t){this.Qn(t).Dn()},Gu.prototype.Qn=function(t){var e=this.Fn.get(t);return e||(e=new qu,this.Fn.set(t,e)),e},Gu.prototype.Yn=function(t){var e=this.kn.get(t);return e||(e=new _u(Lr),this.kn=this.kn.Ie(t,e)),e},Gu.prototype.Kn=function(t){var e=null!==this.Gn(t);return e||Nr("WatchChangeAggregator","Detected inactive target",t),e},Gu.prototype.Gn=function(t){var e=this.Fn.get(t);return e&&e.yn?null:this.Nn.Zn(t)},Gu.prototype.Wn=function(e){var n=this;this.Fn.set(e,new qu),this.Nn.Xn(e).forEach(function(t){n.Bn(e,t,null)})},Gu.prototype.Jn=function(t,e){return this.Nn.Xn(t).has(e)},Gu);function Gu(t){this.Nn=t,this.Fn=new Map,this.On=Au,this.kn=Ju(),this.Mn=new _u(Lr)}function zu(){this.In=0,this.mn=Xu(),this.An=Vr.h,this.Rn=!1,this.Pn=!0}function Hu(t,e,n,r,i){this.resumeToken=t,this.ln=e,this._n=n,this.fn=r,this.dn=i}function Ku(t,e,n,r,i){this.oe=t,this.rn=e,this.on=n,this.cn=r,this.an=i}function Wu(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.Ze=n,this.docChanges=r,this.tn=i,this.fromCache=o,this.en=s,this.nn=u}function Qu(){this.Ye=new du(Ri.At)}function Yu(n){this.At=n?function(t,e){return n(t,e)||Ri.At(t.key,e.key)}:function(t,e){return Ri.At(t.key,e.key)},this.ze=Ou,this.He=new du(this.At)}function Ju(){return new du(Ri.At)}function Xu(){return new du(Ri.At)}var $u={asc:"ASCENDING",desc:"DESCENDING"},Zu={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ta=function(t,e){this.O=t,this.he=e};function ea(t,e){return t.he?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function na(t,e){return t.he?e.toBase64():e.toUint8Array()}function ra(t){return kr(!!t),Di.wt((t=Yi(t),new Oi(t.seconds,t.nanos)))}function ia(t,e){return new xi(["projects",t.projectId,"databases",t.database]).child("documents").child(e).Ct()}function oa(t){t=xi.xt(t);return kr(Ta(t)),t}function sa(t,e){return ia(t.O,e.path)}function ua(t,e){e=oa(e);if(e.get(1)!==t.O.projectId)throw new qr(Fr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+t.O.projectId);if(e.get(3)!==t.O.database)throw new qr(Fr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+t.O.database);return new Ri(fa(e))}function aa(t,e){return ia(t.O,e)}function ca(t){t=oa(t);return 4===t.length?xi.Nt():fa(t)}function ha(t){return new xi(["projects",t.O.projectId,"databases",t.O.database]).Ct()}function fa(t){return kr(4<t.length&&"documents"===t.get(4)),t.Pt(5)}function la(t,e,n){return{name:sa(t,e),fields:n.proto.mapValue.fields}}function pa(t,e,n){var r=ua(t,e.name),t=ra(e.updateTime),e=new lo({mapValue:{fields:e.fields}});return new bo(r,t,e,{hasCommittedMutations:!!n})}function da(t,e){var n,r,i;if(e instanceof eu)n={update:la(t,e.key,e.value)};else if(e instanceof lu)n={delete:sa(t,e.key)};else if(e instanceof nu)n={update:la(t,e.key,e.data),updateMask:(i=e.Te,r=[],i.fields.forEach(function(t){return r.push(t.Ct())}),{fieldPaths:r})};else{if(!(e instanceof pu))return xr();n={verify:sa(t,e.key)}}return 0<e.fieldTransforms.length&&(n.updateTransforms=e.fieldTransforms.map(function(t){var e=t.transform;if(e instanceof ks)return{fieldPath:t.field.Ct(),setToServerValue:"REQUEST_TIME"};if(e instanceof Ps)return{fieldPath:t.field.Ct(),appendMissingElements:{values:e.elements}};if(e instanceof Vs)return{fieldPath:t.field.Ct(),removeAllFromArray:{values:e.elements}};if(e instanceof qs)return{fieldPath:t.field.Ct(),increment:e._e};throw xr()})),e.Ee.we||(n.currentDocument=void 0!==(i=e.Ee).updateTime?{updateTime:(e=t,t=i.updateTime,ea(e,t.Tt()))}:void 0!==i.exists?{exists:i.exists}:xr()),n}function ya(e,t){var n=t.currentDocument?void 0!==(s=t.currentDocument).updateTime?Ws.updateTime(ra(s.updateTime)):void 0!==s.exists?Ws.exists(s.exists):Ws.de():Ws.de(),r=t.updateTransforms?t.updateTransforms.map(function(t){return function(t,e){var n,r=null;"setToServerValue"in e?(kr("REQUEST_TIME"===e.setToServerValue),r=new ks):"appendMissingElements"in e?(n=e.appendMissingElements.values||[],r=new Ps(n)):"removeAllFromArray"in e?(n=e.removeAllFromArray.values||[],r=new Vs(n)):"increment"in e?r=new qs(t,e.increment):xr();e=Pi.Mt(e.fieldPath);return new Ks(e,r)}(e,t)}):[];if(t.update){t.update.name;var i=ua(e,t.update.name),o=new lo({mapValue:{fields:t.update.fields}});if(t.updateMask){var s=(s=t.updateMask.fieldPaths||[],new Ki(s.map(function(t){return Pi.Mt(t)})));return new nu(i,o,s,n,r)}return new eu(i,o,n,r)}if(t.delete){r=ua(e,t.delete);return new lu(r,n)}if(t.verify){t=ua(e,t.verify);return new pu(t,n)}return xr()}function va(t,e){return{documents:[aa(t,e.path)]}}function ga(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=aa(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=aa(t,r.yt()),n.structuredQuery.from=[{collectionId:r.Vt()}]);r=function(t){if(0!==t.length){t=t.map(function(t){if("=="===t.op){if(ho(t.value))return{unaryFilter:{field:Ia(t.field),op:"IS_NAN"}};if(co(t.value))return{unaryFilter:{field:Ia(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(ho(t.value))return{unaryFilter:{field:Ia(t.field),op:"IS_NOT_NAN"}};if(co(t.value))return{unaryFilter:{field:Ia(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ia(t.field),op:(e=t.op,Zu[e]),value:t.value}};var e});return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}}(e.filters);r&&(n.structuredQuery.where=r);r=function(t){if(0!==t.length)return t.map(function(t){return{field:Ia((t=t).field),direction:(t=t.dir,$u[t])}})}(e.orderBy);r&&(n.structuredQuery.orderBy=r);r=e.limit,r=t.he||yi(r)?r:{value:r};return null!==r&&(n.structuredQuery.limit=r),e.startAt&&(n.structuredQuery.startAt=wa(e.startAt)),e.endAt&&(n.structuredQuery.endAt=wa(e.endAt)),n}function ma(t){var e=ca(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;0<r&&(kr(1===r),(s=n.from[0]).allDescendants?i=s.collectionId:e=e.child(s.collectionId));var o=[];n.where&&(o=function e(t){return t?void 0!==t.unaryFilter?[_a(t)]:void 0!==t.fieldFilter?[(n=t,Po.create(Ea(n.fieldFilter.field),function(){switch(n.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return xr()}}(),n.fieldFilter.value))]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e(t)}).reduce(function(t,e){return t.concat(e)}):xr():[];var n}(n.where));t=[];n.orderBy&&(t=n.orderBy.map(function(t){return new is(Ea((e=t).field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}());var e}));r=null;n.limit&&(r=yi(u="object"==typeof(u=n.limit)?u.value:u)?null:u);var s=null;n.startAt&&(s=ba(n.startAt));var u=null;return n.endAt&&(u=ba(n.endAt)),as(e,i,t,o,r,"F",s,u)}function wa(t){return{before:t.before,values:t.position}}function ba(t){var e=!!t.before,t=t.values||[];return new $o(t,e)}function Ia(t){return{fieldPath:t.Ct()}}function Ea(t){return Pi.Mt(t.fieldPath)}function _a(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Ea(t.unaryFilter.field);return Po.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=Ea(t.unaryFilter.field);return Po.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":n=Ea(t.unaryFilter.field);return Po.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":t=Ea(t.unaryFilter.field);return Po.create(t,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return xr()}}function Ta(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}function Aa(t){return new ta(t,!0)}var Na,Sa=(Ua.prototype.catch=function(t){return this.next(void 0,t)},Ua.prototype.next=function(r,i){var o=this;return this.ss&&xr(),this.ss=!0,this.ns?this.error?this.rs(i,this.error):this.os(r,this.result):new Ua(function(e,n){o.ts=function(t){o.os(r,t).next(e,n)},o.es=function(t){o.rs(i,t).next(e,n)}})},Ua.prototype.cs=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},Ua.prototype.us=function(t){try{var e=t();return e instanceof Ua?e:Ua.resolve(e)}catch(t){return Ua.reject(t)}},Ua.prototype.os=function(t,e){return t?this.us(function(){return t(e)}):Ua.resolve(e)},Ua.prototype.rs=function(t,e){return t?this.us(function(){return t(e)}):Ua.reject(e)},Ua.resolve=function(n){return new Ua(function(t,e){t(n)})},Ua.reject=function(n){return new Ua(function(t,e){e(n)})},Ua.hs=function(t){return new Ua(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},Ua.ls=function(t){for(var n=Ua.resolve(!1),e=0,r=t;e<r.length;e++)!function(e){n=n.next(function(t){return t?Ua.resolve(t):e()})}(r[e]);return n},Ua.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.hs(i)},Ua),Oa=(Ca.open=function(t,e,n,r){try{return new Ca(e,t.transaction(r,n))}catch(t){throw new ka(e,t)}},Object.defineProperty(Ca.prototype,"fs",{get:function(){return this._s.promise},enumerable:!1,configurable:!0}),Ca.prototype.abort=function(t){t&&this._s.reject(t),this.aborted||(Nr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},Ca.prototype.store=function(t){t=this.transaction.objectStore(t);return new Ma(t)},Ca),Da=(La.delete=function(t){return Nr("SimpleDb","Removing database:",t),Fa(window.indexedDB.deleteDatabase(t)).cs()},La.G=function(){if("undefined"==typeof indexedDB)return!1;if(La.Es())return!0;var t=p(),e=La.ws(t),n=0<e&&e<10,e=La.Ts(t),e=0<e&&e<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||e)},La.Es=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Is)},La.As=function(t,e){return t.store(e)},La.ws=function(t){t=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),t=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(t)},La.Ts=function(t){t=t.match(/Android ([\d.]+)/i),t=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(t)},La.prototype.Rs=function(o){return y(this,void 0,void 0,function(){var e,i=this;return v(this,function(t){switch(t.label){case 0:return this.db?[3,2]:(Nr("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(e,n){var r=indexedDB.open(i.name,i.version);r.onsuccess=function(t){t=t.target.result;e(t)},r.onblocked=function(){n(new ka(o,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=function(t){t=t.target.error;"VersionError"===t.name?n(new qr(Fr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):n(new ka(o,t))},r.onupgradeneeded=function(t){Nr("SimpleDb",'Database "'+i.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;i.ds.Ps(e,r.transaction,t.oldVersion,i.version).next(function(){Nr("SimpleDb","Database upgrade to version "+i.version+" complete")})}})]);case 1:e.db=t.sent(),t.label=2;case 2:return[2,(this.ys&&(this.db.onversionchange=function(t){return i.ys(t)}),this.db)]}})})},La.prototype.gs=function(e){this.ys=e,this.db&&(this.db.onversionchange=function(t){return e(t)})},La.prototype.runTransaction=function(u,n,a,c){return y(this,void 0,void 0,function(){var i,o,s,e;return v(this,function(t){switch(t.label){case 0:i="readonly"===n,o=0,e=function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:++o,t.label=1;case 1:return t.trys.push([1,4,,5]),[4,s.Rs(u)];case 2:return s.db=t.sent(),e=Oa.open(s.db,u,i?"readonly":"readwrite",a),n=c(e).catch(function(t){return e.abort(t),Sa.reject(t)}).cs(),r={},n.catch(function(){}),[4,e.fs];case 3:return[2,(r.value=(t.sent(),n),r)];case 4:return n=t.sent(),r="FirebaseError"!==n.name&&o<3,Nr("SimpleDb","Transaction failed with error:",n.message,"Retrying:",r),s.close(),r?[3,5]:[2,{value:Promise.reject(n)}];case 5:return[2]}})},s=this,t.label=1;case 1:return[5,e()];case 2:if("object"==typeof(e=t.sent()))return[2,e.value];t.label=3;case 3:return[3,1];case 4:return[2]}})})},La.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},La),xa=(Object.defineProperty(Ra.prototype,"ns",{get:function(){return this.ps},enumerable:!1,configurable:!0}),Object.defineProperty(Ra.prototype,"vs",{get:function(){return this.bs},enumerable:!1,configurable:!0}),Object.defineProperty(Ra.prototype,"cursor",{set:function(t){this.Vs=t},enumerable:!1,configurable:!0}),Ra.prototype.done=function(){this.ps=!0},Ra.prototype.Ss=function(t){this.bs=t},Ra.prototype.delete=function(){return Fa(this.Vs.delete())},Ra),ka=(h(Pa,Na=qr),Pa);function Pa(t,e){var n=this;return(n=Na.call(this,Fr.UNAVAILABLE,"IndexedDB transaction '"+t+"' failed: "+e)||this).name="IndexedDbTransactionError",n}function Ra(t){this.Vs=t,this.ps=!1,this.bs=null}function La(t,e,n){this.name=t,this.version=e,this.ds=n,12.2===La.ws(p())&&Sr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function Ca(e,t){var n=this;this.action=e,this.transaction=t,this.aborted=!1,this._s=new Ni,this.transaction.oncomplete=function(){n._s.resolve()},this.transaction.onabort=function(){t.error?n._s.reject(new ka(e,t.error)):n._s.resolve()},this.transaction.onerror=function(t){t=Ba(t.target.error);n._s.reject(new ka(e,t))}}function Ua(t){var e=this;this.ts=null,this.es=null,this.result=void 0,this.error=void 0,this.ns=!1,this.ss=!1,t(function(t){e.ns=!0,e.result=t,e.ts&&e.ts(t)},function(t){e.ns=!0,e.error=t,e.es&&e.es(t)})}function Va(t){return"IndexedDbTransactionError"===t.name}var Ma=(ja.prototype.put=function(t,e){t=void 0!==e?(Nr("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(Nr("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t));return Fa(t)},ja.prototype.add=function(t){return Nr("SimpleDb","ADD",this.store.name,t,t),Fa(this.store.add(t))},ja.prototype.get=function(e){var n=this;return Fa(this.store.get(e)).next(function(t){return void 0===t&&(t=null),Nr("SimpleDb","GET",n.store.name,e,t),t})},ja.prototype.delete=function(t){return Nr("SimpleDb","DELETE",this.store.name,t),Fa(this.store.delete(t))},ja.prototype.count=function(){return Nr("SimpleDb","COUNT",this.store.name),Fa(this.store.count())},ja.prototype.Ds=function(t,e){var e=this.cursor(this.options(t,e)),n=[];return this.Cs(e,function(t,e){n.push(e)}).next(function(){return n})},ja.prototype.xs=function(t,e){Nr("SimpleDb","DELETE ALL",this.store.name);e=this.options(t,e);e.Ns=!1;e=this.cursor(e);return this.Cs(e,function(t,e,n){return n.delete()})},ja.prototype.Fs=function(t,e){e?n=t:(n={},e=t);var n=this.cursor(n);return this.Cs(n,e)},ja.prototype.Os=function(r){var t=this.cursor({});return new Sa(function(n,e){t.onerror=function(t){t=Ba(t.target.error);e(t)},t.onsuccess=function(t){var e=t.target.result;e?r(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},ja.prototype.Cs=function(t,i){var o=[];return new Sa(function(r,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e,n=t.target.result;n?(e=new xa(n),(t=i(n.primaryKey,n.value,e))instanceof Sa&&(t=t.catch(function(t){return e.done(),Sa.reject(t)}),o.push(t)),e.ns?r():null===e.vs?n.continue():n.continue(e.vs)):r()}}).next(function(){return Sa.hs(o)})},ja.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},ja.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.Ns?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},ja);function ja(t){this.store=t}function Fa(t){return new Sa(function(e,n){t.onsuccess=function(t){t=t.target.result;e(t)},t.onerror=function(t){t=Ba(t.target.error);n(t)}})}var qa=!1;function Ba(t){var e=Da.ws(p());if(12.2<=e&&e<13){e="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(e)){var n=new qr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+e+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return qa||(qa=!0,setTimeout(function(){throw n},0)),n}}return t}var Ga=(za.qs=function(t,e,n,r,i){i=new za(t,e,Date.now()+n,r,i);return i.start(n),i},za.prototype.start=function(t){var e=this;this.Us=setTimeout(function(){return e.Qs()},t)},za.prototype.Ks=function(){return this.Qs()},za.prototype.cancel=function(t){null!==this.Us&&(this.clearTimeout(),this.Bs.reject(new qr(Fr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},za.prototype.Qs=function(){var e=this;this.ks.Ws(function(){return null!==e.Us?(e.clearTimeout(),e.op().then(function(t){return e.Bs.resolve(t)})):Promise.resolve()})},za.prototype.clearTimeout=function(){null!==this.Us&&(this.$s(this),clearTimeout(this.Us),this.Us=null)},za);function za(t,e,n,r,i){this.ks=t,this.Ms=e,this.Ls=n,this.op=r,this.$s=i,this.Bs=new Ni,this.then=this.Bs.promise.then.bind(this.Bs.promise),this.Bs.promise.catch(function(t){})}function Ha(t,e){if(Sr("AsyncQueue",e+": "+t),Va(t))return new qr(Fr.UNAVAILABLE,e+": "+t);throw t}var Ka,Wa,Qa,Ya=(ac.prototype.reset=function(){this.Js=0},ac.prototype.Zs=function(){this.Js=this.Hs},ac.prototype.ti=function(t){var e=this;this.cancel();var n=Math.floor(this.Js+this.ei()),r=Math.max(0,Date.now()-this.Xs),i=Math.max(0,n-r);0<i&&Nr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.Js+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ys=this.js.ni(this.Ms,i,function(){return e.Xs=Date.now(),t()}),this.Js*=this.zs,this.Js<this.Gs&&(this.Js=this.Gs),this.Js>this.Hs&&(this.Js=this.Hs)},ac.prototype.si=function(){null!==this.Ys&&(this.Ys.Ks(),this.Ys=null)},ac.prototype.cancel=function(){null!==this.Ys&&(this.Ys.cancel(),this.Ys=null)},ac.prototype.ei=function(){return(Math.random()-.5)*this.Js},ac),o=(uc.prototype.hi=function(){return 1===this.state||2===this.state||4===this.state},uc.prototype.li=function(){return 2===this.state},uc.prototype.start=function(){3!==this.state?this.auth():this._i()},uc.prototype.stop=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.hi()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},uc.prototype.fi=function(){this.state=0,this.ui.reset()},uc.prototype.di=function(){var t=this;this.li()&&null===this.ai&&(this.ai=this.js.ni(this.ii,6e4,function(){return t.wi()}))},uc.prototype.Ei=function(t){this.Ti(),this.stream.send(t)},uc.prototype.wi=function(){return y(this,void 0,void 0,function(){return v(this,function(t){return this.li()?[2,this.close(0)]:[2]})})},uc.prototype.Ti=function(){this.ai&&(this.ai.cancel(),this.ai=null)},uc.prototype.close=function(e,n){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Ti(),this.ui.cancel(),this.ci++,3!==e?this.ui.reset():n&&n.code===Fr.RESOURCE_EXHAUSTED?(Sr(n.toString()),Sr("Using maximum backoff delay to prevent overloading the backend."),this.ui.Zs()):n&&n.code===Fr.UNAUTHENTICATED&&this.oi.g(),null!==this.stream&&(this.Ii(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.Z(n)];case 1:return t.sent(),[2]}})})},uc.prototype.Ii=function(){},uc.prototype.auth=function(){var n=this;this.state=1;var t=this.mi(this.ci),e=this.ci;this.oi.getToken().then(function(t){n.ci===e&&n.Ai(t)},function(e){t(function(){var t=new qr(Fr.UNKNOWN,"Fetching auth token failed: "+e.message);return n.Ri(t)})})},uc.prototype.Ai=function(t){var e=this,n=this.mi(this.ci);this.stream=this.Pi(t),this.stream.Y(function(){n(function(){return e.state=2,e.listener.Y()})}),this.stream.Z(function(t){n(function(){return e.Ri(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},uc.prototype._i=function(){var t=this;this.state=4,this.ui.ti(function(){return y(t,void 0,void 0,function(){return v(this,function(t){return this.state=0,this.start(),[2]})})})},uc.prototype.Ri=function(t){return Nr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},uc.prototype.mi=function(e){var n=this;return function(t){n.js.Ws(function(){return n.ci===e?t():(Nr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},uc),Ja=(h(sc,Qa=o),sc.prototype.Pi=function(t){return this.ri.ft("Listen",t)},sc.prototype.onMessage=function(t){this.ui.reset();var e=function(t,e){if("targetChange"in e){e.targetChange;var n="NO_CHANGE"===(o=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===o?1:"REMOVE"===o?2:"CURRENT"===o?3:"RESET"===o?4:xr(),r=e.targetChange.targetIds||[],i=(s=e.targetChange.resumeToken,t.he?(kr(void 0===s||"string"==typeof s),Vr.fromBase64String(s||"")):(kr(void 0===s||s instanceof Uint8Array),Vr.fromUint8Array(s||new Uint8Array))),o=(u=e.targetChange.cause)&&(a=void 0===(c=u).code?Fr.UNKNOWN:Ii(c.code),new qr(a,c.message||"")),s=new Fu(n,r,i,o||null)}else if("documentChange"in e){e.documentChange,(n=e.documentChange).document,n.document.name,n.document.updateTime,r=ua(t,n.document.name),i=ra(n.document.updateTime);var u=new lo({mapValue:{fields:n.document.fields}}),a=(o=new bo(r,i,u,{}),n.targetIds||[]),c=n.removedTargetIds||[];s=new Mu(a,c,o.key,o)}else if("documentDelete"in e)e.documentDelete,(n=e.documentDelete).document,r=ua(t,n.document),i=n.readTime?ra(n.readTime):Di.min(),u=new Io(r,i),o=n.removedTargetIds||[],s=new Mu([],o,u.key,u);else if("documentRemove"in e)e.documentRemove,(n=e.documentRemove).document,r=ua(t,n.document),i=n.removedTargetIds||[],s=new Mu([],i,r,null);else{if(!("filter"in e))return xr();e.filter;e=e.filter;e.targetId,n=e.count||0,r=new cu(n),i=e.targetId,s=new ju(i,r)}return s}(this.fe,t),t=function(t){if(!("targetChange"in t))return Di.min();t=t.targetChange;return(!t.targetIds||!t.targetIds.length)&&t.readTime?ra(t.readTime):Di.min()}(t);return this.listener.yi(e,t)},sc.prototype.gi=function(t){var e,n,r,i={};i.database=ha(this.fe),i.addTarget=(e=this.fe,(r=xo(r=(n=t).target)?{documents:va(e,r)}:{query:ga(e,r)}).targetId=n.targetId,0<n.resumeToken.o()?r.resumeToken=na(e,n.resumeToken):0<n.oe.u(Di.min())&&(r.readTime=ea(e,n.oe.Tt())),r);var o,t=(this.fe,o=t,null==(t=function(){switch(o.re){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return xr()}}())?null:{"goog-listen-tags":t});t&&(i.labels=t),this.Ei(i)},sc.prototype.Vi=function(t){var e={};e.database=ha(this.fe),e.removeTarget=t,this.Ei(e)},sc),Xa=(h(oc,Wa=o),Object.defineProperty(oc.prototype,"bi",{get:function(){return this.pi},enumerable:!1,configurable:!0}),oc.prototype.start=function(){this.pi=!1,this.lastStreamToken=void 0,Wa.prototype.start.call(this)},oc.prototype.Ii=function(){this.pi&&this.vi([])},oc.prototype.Pi=function(t){return this.ri.ft("Write",t)},oc.prototype.onMessage=function(t){if(kr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.pi){this.ui.reset();var e=(n=t.writeResults,r=t.commitTime,n&&0<n.length?(kr(void 0!==r),n.map(function(t){return function(t,e){var n=t.updateTime?ra(t.updateTime):ra(e);n.isEqual(Di.min())&&(n=ra(e));e=null;return t.transformResults&&0<t.transformResults.length&&(e=t.transformResults),new Hs(n,e)}(t,r)})):[]),n=ra(t.commitTime);return this.listener.Si(n,e)}var n,r;return kr(!t.writeResults||0===t.writeResults.length),this.pi=!0,this.listener.Di()},oc.prototype.Ci=function(){var t={};t.database=ha(this.fe),this.Ei(t)},oc.prototype.vi=function(t){var e=this,t={streamToken:this.lastStreamToken,writes:t.map(function(t){return da(e.fe,t)})};this.Ei(t)},oc),$a=(h(ic,Ka=function(){}),ic.prototype.Ni=function(){if(this.xi)throw new qr(Fr.FAILED_PRECONDITION,"The client has already been terminated.")},ic.prototype.at=function(e,n,r){var i=this;return this.Ni(),this.credentials.getToken().then(function(t){return i.ri.at(e,n,r,t)}).catch(function(t){throw t.code===Fr.UNAUTHENTICATED&&i.credentials.g(),t})},ic.prototype._t=function(e,n,r){var i=this;return this.Ni(),this.credentials.getToken().then(function(t){return i.ri._t(e,n,r,t)}).catch(function(t){throw t.code===Fr.UNAUTHENTICATED&&i.credentials.g(),t})},ic.prototype.terminate=function(){this.xi=!1},ic),Za="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",_e=(rc.prototype.Oi=function(t){this.Fi.push(t)},rc.prototype.ki=function(){this.Fi.forEach(function(t){return t()})},rc),tc={Mi:!1,Li:0,$i:0,Bi:0},ec=(nc.Ki=function(t){return new nc(t,nc.Wi,nc.ji)},nc);function nc(t,e,n){this.qi=t,this.Ui=e,this.Qi=n}function rc(){this.Fi=[]}function ic(t,e,n){var r=this;return(r=Ka.call(this)||this).credentials=t,r.ri=e,r.fe=n,r.xi=!1,r}function oc(t,e,n,r,i){var o=this;return(o=Wa.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this).fe=r,o.pi=!1,o}function sc(t,e,n,r,i){var o=this;return(o=Qa.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this).fe=r,o}function uc(t,e,n,r,i,o){this.js=t,this.ii=n,this.ri=r,this.oi=i,this.listener=o,this.state=0,this.ci=0,this.ai=null,this.stream=null,this.ui=new Ya(t,e)}function ac(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.js=t,this.Ms=e,this.Gs=n,this.zs=r,this.Hs=i,this.Js=0,this.Ys=null,this.Xs=Date.now(),this.reset()}ec.Wi=10,ec.ji=1e3,ec.Gi=new ec(41943040,ec.Wi,ec.ji),ec.zi=new ec(-1,0,0);var cc=(hc.prototype.Ji=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},hc.prototype.next=function(){var t=++this.previousValue;return this.Yi&&this.Yi(t),t},hc);function hc(t,e){var n=this;this.previousValue=t,e&&(e.Hi=function(t){return n.Ji(t)},this.Yi=function(t){return e.Xi(t)})}function fc(e){return y(this,void 0,void 0,function(){return v(this,function(t){if(e.code!==Fr.FAILED_PRECONDITION||e.message!==Za)throw e;return Nr("LocalStore","Unexpectedly lost primary lease"),[2]})})}cc.Zi=-1;function lc(t,e){this.progress=t,this.tr=e}var pc=(wc.prototype.nr=function(t,e,n){for(var r,i,o,s,u,a,c=n.sr,h=0;h<this.mutations.length;h++){var f=this.mutations[h];f.key.isEqual(t)&&(r=f,i=e,o=c[h],f=a=u=s=void 0,e=r instanceof eu?(u=o,f=(s=r).value,u.transformResults&&(a=su(s.fieldTransforms,i,u.transformResults),f=au(s.fieldTransforms,f,a)),new bo(s.key,u.version,f,{hasCommittedMutations:!0})):r instanceof nu?function(t,e,n){if(!Ys(t.Ee,e))return new Eo(t.key,n.version);e=ou(t,e,n.transformResults?su(t.fieldTransforms,e,n.transformResults):[]);return new bo(t.key,n.version,e,{hasCommittedMutations:!0})}(r,i,o):new Io(r.key,o.version,{hasCommittedMutations:!0}))}return e},wc.prototype.ir=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];i.key.isEqual(t)&&(e=Js(i,e,e,this.er))}for(var o=e,s=0,u=this.mutations;s<u.length;s++){var a=u[s];a.key.isEqual(t)&&(e=Js(a,e,o,this.er))}return e},wc.prototype.rr=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.ir(t.key,n.get(t.key));e&&(i=i.Ie(t.key,e))}),i},wc.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},ku())},wc.prototype.isEqual=function(t){return this.batchId===t.batchId&&Cr(this.mutations,t.mutations,Xs)&&Cr(this.baseMutations,t.baseMutations,Xs)},wc),dc=(mc.from=function(t,e,n){kr(t.mutations.length===n.length);for(var r=Du,i=t.mutations,o=0;o<i.length;o++)r=r.Ie(i[o].key,n[o].version);return new mc(t,e,n,r)},mc),yc=(gc.prototype.get=function(t){var e=this.ur(t),e=this.lr[e];if(void 0!==e)for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],i=i[1];if(this.hr(o,t))return i}},gc.prototype.has=function(t){return void 0!==this.get(t)},gc.prototype.set=function(t,e){var n=this.ur(t),r=this.lr[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.hr(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.lr[n]=[[t,e]]},gc.prototype.delete=function(t){var e=this.ur(t),n=this.lr[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.hr(n[r][0],t))return 1===n.length?delete this.lr[e]:n.splice(r,1),!0;return!1},gc.prototype.forEach=function(s){zi(this.lr,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],i=i[1];s(o,i)}})},gc.prototype.bt=function(){return Hi(this.lr)},gc),o=(vc.prototype.wr=function(t){t=this._r.get(t);return t?t.readTime:Di.min()},vc.prototype.Er=function(t,e){this.Tr(),this._r.set(t.key,{Ir:t,readTime:e})},vc.prototype.mr=function(t,e){void 0===e&&(e=null),this.Tr(),this._r.set(t,{Ir:null,readTime:e})},vc.prototype.Ar=function(t,e){this.Tr();var n=this._r.get(e);return void 0!==n?Sa.resolve(n.Ir):this.Rr(t,e)},vc.prototype.getEntries=function(t,e){return this.Pr(t,e)},vc.prototype.apply=function(t){return this.Tr(),this.dr=!0,this.yr(t)},vc.prototype.Tr=function(){},vc);function vc(){this._r=new yc(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.dr=!1}function gc(t,e){this.ur=t,this.hr=e,this.lr={}}function mc(t,e,n,r){this.batch=t,this.cr=e,this.sr=n,this.ar=r}function wc(t,e,n,r){this.batchId=t,this.er=e,this.baseMutations=n,this.mutations=r}function bc(t,e){var n=t[0],r=t[1],t=e[0],e=e[1],t=Lr(n,t);return 0===t?Lr(r,e):t}var Ic=(Nc.prototype.pr=function(){return++this.Vr},Nc.prototype.br=function(t){var e=[t,this.pr()];this.buffer.size<this.gr?this.buffer=this.buffer.add(e):bc(e,t=this.buffer.last())<0&&(this.buffer=this.buffer.delete(t).add(e))},Object.defineProperty(Nc.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),Nc),Ec=(Ac.prototype.start=function(t){-1!==this.vr.params.qi&&this.Cr(t)},Ac.prototype.stop=function(){this.Dr&&(this.Dr.cancel(),this.Dr=null)},Object.defineProperty(Ac.prototype,"Nr",{get:function(){return null!==this.Dr},enumerable:!1,configurable:!0}),Ac.prototype.Cr=function(n){var t=this,e=this.Sr?3e5:6e4;Nr("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.Dr=this.ks.ni("lru_garbage_collection",e,function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:this.Dr=null,this.Sr=!0,t.label=1;case 1:return t.trys.push([1,3,,7]),[4,n.Fr(this.vr)];case 2:return t.sent(),[3,7];case 3:return Va(e=t.sent())?(Nr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,fc(e)];case 5:t.sent(),t.label=6;case 6:return[3,7];case 7:return[4,this.Cr(n)];case 8:return t.sent(),[2]}})})})},Ac),_c=(Tc.prototype.kr=function(t,e){return this.Or.Mr(t).next(function(t){return Math.floor(e/100*t)})},Tc.prototype.Lr=function(t,e){var n=this;if(0===e)return Sa.resolve(cc.Zi);var r=new Ic(e);return this.Or.Un(t,function(t){return r.br(t.sequenceNumber)}).next(function(){return n.Or.$r(t,function(t){return r.br(t)})}).next(function(){return r.maxValue})},Tc.prototype.Br=function(t,e,n){return this.Or.Br(t,e,n)},Tc.prototype.qr=function(t,e){return this.Or.qr(t,e)},Tc.prototype.Ur=function(e,n){var r=this;return-1===this.params.qi?(Nr("LruGarbageCollector","Garbage collection skipped; disabled"),Sa.resolve(tc)):this.Qr(e).next(function(t){return t<r.params.qi?(Nr("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.params.qi),tc):r.Kr(e,n)})},Tc.prototype.Qr=function(t){return this.Or.Qr(t)},Tc.prototype.Kr=function(e,n){var r,i,o,s,u,a,c,h=this,f=Date.now();return this.kr(e,this.params.Ui).next(function(t){return i=t>h.params.Qi?(Nr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.Qi+" from "+t),h.params.Qi):t,s=Date.now(),h.Lr(e,i)}).next(function(t){return r=t,u=Date.now(),h.Br(e,r,n)}).next(function(t){return o=t,a=Date.now(),h.qr(e,r)}).next(function(t){return c=Date.now(),Ar()<=l.DEBUG&&Nr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-f)+"ms\n\tDetermined least recently used "+i+" in "+(u-s)+"ms\n\tRemoved "+o+" targets in "+(a-u)+"ms\n\tRemoved "+t+" documents in "+(c-a)+"ms\nTotal Duration: "+(c-f)+"ms"),Sa.resolve({Mi:!0,Li:i,$i:o,Bi:t})})},Tc);function Tc(t,e){this.Or=t,this.params=e}function Ac(t,e){this.vr=t,this.ks=e,this.Sr=!1,this.Dr=null}function Nc(t){this.gr=t,this.buffer=new _u(bc),this.Vr=0}function Sc(t,e,n){if(!n)throw new qr(Fr.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function Oc(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new qr(Fr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function Dc(t,e,n,r){if(!0===e&&!0===r)throw new qr(Fr.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function xc(t){if(!Ri.qt(t))throw new qr(Fr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function kc(t){if(Ri.qt(t))throw new qr(Fr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function Pc(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":xr();if(e instanceof Array)return"an array";var t=function(){if(e.constructor){var t=/function\s+([^\s(]+)\s*\(/.exec(e.constructor.toString());if(t&&1<t.length)return t[1]}return null}();return t?"a custom "+t+" object":"an object"}function Rc(t,e){if("_delegate"in t&&(t=t._),t instanceof e)return t;if(e.name===t.constructor.name)throw new qr(Fr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");t=Pc(t);throw new qr(Fr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+t)}function Lc(t,e){if(e<=0)throw new qr(Fr.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var Cc=(jc.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},jc),Uc=new Map,Vc=(Object.defineProperty(Mc.prototype,"app",{get:function(){if(!this.Jr)throw new qr(Fr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Jr},enumerable:!1,configurable:!0}),Object.defineProperty(Mc.prototype,"Yr",{get:function(){return this.Gr},enumerable:!1,configurable:!0}),Object.defineProperty(Mc.prototype,"Xr",{get:function(){return void 0!==this.Zr},enumerable:!1,configurable:!0}),Mc.prototype.eo=function(t){if(this.Gr)throw new qr(Fr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this.jr=new Cc(t),void 0!==t.credentials&&(this.Hr=function(t){if(!t)return new ti;switch(t.type){case"gapi":var e=t.client;return kr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new ri(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new qr(Fr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},Mc.prototype.no=function(){return this.jr},Mc.prototype.so=function(){return this.Gr=!0,this.jr},Mc.prototype._delete=function(){return this.Zr||(this.Zr=this.io()),this.Zr},Mc.prototype.io=function(){return(t=Uc.get(this))&&(Nr("ComponentProvider","Removing Datastore"),Uc.delete(this),t.terminate()),Promise.resolve();var t},Mc);function Mc(t,e){this.Wr="(lite)",this.jr=new Cc({}),this.Gr=!1,t instanceof oi?(this.zr=t,this.Hr=new ti):(this.Jr=t,this.zr=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new qr(Fr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new oi(t.options.projectId)}(t),this.Hr=new ei(e))}function jc(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new qr(Fr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new qr(Fr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,Dc("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}function Fc(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=qc(e)),e=function(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}(t.get(n),e);return qc(e)}function qc(t){return t+"\x01\x01"}function Bc(t){var e=t.length;if(kr(2<=e),2===e)return kr("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),xi.Nt();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("\x01",o);switch((s<0||n<s)&&xr(),t.charAt(s+1)){case"\x01":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=""),r.push(a);break;case"\x10":i+=t.substring(o,s),i+="\0";break;case"\x11":i+=t.substring(o,s+1);break;default:xr()}o=s+2}return new xi(r)}function Gc(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}var zc=function(t,e){this.seconds=t,this.nanoseconds=e};Gc.store="owner",Gc.key="owner";function Hc(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}Hc.store="mutationQueues",Hc.keyPath="userId";function Kc(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}Kc.store="mutations",Kc.keyPath="batchId",Kc.userMutationsIndex="userMutationsIndex",Kc.userMutationsKeyPath=["userId","batchId"];var Wc=(Qc.prefixForUser=function(t){return[t]},Qc.prefixForPath=function(t,e){return[t,Fc(e)]},Qc.key=function(t,e,n){return[t,Fc(e),n]},Qc);function Qc(){}Wc.store="documentMutations",Wc.PLACEHOLDER=new Wc;function Yc(t,e){this.path=t,this.readTime=e}function Jc(t,e){this.path=t,this.version=e}var Xc=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Xc.store="remoteDocuments",Xc.readTimeIndex="readTimeIndex",Xc.readTimeIndexPath="readTime",Xc.collectionReadTimeIndex="collectionReadTimeIndex",Xc.collectionReadTimeIndexPath=["parentPath","readTime"];function $c(t){this.byteSize=t}$c.store="remoteDocumentGlobal",$c.key="remoteDocumentGlobalKey";function Zc(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s}Zc.store="targets",Zc.keyPath="targetId",Zc.queryTargetsIndexName="queryTargetsIndex",Zc.queryTargetsKeyPath=["canonicalId","targetId"];var th=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};th.store="targetDocuments",th.keyPath=["targetId","path"],th.documentTargetsIndex="documentTargetsIndex",th.documentTargetsKeyPath=["path","targetId"];function eh(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}eh.key="targetGlobalKey",eh.store="targetGlobal";function nh(t,e){this.collectionId=t,this.parent=e}nh.store="collectionParents",nh.keyPath=["collectionId","parent"];function rh(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r}rh.store="clientMetadata",rh.keyPath="clientId";function ih(t,e,n){this.bundleId=t,this.createTime=e,this.version=n}ih.store="bundles",ih.keyPath="bundleId";function oh(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n}oh.store="namedQueries",oh.keyPath="name";var sh,uh=f(f(f(f([Hc.store,Kc.store,Wc.store,Xc.store,Zc.store,Gc.store,eh.store,th.store],[rh.store]),[$c.store]),[nh.store]),[ih.store,oh.store]),ah=(h(ch,sh=_e),ch);function ch(t,e){var n=this;return(n=sh.call(this)||this).ro=t,n.oo=e,n}function hh(t,e){return Da.As(t.ro,e)}var fh=function(t){this.co=t};function lh(t,e){if(e.document)return pa(t.co,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=Ri.Ut(e.noDocument.path),r=gh(e.noDocument.readTime);return new Io(n,r,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){n=Ri.Ut(e.unknownDocument.path),r=gh(e.unknownDocument.version);return new Eo(n,r)}return xr()}function ph(t,e,n){var r=dh(n),n=e.key.path.yt().Dt();if(e instanceof bo){var i={name:sa(o=t.co,(s=e).key),fields:s.Yt().mapValue.fields,updateTime:ea(o,s.version.Tt())},o=e.hasCommittedMutations;return new Xc(null,null,i,o,r,n)}if(e instanceof Io){var s=e.key.path.Dt(),i=vh(e.version),o=e.hasCommittedMutations;return new Xc(null,new Yc(s,i),null,o,r,n)}if(e instanceof Eo){o=e.key.path.Dt(),e=vh(e.version);return new Xc(new Jc(o,e),null,null,!0,r,n)}return xr()}function dh(t){t=t.Tt();return[t.seconds,t.nanoseconds]}function yh(t){t=new Oi(t[0],t[1]);return Di.wt(t)}function vh(t){t=t.Tt();return new zc(t.seconds,t.nanoseconds)}function gh(t){t=new Oi(t.seconds,t.nanoseconds);return Di.wt(t)}function mh(e,t){for(var n=(t.baseMutations||[]).map(function(t){return ya(e.co,t)}),r=t.mutations.length-1;0<=r;--r){var i=t.mutations[r];void 0!==(null==i?void 0:i.transform)&&(t.mutations[r-1].updateTransforms=i.transform.fieldTransforms,t.mutations.splice(r,1),--r)}var o=t.mutations.map(function(t){return ya(e.co,t)}),s=Oi.fromMillis(t.localWriteTimeMs);return new pc(t.batchId,s,n,o)}function wh(t){var e=gh(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?gh(t.lastLimboFreeSnapshotVersion):Di.min(),r=void 0!==t.query.documents?(kr(1===(r=t.query).documents.length),vs(cs(ca(r.documents[0])))):vs(ma(t.query));return new _s(r,t.targetId,0,t.lastListenSequenceNumber,e,n,Vr.fromBase64String(t.resumeToken))}function bh(t,e){var n=vh(e.oe),r=vh(e.lastLimboFreeSnapshotVersion),i=(xo(e.target)?va:ga)(t.co,e.target),t=e.resumeToken.toBase64();return new Zc(e.targetId,Oo(e.target),n,t,e.sequenceNumber,r,i)}function Ih(t){var e=ma({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?gs(e,e.limit,"L"):e}var Eh=(_h.prototype.ao=function(t,e){return Th(t).get(e).next(function(t){if(t)return{id:(t=t).bundleId,createTime:gh(t.createTime),version:t.version}})},_h.prototype.uo=function(t,e){return Th(t).put({bundleId:(e=e).id,createTime:vh(ra(e.createTime)),version:e.version})},_h.prototype.ho=function(t,e){return Ah(t).get(e).next(function(t){if(t)return{name:(t=t).name,query:Ih(t.bundledQuery),readTime:gh(t.readTime)}})},_h.prototype.lo=function(t,e){return Ah(t).put({name:(e=e).name,readTime:vh(ra(e.readTime)),bundledQuery:e.bundledQuery})},_h);function _h(){}function Th(t){return hh(t,ih.store)}function Ah(t){return hh(t,oh.store)}var Nh=(kh.prototype.fo=function(t,e){return this._o.add(e),Sa.resolve()},kh.prototype.wo=function(t,e){return Sa.resolve(this._o.getEntries(e))},kh),Sh=(xh.prototype.add=function(t){var e=t.Vt(),n=t.yt(),r=this.index[e]||new _u(xi.At),t=!r.has(n);return this.index[e]=r.add(n),t},xh.prototype.has=function(t){var e=t.Vt(),t=t.yt(),e=this.index[e];return e&&e.has(t)},xh.prototype.getEntries=function(t){return(this.index[t]||new _u(xi.At)).Dt()},xh),Oh=(Dh.prototype.fo=function(t,e){var n=this;if(this.Eo.has(e))return Sa.resolve();var r=e.Vt(),i=e.yt();t.Oi(function(){n.Eo.add(e)});i={collectionId:r,parent:Fc(i)};return Ph(t).put(i)},Dh.prototype.wo=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[Ur(i),""],!1,!0);return Ph(t).Ds(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(Bc(r.parent))}return o})},Dh);function Dh(){this.Eo=new Sh}function xh(){this.index={}}function kh(){this._o=new Sh}function Ph(t){return hh(t,nh.store)}function Rh(t,e,n){var r=t.store(Kc.store),i=t.store(Wc.store),o=[],t=IDBKeyRange.only(n.batchId),s=0,t=r.Fs({range:t},function(t,e,n){return s++,n.delete()});o.push(t.next(function(){kr(1===s)}));for(var u=[],a=0,c=n.mutations;a<c.length;a++){var h=c[a],f=Wc.key(e,h.key.path,n.batchId);o.push(i.delete(f)),u.push(h.key)}return Sa.hs(o).next(function(){return u})}function Lh(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw xr();e=t.noDocument}return JSON.stringify(e).length}var Ch=(Uh.Ao=function(t,e,n,r){return kr(""!==t.uid),new Uh(t.T()?t.uid:"",e,n,r)},Uh.prototype.Ro=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Mh(t).Fs({index:Kc.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},Uh.prototype.Po=function(d,y,v,g){var m=this,w=jh(d),b=Mh(d);return b.add({}).next(function(t){kr("number"==typeof t);for(var e,n,r,i,o,s=new pc(t,y,v,g),u=(e=m.fe,n=m.userId,i=(r=s).baseMutations.map(function(t){return da(e.co,t)}),o=r.mutations.map(function(t){return da(e.co,t)}),new Kc(n,r.batchId,r.er.toMillis(),i,o)),a=[],c=new _u(function(t,e){return Lr(t.Ct(),e.Ct())}),h=0,f=g;h<f.length;h++){var l=f[h],p=Wc.key(m.userId,l.key.path,t),c=c.add(l.key.path.yt());a.push(b.put(u)),a.push(w.put(p,Wc.PLACEHOLDER))}return c.forEach(function(t){a.push(m.To.fo(d,t))}),d.Oi(function(){m.mo[t]=s.keys()}),Sa.hs(a).next(function(){return s})})},Uh.prototype.yo=function(t,e){var n=this;return Mh(t).get(e).next(function(t){return t?(kr(t.userId===n.userId),mh(n.fe,t)):null})},Uh.prototype.Vo=function(t,e){var n=this;return this.mo[e]?Sa.resolve(this.mo[e]):this.yo(t,e).next(function(t){if(t){t=t.keys();return n.mo[e]=t}return null})},Uh.prototype.po=function(t,e){var r=this,i=e+1,e=IDBKeyRange.lowerBound([this.userId,i]),o=null;return Mh(t).Fs({index:Kc.userMutationsIndex,range:e},function(t,e,n){e.userId===r.userId&&(kr(e.batchId>=i),o=mh(r.fe,e)),n.done()}).next(function(){return o})},Uh.prototype.bo=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return Mh(t).Fs({index:Kc.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},Uh.prototype.vo=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Mh(t).Ds(Kc.userMutationsIndex,n).next(function(t){return t.map(function(t){return mh(e.fe,t)})})},Uh.prototype.So=function(o,s){var u=this,t=Wc.prefixForPath(this.userId,s.path),t=IDBKeyRange.lowerBound(t),a=[];return jh(o).Fs({range:t},function(t,e,n){var r=t[0],i=t[1],t=t[2],i=Bc(i);if(r===u.userId&&s.path.isEqual(i))return Mh(o).get(t).next(function(t){if(!t)throw xr();kr(t.userId===u.userId),a.push(mh(u.fe,t))});n.done()}).next(function(){return a})},Uh.prototype.Do=function(e,t){var s=this,u=new _u(Lr),n=[];return t.forEach(function(o){var t=Wc.prefixForPath(s.userId,o.path),t=IDBKeyRange.lowerBound(t),t=jh(e).Fs({range:t},function(t,e,n){var r=t[0],i=t[1],t=t[2],i=Bc(i);r===s.userId&&o.path.isEqual(i)?u=u.add(t):n.done()});n.push(t)}),Sa.hs(n).next(function(){return s.Co(e,u)})},Uh.prototype.xo=function(t,e){var o=this,s=e.path,u=s.length+1,e=Wc.prefixForPath(this.userId,s),e=IDBKeyRange.lowerBound(e),a=new _u(Lr);return jh(t).Fs({range:e},function(t,e,n){var r=t[0],i=t[1],t=t[2],i=Bc(i);r===o.userId&&s.vt(i)?i.length===u&&(a=a.add(t)):n.done()}).next(function(){return o.Co(t,a)})},Uh.prototype.Co=function(e,t){var n=this,r=[],i=[];return t.forEach(function(t){i.push(Mh(e).get(t).next(function(t){if(null===t)throw xr();kr(t.userId===n.userId),r.push(mh(n.fe,t))}))}),Sa.hs(i).next(function(){return r})},Uh.prototype.No=function(e,n){var r=this;return Rh(e.ro,this.userId,n).next(function(t){return e.Oi(function(){r.Fo(n.batchId)}),Sa.forEach(t,function(t){return r.Io.Oo(e,t)})})},Uh.prototype.Fo=function(t){delete this.mo[t]},Uh.prototype.ko=function(e){var i=this;return this.Ro(e).next(function(t){if(!t)return Sa.resolve();var t=IDBKeyRange.lowerBound(Wc.prefixForUser(i.userId)),r=[];return jh(e).Fs({range:t},function(t,e,n){t[0]===i.userId?(t=Bc(t[1]),r.push(t)):n.done()}).next(function(){kr(0===r.length)})})},Uh.prototype.Mo=function(t,e){return Vh(t,this.userId,e)},Uh.prototype.Lo=function(t){var e=this;return Fh(t).get(this.userId).next(function(t){return t||new Hc(e.userId,-1,"")})},Uh);function Uh(t,e,n,r){this.userId=t,this.fe=e,this.To=n,this.Io=r,this.mo={}}function Vh(t,o,e){var e=Wc.prefixForPath(o,e.path),s=e[1],e=IDBKeyRange.lowerBound(e),u=!1;return jh(t).Fs({range:e,Ns:!0},function(t,e,n){var r=t[0],i=t[1];t[2],r===o&&i===s&&(u=!0),n.done()}).next(function(){return u})}function Mh(t){return hh(t,Kc.store)}function jh(t){return hh(t,Wc.store)}function Fh(t){return hh(t,Hc.store)}var qh=(zh.prototype.next=function(){return this.$o+=2,this.$o},zh.Bo=function(){return new zh(0)},zh.qo=function(){return new zh(-1)},zh),Bh=(Gh.prototype.Uo=function(n){var r=this;return this.Qo(n).next(function(t){var e=new qh(t.highestTargetId);return t.highestTargetId=e.next(),r.Ko(n,t).next(function(){return t.highestTargetId})})},Gh.prototype.Wo=function(t){return this.Qo(t).next(function(t){return Di.wt(new Oi(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},Gh.prototype.jo=function(t){return this.Qo(t).next(function(t){return t.highestListenSequenceNumber})},Gh.prototype.Go=function(e,n,r){var i=this;return this.Qo(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.Tt()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.Ko(e,t)})},Gh.prototype.zo=function(e,n){var r=this;return this.Ho(e,n).next(function(){return r.Qo(e).next(function(t){return t.targetCount+=1,r.Jo(n,t),r.Ko(e,t)})})},Gh.prototype.Yo=function(t,e){return this.Ho(t,e)},Gh.prototype.Xo=function(e,t){var n=this;return this.Zo(e,t.targetId).next(function(){return Hh(e).delete(t.targetId)}).next(function(){return n.Qo(e)}).next(function(t){return kr(0<t.targetCount),--t.targetCount,n.Ko(e,t)})},Gh.prototype.Br=function(n,r,i){var o=this,s=0,u=[];return Hh(n).Fs(function(t,e){e=wh(e);e.sequenceNumber<=r&&null===i.get(e.targetId)&&(s++,u.push(o.Xo(n,e)))}).next(function(){return Sa.hs(u)}).next(function(){return s})},Gh.prototype.Un=function(t,n){return Hh(t).Fs(function(t,e){e=wh(e);n(e)})},Gh.prototype.Qo=function(t){return Kh(t).get(eh.key).next(function(t){return kr(null!==t),t})},Gh.prototype.Ko=function(t,e){return Kh(t).put(eh.key,e)},Gh.prototype.Ho=function(t,e){return Hh(t).put(bh(this.fe,e))},Gh.prototype.Jo=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},Gh.prototype.tc=function(t){return this.Qo(t).next(function(t){return t.targetCount})},Gh.prototype.ec=function(t,r){var e=Oo(r),e=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),i=null;return Hh(t).Fs({range:e,index:Zc.queryTargetsIndexName},function(t,e,n){e=wh(e);Do(r,e.target)&&(i=e,n.done())}).next(function(){return i})},Gh.prototype.nc=function(n,t,r){var i=this,o=[],s=Wh(n);return t.forEach(function(t){var e=Fc(t.path);o.push(s.put(new th(r,e))),o.push(i.Io.sc(n,r,t))}),Sa.hs(o)},Gh.prototype.ic=function(n,t,r){var i=this,o=Wh(n);return Sa.forEach(t,function(t){var e=Fc(t.path);return Sa.hs([o.delete([r,e]),i.Io.rc(n,r,t)])})},Gh.prototype.Zo=function(t,e){t=Wh(t),e=IDBKeyRange.bound([e],[e+1],!1,!0);return t.delete(e)},Gh.prototype.oc=function(t,e){var e=IDBKeyRange.bound([e],[e+1],!1,!0),t=Wh(t),r=ku();return t.Fs({range:e,Ns:!0},function(t,e,n){t=Bc(t[1]),t=new Ri(t);r=r.add(t)}).next(function(){return r})},Gh.prototype.Mo=function(t,e){var e=Fc(e.path),e=IDBKeyRange.bound([e],[Ur(e)],!1,!0),i=0;return Wh(t).Fs({index:th.documentTargetsIndex,Ns:!0,range:e},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},Gh.prototype.Zn=function(t,e){return Hh(t).get(e).next(function(t){return t?wh(t):null})},Gh);function Gh(t,e){this.Io=t,this.fe=e}function zh(t){this.$o=t}function Hh(t){return hh(t,Zc.store)}function Kh(t){return hh(t,eh.store)}function Wh(t){return hh(t,th.store)}var Qh=(Yh.prototype.Mr=function(t){var n=this.cc(t);return this.db.ac().tc(t).next(function(e){return n.next(function(t){return e+t})})},Yh.prototype.cc=function(t){var e=0;return this.$r(t,function(t){e++}).next(function(){return e})},Yh.prototype.Un=function(t,e){return this.db.ac().Un(t,e)},Yh.prototype.$r=function(t,n){return this.uc(t,function(t,e){return n(e)})},Yh.prototype.sc=function(t,e,n){return Jh(t,n)},Yh.prototype.rc=function(t,e,n){return Jh(t,n)},Yh.prototype.Br=function(t,e,n){return this.db.ac().Br(t,e,n)},Yh.prototype.Oo=Jh,Yh.prototype.hc=function(t,e){return r=e,i=!1,Fh(n=t).Os(function(t){return Vh(n,t,r).next(function(t){return t&&(i=!0),Sa.resolve(!t)})}).next(function(){return i});var n,r,i},Yh.prototype.qr=function(n,r){var i=this,o=this.db._c().lc(),s=[],u=0;return this.uc(n,function(e,t){t<=r&&(t=i.hc(n,e).next(function(t){if(!t)return u++,o.Ar(n,e).next(function(){return o.mr(e),Wh(n).delete([0,Fc(e.path)])})}),s.push(t))}).next(function(){return Sa.hs(s)}).next(function(){return o.apply(n)}).next(function(){return u})},Yh.prototype.removeTarget=function(t,e){e=e.ce(t.oo);return this.db.ac().Yo(t,e)},Yh.prototype.fc=Jh,Yh.prototype.uc=function(t,r){var i,t=Wh(t),o=cc.Zi;return t.Fs({index:th.documentTargetsIndex},function(t,e){var n=t[0],t=(t[1],e.path),e=e.sequenceNumber;0===n?(o!==cc.Zi&&r(new Ri(Bc(i)),o),o=e,i=t):o=cc.Zi}).next(function(){o!==cc.Zi&&r(new Ri(Bc(i)),o)})},Yh.prototype.Qr=function(t){return this.db._c().dc(t)},Yh);function Yh(t,e){this.db=t,this.vr=new _c(this,e)}function Jh(t,e){return Wh(t).put((t=t.oo,new th(0,Fc(e.path),t)))}var Xh,$h=(ef.prototype.Er=function(t,e,n){return rf(t).put(of(e),n)},ef.prototype.mr=function(t,e){t=rf(t),e=of(e);return t.delete(e)},ef.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.wc(e,t)})},ef.prototype.Ar=function(t,e){var n=this;return rf(t).get(of(e)).next(function(t){return n.Ec(t)})},ef.prototype.Tc=function(t,e){var n=this;return rf(t).get(of(e)).next(function(t){var e=n.Ec(t);return e?{Ir:e,size:Lh(t)}:null})},ef.prototype.getEntries=function(t,e){var n=this,r=Au;return this.Ic(t,e,function(t,e){e=n.Ec(e);r=r.Ie(t,e)}).next(function(){return r})},ef.prototype.mc=function(t,e){var r=this,i=Au,o=new du(Ri.At);return this.Ic(t,e,function(t,e){var n=r.Ec(e);o=n?(i=i.Ie(t,n),o.Ie(t,Lh(e))):(i=i.Ie(t,null),o.Ie(t,0))}).next(function(){return{Ac:i,Rc:o}})},ef.prototype.Ic=function(t,e,i){if(e.bt())return Sa.resolve();var n=IDBKeyRange.bound(e.first().path.Dt(),e.last().path.Dt()),o=e.ge(),s=o.De();return rf(t).Fs({range:n},function(t,e,n){for(var r=Ri.Ut(t);s&&Ri.At(s,r)<0;)i(s,null),s=o.De();s&&s.isEqual(r)&&(i(s,e),s=o.Ce()?o.De():null),s?n.Ss(s.path.Dt()):n.done()}).next(function(){for(;s;)i(s,null),s=o.Ce()?o.De():null})},ef.prototype.Pc=function(t,r,e){var n,i=this,o=Ou,s=r.path.length+1,u={};return e.isEqual(Di.min())?(n=r.path.Dt(),u.range=IDBKeyRange.lowerBound(n)):(n=r.path.Dt(),e=dh(e),u.range=IDBKeyRange.lowerBound([n,e],!0),u.index=Xc.collectionReadTimeIndex),rf(t).Fs(u,function(t,e,n){t.length===s&&(e=lh(i.fe,e),r.path.vt(e.key.path)?e instanceof bo&&Is(r,e)&&(o=o.Ie(e.key,e)):n.done())}).next(function(){return o})},ef.prototype.lc=function(t){return new Zh(this,!!t&&t.yc)},ef.prototype.dc=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},ef.prototype.getMetadata=function(t){return nf(t).get($c.key).next(function(t){return kr(!!t),t})},ef.prototype.wc=function(t,e){return nf(t).put($c.key,e)},ef.prototype.Ec=function(t){if(t){t=lh(this.fe,t);return t instanceof Io&&t.version.isEqual(Di.min())?null:t}return null},ef),Zh=(h(tf,Xh=o),tf.prototype.yr=function(i){var o=this,s=[],u=0,a=new _u(function(t,e){return Lr(t.Ct(),e.Ct())});return this._r.forEach(function(t,e){var n,r=o.Vc.get(t);e.Ir?(n=ph(o.gc.fe,e.Ir,o.wr(t)),a=a.add(t.path.yt()),e=Lh(n),u+=e-r,s.push(o.gc.Er(i,t,n))):(u-=r,o.yc?(r=ph(o.gc.fe,new Io(t,Di.min()),o.wr(t)),s.push(o.gc.Er(i,t,r))):s.push(o.gc.mr(i,t)))}),a.forEach(function(t){s.push(o.gc.To.fo(i,t))}),s.push(this.gc.updateMetadata(i,u)),Sa.hs(s)},tf.prototype.Rr=function(t,e){var n=this;return this.gc.Tc(t,e).next(function(t){return null===t?(n.Vc.set(e,0),null):(n.Vc.set(e,t.size),t.Ir)})},tf.prototype.Pr=function(t,e){var n=this;return this.gc.mc(t,e).next(function(t){var e=t.Ac;return t.Rc.forEach(function(t,e){n.Vc.set(t,e)}),e})},tf);function tf(t,e){var n=this;return(n=Xh.call(this)||this).gc=t,n.yc=e,n.Vc=new yc(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),n}function ef(t,e){this.fe=t,this.To=e}function nf(t){return hh(t,$c.store)}function rf(t){return hh(t,Xc.store)}function of(t){return t.path.Dt()}var sf=(uf.prototype.Ps=function(e,n,t,r){var i=this;kr(t<r&&0<=t&&r<=11);var o=new Oa("createOrUpgrade",n);t<1&&1<=r&&(e.createObjectStore(Gc.store),(s=e).createObjectStore(Hc.store,{keyPath:Hc.keyPath}),s.createObjectStore(Kc.store,{keyPath:Kc.keyPath,autoIncrement:!0}).createIndex(Kc.userMutationsIndex,Kc.userMutationsKeyPath,{unique:!0}),s.createObjectStore(Wc.store),af(e),e.createObjectStore(Xc.store));var s,u=Sa.resolve();return t<3&&3<=r&&(0!==t&&((s=e).deleteObjectStore(th.store),s.deleteObjectStore(Zc.store),s.deleteObjectStore(eh.store),af(e)),u=u.next(function(){return t=o.store(eh.store),e=new eh(0,0,Di.min().Tt(),0),t.put(eh.key,e);var t,e})),t<4&&4<=r&&(0!==t&&(u=u.next(function(){return n=e,(r=o).store(Kc.store).Ds().next(function(t){n.deleteObjectStore(Kc.store),n.createObjectStore(Kc.store,{keyPath:Kc.keyPath,autoIncrement:!0}).createIndex(Kc.userMutationsIndex,Kc.userMutationsKeyPath,{unique:!0});var e=r.store(Kc.store),t=t.map(function(t){return e.put(t)});return Sa.hs(t)});var n,r})),u=u.next(function(){e.createObjectStore(rh.store,{keyPath:rh.keyPath})})),t<5&&5<=r&&(u=u.next(function(){return i.bc(o)})),t<6&&6<=r&&(u=u.next(function(){return e.createObjectStore($c.store),i.vc(o)})),t<7&&7<=r&&(u=u.next(function(){return i.Sc(o)})),t<8&&8<=r&&(u=u.next(function(){return i.Dc(e,o)})),t<9&&9<=r&&(u=u.next(function(){var t;(t=e).objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges"),(t=n.objectStore(Xc.store)).createIndex(Xc.readTimeIndex,Xc.readTimeIndexPath,{unique:!1}),t.createIndex(Xc.collectionReadTimeIndex,Xc.collectionReadTimeIndexPath,{unique:!1})})),t<10&&10<=r&&(u=u.next(function(){return i.Cc(o)})),t<11&&11<=r&&(u=u.next(function(){e.createObjectStore(ih.store,{keyPath:ih.keyPath}),e.createObjectStore(oh.store,{keyPath:oh.keyPath})})),u},uf.prototype.vc=function(e){var n=0;return e.store(Xc.store).Fs(function(t,e){n+=Lh(e)}).next(function(){var t=new $c(n);return e.store($c.store).put($c.key,t)})},uf.prototype.bc=function(n){var r=this,t=n.store(Hc.store),i=n.store(Kc.store);return t.Ds().next(function(t){return Sa.forEach(t,function(e){var t=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return i.Ds(Kc.userMutationsIndex,t).next(function(t){return Sa.forEach(t,function(t){kr(t.userId===e.userId);t=mh(r.fe,t);return Rh(n,e.userId,t).next(function(){})})})})})},uf.prototype.Sc=function(t){var o=t.store(th.store),e=t.store(Xc.store);return t.store(eh.store).get(eh.key).next(function(r){var i=[];return e.Fs(function(t,e){var n=new xi(t),t=[0,Fc(n)];i.push(o.get(t).next(function(t){return t?Sa.resolve():o.put(new th(0,Fc(n),r.highestListenSequenceNumber))}))}).next(function(){return Sa.hs(i)})})},uf.prototype.Dc=function(t,e){t.createObjectStore(nh.store,{keyPath:nh.keyPath});function r(t){if(i.add(t)){var e=t.Vt(),t=t.yt();return n.put({collectionId:e,parent:Fc(t)})}}var n=e.store(nh.store),i=new Sh;return e.store(Xc.store).Fs({Ns:!0},function(t,e){t=new xi(t);return r(t.yt())}).next(function(){return e.store(Wc.store).Fs({Ns:!0},function(t,e){t[0];var n=t[1],n=(t[2],Bc(n));return r(n.yt())})})},uf.prototype.Cc=function(t){var n=this,r=t.store(Zc.store);return r.Fs(function(t,e){e=wh(e),e=bh(n.fe,e);return r.put(e)})},uf);function uf(t){this.fe=t}function af(t){t.createObjectStore(th.store,{keyPath:th.keyPath}).createIndex(th.documentTargetsIndex,th.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Zc.store,{keyPath:Zc.keyPath}).createIndex(Zc.queryTargetsIndexName,Zc.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(eh.store)}var cf="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",hf=(ff.prototype.start=function(){var e=this;return this.Gc().then(function(){if(!e.isPrimary&&!e.allowTabSynchronization)throw new qr(Fr.FAILED_PRECONDITION,cf);return e.zc(),e.Hc(),e.Jc(),e.runTransaction("getHighestListenSequenceNumber","readonly",function(t){return e.Qc.jo(t)})}).then(function(t){e.Fc=new cc(t,e.xc)}).then(function(){e.Oc=!0}).catch(function(t){return e.Uc&&e.Uc.close(),Promise.reject(t)})},ff.prototype.Yc=function(n){var t=this;return this.Bc=function(e){return y(t,void 0,void 0,function(){return v(this,function(t){return this.Nr?[2,n(e)]:[2]})})},n(this.isPrimary)},ff.prototype.Xc=function(n){var t=this;this.Uc.gs(function(e){return y(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return null===e.newVersion?[4,n()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},ff.prototype.Zc=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.js.Ws(function(){return y(e,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Nr?[4,this.Gc()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},ff.prototype.Gc=function(){var n=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return pf(e).put(new rh(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n.ta(e).next(function(t){t||(n.isPrimary=!1,n.js.ea(function(){return n.Bc(!1)}))})}).next(function(){return n.na(e)}).next(function(t){return n.isPrimary&&!t?n.sa(e).next(function(){return!1}):!!t&&n.ia(e).next(function(){return!0})})}).catch(function(t){if(Va(t))return Nr("IndexedDbPersistence","Failed to extend owner lease: ",t),n.isPrimary;if(!n.allowTabSynchronization)throw t;return Nr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(function(t){n.isPrimary!==t&&n.js.ea(function(){return n.Bc(t)}),n.isPrimary=t})},ff.prototype.ta=function(t){var e=this;return lf(t).get(Gc.key).next(function(t){return Sa.resolve(e.ra(t))})},ff.prototype.oa=function(t){return pf(t).delete(this.clientId)},ff.prototype.ca=function(){return y(this,void 0,void 0,function(){var e,n,r,i,o=this;return v(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.aa(this.$c,18e5)?[3,2]:(this.$c=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var r=hh(t,rh.store);return r.Ds().next(function(t){var e=o.ua(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)});return Sa.forEach(n,function(t){return r.delete(t.clientId)}).next(function(){return n})})}).catch(function(){return[]})]);case 1:if(e=t.sent(),this.jc)for(n=0,r=e;n<r.length;n++)i=r[n],this.jc.removeItem(this.ha(i.clientId));t.label=2;case 2:return[2]}})})},ff.prototype.Jc=function(){var t=this;this.Lc=this.js.ni("client_metadata_refresh",4e3,function(){return t.Gc().then(function(){return t.ca()}).then(function(){return t.Jc()})})},ff.prototype.ra=function(t){return!!t&&t.ownerId===this.clientId},ff.prototype.na=function(e){var r=this;return this.Nc?Sa.resolve(!0):lf(e).get(Gc.key).next(function(t){if(null!==t&&r.aa(t.leaseTimestampMs,5e3)&&!r.la(t.ownerId)){if(r.ra(t)&&r.networkEnabled)return!0;if(!r.ra(t)){if(!t.allowTabSynchronization)throw new qr(Fr.FAILED_PRECONDITION,cf);return!1}}return!(!r.networkEnabled||!r.inForeground)||pf(e).Ds().next(function(t){return void 0===r.ua(t,5e3).find(function(t){if(r.clientId!==t.clientId){var e=!r.networkEnabled&&t.networkEnabled,n=!r.inForeground&&t.inForeground,t=r.networkEnabled===t.networkEnabled;if(e||n&&t)return!0}return!1})})}).next(function(t){return r.isPrimary!==t&&Nr("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},ff.prototype.$=function(){return y(this,void 0,void 0,function(){var n=this;return v(this,function(t){switch(t.label){case 0:return this.Oc=!1,this._a(),this.Lc&&(this.Lc.cancel(),this.Lc=null),this.fa(),this.da(),[4,this.Uc.runTransaction("shutdown","readwrite",[Gc.store,rh.store],function(t){var e=new ah(t,cc.Zi);return n.sa(e).next(function(){return n.oa(e)})})];case 1:return t.sent(),this.Uc.close(),this.wa(),[2]}})})},ff.prototype.ua=function(t,e){var n=this;return t.filter(function(t){return n.aa(t.updateTimeMs,e)&&!n.la(t.clientId)})},ff.prototype.Ea=function(){var e=this;return this.runTransaction("getActiveClients","readonly",function(t){return pf(t).Ds().next(function(t){return e.ua(t,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(ff.prototype,"Nr",{get:function(){return this.Oc},enumerable:!1,configurable:!0}),ff.prototype.Ta=function(t){return Ch.Ao(t,this.fe,this.To,this.Io)},ff.prototype.ac=function(){return this.Qc},ff.prototype._c=function(){return this.Kc},ff.prototype.Ia=function(){return this.To},ff.prototype.ma=function(){return this.Wc},ff.prototype.runTransaction=function(e,n,r){var i=this;Nr("IndexedDbPersistence","Starting transaction:",e);var o,t="readonly"===n?"readonly":"readwrite";return this.Uc.runTransaction(e,t,uh,function(t){return o=new ah(t,i.Fc?i.Fc.next():cc.Zi),"readwrite-primary"===n?i.ta(o).next(function(t){return!!t||i.na(o)}).next(function(t){if(!t)throw Sr("Failed to obtain primary lease for action '"+e+"'."),i.isPrimary=!1,i.js.ea(function(){return i.Bc(!1)}),new qr(Fr.FAILED_PRECONDITION,Za);return r(o)}).next(function(t){return i.ia(o).next(function(){return t})}):i.Aa(o).next(function(){return r(o)})}).then(function(t){return o.ki(),t})},ff.prototype.Aa=function(t){var e=this;return lf(t).get(Gc.key).next(function(t){if(null!==t&&e.aa(t.leaseTimestampMs,5e3)&&!e.la(t.ownerId)&&!e.ra(t)&&!(e.Nc||e.allowTabSynchronization&&t.allowTabSynchronization))throw new qr(Fr.FAILED_PRECONDITION,cf)})},ff.prototype.ia=function(t){var e=new Gc(this.clientId,this.allowTabSynchronization,Date.now());return lf(t).put(Gc.key,e)},ff.G=function(){return Da.G()},ff.prototype.sa=function(t){var e=this,n=lf(t);return n.get(Gc.key).next(function(t){return e.ra(t)?(Nr("IndexedDbPersistence","Releasing primary lease."),n.delete(Gc.key)):Sa.resolve()})},ff.prototype.aa=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(Sr("Detected an update time that is in the future: "+t+" > "+n),1))},ff.prototype.zc=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Mc=function(){t.js.Ws(function(){return t.inForeground="visible"===t.document.visibilityState,t.Gc()})},this.document.addEventListener("visibilitychange",this.Mc),this.inForeground="visible"===this.document.visibilityState)},ff.prototype.fa=function(){this.Mc&&(this.document.removeEventListener("visibilitychange",this.Mc),this.Mc=null)},ff.prototype.Hc=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.kc=function(){e._a(),e.js.Ws(function(){return e.$()})},this.window.addEventListener("unload",this.kc))},ff.prototype.da=function(){this.kc&&(this.window.removeEventListener("unload",this.kc),this.kc=null)},ff.prototype.la=function(t){try{var e=null!==(null===(e=this.jc)||void 0===e?void 0:e.getItem(this.ha(t)));return Nr("IndexedDbPersistence","Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return Sr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},ff.prototype._a=function(){if(this.jc)try{this.jc.setItem(this.ha(this.clientId),String(Date.now()))}catch(t){Sr("Failed to set zombie client id.",t)}},ff.prototype.wa=function(){if(this.jc)try{this.jc.removeItem(this.ha(this.clientId))}catch(t){}},ff.prototype.ha=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},ff);function ff(t,e,n,r,i,o,s,u,a,c){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.js=i,this.window=o,this.document=s,this.xc=a,this.Nc=c,this.Fc=null,this.Oc=!1,this.isPrimary=!1,this.networkEnabled=!0,this.kc=null,this.inForeground=!1,this.Mc=null,this.Lc=null,this.$c=Number.NEGATIVE_INFINITY,this.Bc=function(t){return Promise.resolve()},!ff.G())throw new qr(Fr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.Io=new Qh(this,r),this.qc=e+"main",this.fe=new fh(u),this.Uc=new Da(this.qc,11,new sf(this.fe)),this.Qc=new Bh(this.Io,this.fe),this.To=new Oh,this.Kc=(e=this.fe,u=this.To,new $h(e,u)),this.Wc=new Eh,this.window&&this.window.localStorage?this.jc=this.window.localStorage:(this.jc=null,!1===c&&Sr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}function lf(t){return hh(t,Gc.store)}function pf(t){return hh(t,rh.store)}function df(t,e){var n=t.projectId;return t.M||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var yf=(Ef.prototype.Pa=function(e,n){var r=this;return this.Ra.So(e,n).next(function(t){return r.ya(e,n,t)})},Ef.prototype.ya=function(t,r,i){return this.Kc.Ar(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].ir(r,t);return t})},Ef.prototype.ga=function(t,e,i){var o=Au;return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].ir(t,e);o=o.Ie(t,e)}),o},Ef.prototype.Va=function(e,t){var n=this;return this.Kc.getEntries(e,t).next(function(t){return n.pa(e,t)})},Ef.prototype.pa=function(e,r){var i=this;return this.Ra.Do(e,r).next(function(t){var t=i.ga(e,r,t),n=Au;return t.forEach(function(t,e){e=e||new Io(t,Di.min()),n=n.Ie(t,e)}),n})},Ef.prototype.Pc=function(t,e,n){return r=e,Ri.qt(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.ba(t,e.path):ds(e)?this.va(t,e,n):this.Sa(t,e,n);var r},Ef.prototype.ba=function(t,e){return this.Pa(t,new Ri(e)).next(function(t){var e=Ou;return t instanceof bo&&(e=e.Ie(t.key,t)),e})},Ef.prototype.va=function(n,r,i){var o=this,s=r.collectionGroup,u=Ou;return this.To.wo(n,s).next(function(t){return Sa.forEach(t,function(t){var e,e=(e=r,t=t.child(s),new us(t,null,e.ne.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt));return o.Sa(n,e,i).next(function(t){t.forEach(function(t,e){u=u.Ie(t,e)})})}).next(function(){return u})})},Ef.prototype.Sa=function(e,n,t){var c,h,r=this;return this.Kc.Pc(e,n,t).next(function(t){return c=t,r.Ra.xo(e,n)}).next(function(t){return h=t,r.Da(e,h,c).next(function(t){c=t;for(var e=0,n=h;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var s=o[i],u=s.key,a=c.get(u),a=Js(s,a,a,r.er);c=a instanceof bo?c.Ie(u,a):c.remove(u)}})}).next(function(){return c.forEach(function(t,e){Is(n,e)||(c=c.remove(t))}),c})},Ef.prototype.Da=function(t,e,n){for(var r=ku(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof nu&&null===n.get(a.key)&&(r=r.add(a.key))}var c=n;return this.Kc.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof bo&&(c=c.Ie(t,e))}),c})},Ef),vf=(If.Na=function(t,e){for(var n=ku(),r=ku(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new If(t,e.fromCache,n,r)},If),gf=(bf.prototype.Fa=function(t){this.Oa=t},bf.prototype.Pc=function(e,r,i,o){var s=this;return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.ne.length||1===r.ne.length&&r.ne[0].field.Ot())||i.isEqual(Di.min())?this.ka(e,r):this.Oa.Va(e,o).next(function(t){var n=s.Ma(r,t);return(hs(r)||fs(r))&&s.La(r.limitType,n,o,i)?s.ka(e,r):(Ar()<=l.DEBUG&&Nr("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),bs(r)),s.Oa.Pc(e,r,i).next(function(e){return n.forEach(function(t){e=e.Ie(t.key,t)}),e}))})},bf.prototype.Ma=function(n,t){var r=new _u(Es(n));return t.forEach(function(t,e){e instanceof bo&&Is(n,e)&&(r=r.add(e))}),r},bf.prototype.La=function(t,e,n,r){if(n.size!==e.size)return!0;e="F"===t?e.last():e.first();return!!e&&(e.hasPendingWrites||0<e.version.u(r))},bf.prototype.ka=function(t,e){return Ar()<=l.DEBUG&&Nr("QueryEngine","Using full collection scan to execute query:",bs(e)),this.Oa.Pc(t,e,Di.min())},bf),mf=(wf.prototype.Fr=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.Ur(t,n.Ba)})},wf);function wf(t,e,n,r){this.persistence=t,this.$a=e,this.fe=r,this.Ba=new du(Lr),this.qa=new yc(Oo,Do),this.Ua=Di.min(),this.Ra=t.Ta(n),this.Qa=t._c(),this.Qc=t.ac(),this.Ka=new yf(this.Qa,this.Ra,this.persistence.Ia()),this.Wc=t.ma(),this.$a.Fa(this.Ka)}function bf(){}function If(t,e,n,r){this.targetId=t,this.fromCache=e,this.Ca=n,this.xa=r}function Ef(t,e,n){this.Kc=t,this.Ra=e,this.To=n}function _f(t,e,n,r){return new mf(t,e,n,r)}function Tf(i,o){return y(this,void 0,void 0,function(){var e,n,m,r;return v(this,function(t){switch(t.label){case 0:return n=(e=i).Ra,m=e.Ka,[4,e.persistence.runTransaction("Handle user change","readonly",function(v){var g;return e.Ra.vo(v).next(function(t){return g=t,n=e.persistence.Ta(o),m=new yf(e.Qa,n,e.persistence.Ia()),n.vo(v)}).next(function(t){for(var e=[],n=[],r=ku(),i=0,o=g;i<o.length;i++){var s=o[i];e.push(s.batchId);for(var u=0,a=s.mutations;u<a.length;u++)var c=a[u],r=r.add(c.key)}for(var h=0,f=t;h<f.length;h++){var l=f[h];n.push(l.batchId);for(var p=0,d=l.mutations;p<d.length;p++){var y=d[p];r=r.add(y.key)}}return m.Va(v,r).next(function(t){return{Wa:t,ja:e,Ga:n}})})})];case 1:return r=t.sent(),[2,(e.Ra=n,e.Ka=m,e.$a.Fa(e.Ka),r)]}})})}function Af(t,h){var f=t;return f.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var e,r,i,o,s,n,u,a=h.batch.keys(),c=f.Qa.lc({yc:!0});return e=f,r=t,o=c,s=(i=h).batch,n=s.keys(),u=Sa.resolve(),n.forEach(function(n){u=u.next(function(){return o.Ar(r,n)}).next(function(t){var e=t,t=i.ar.get(n);kr(null!==t),(!e||e.version.u(t)<0)&&(e=s.nr(n,e,i))&&o.Er(e,i.cr)})}),u.next(function(){return e.Ra.No(r,s)}).next(function(){return c.apply(t)}).next(function(){return f.Ra.ko(t)}).next(function(){return f.Ka.Va(t,a)})})}function Nf(t){var e=t;return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.Qc.Wo(t)})}function Sf(t,r){var a=t,c=r.oe,h=a.Ba;return a.persistence.runTransaction("Apply remote event","readwrite-primary",function(s){var t=a.Qa.lc({yc:!0});h=a.Ba;var u=[];r.rn.forEach(function(t,e){var n,r,i,o=h.get(e);o&&(u.push(a.Qc.ic(s,t.dn,e).next(function(){return a.Qc.nc(s,t._n,e)})),0<(i=t.resumeToken).o()&&(n=o.ae(i,c).ce(s.oo),h=h.Ie(e,n),r=o,i=t,kr(0<(o=n).resumeToken.o()),(0===r.resumeToken.o()||3e8<=o.oe.Et()-r.oe.Et()||0<i._n.size+i.fn.size+i.dn.size)&&u.push(a.Qc.Yo(s,n))))});var e,n=Au;return r.cn.forEach(function(t,e){r.an.has(t)&&u.push(a.persistence.Io.fc(s,t))}),u.push(Of(s,t,r.cn,c,void 0).next(function(t){n=t})),c.isEqual(Di.min())||(e=a.Qc.Wo(s).next(function(t){return a.Qc.Go(s,s.oo,c)}),u.push(e)),Sa.hs(u).next(function(){return t.apply(s)}).next(function(){return a.Ka.pa(s,n)})}).then(function(t){return a.Ba=h,t})}function Of(t,s,e,u,a){var n=ku();return e.forEach(function(t){return n=n.add(t)}),s.getEntries(t,n).next(function(i){var o=Au;return e.forEach(function(t,e){var n=i.get(t),r=(null==a?void 0:a.get(t))||u;e instanceof Io&&e.version.isEqual(Di.min())?(s.mr(t,r),o=o.Ie(t,e)):null==n||0<e.version.u(n.version)||0===e.version.u(n.version)&&n.hasPendingWrites?(s.Er(e,r),o=o.Ie(t,e)):Nr("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version)}),o})}function Df(t,r){var i=t;return i.persistence.runTransaction("Allocate target","readwrite",function(e){var n;return i.Qc.ec(e,r).next(function(t){return t?(n=t,Sa.resolve(n)):i.Qc.Uo(e).next(function(t){return n=new _s(r,t,0,e.oo),i.Qc.zo(e,n).next(function(){return n})})})}).then(function(t){var e=i.Ba.get(t.targetId);return(null===e||0<t.oe.u(e.oe))&&(i.Ba=i.Ba.Ie(t.targetId,t),i.qa.set(r,t.targetId)),t})}function xf(i,o,s){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:n=(e=i).Ba.get(o),r=s?"readwrite":"readwrite-primary",t.label=1;case 1:return t.trys.push([1,4,,5]),s?[3,3]:[4,e.persistence.runTransaction("Release target",r,function(t){return e.persistence.Io.removeTarget(t,n)})];case 2:t.sent(),t.label=3;case 3:return[3,5];case 4:if(!Va(r=t.sent()))throw r;return Nr("LocalStore","Failed to update sequence numbers for target "+o+": "+r),[3,5];case 5:return e.Ba=e.Ba.remove(o),e.qa.delete(n.target),[2]}})})}function kf(t,o,s){var u=t,a=Di.min(),c=ku();return u.persistence.runTransaction("Execute query","readonly",function(e){return t=u,n=e,r=vs(o),(void 0!==(t=(i=t).qa.get(r))?Sa.resolve(i.Ba.get(t)):i.Qc.ec(n,r)).next(function(t){if(t)return a=t.lastLimboFreeSnapshotVersion,u.Qc.oc(e,t.targetId).next(function(t){c=t})}).next(function(){return u.$a.Pc(e,o,s?a:Di.min(),s?c:ku())}).next(function(t){return{documents:t,za:c}});var t,n,r,i})}function Pf(t,e){var n=t,r=n.Qc,t=n.Ba.get(e);return t?Promise.resolve(t.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.Zn(t,e).next(function(t){return t?t.target:null})})}function Rf(t){var s=t;return s.persistence.runTransaction("Get new document changes","readonly",function(t){return e=s.Qa,n=t,t=s.Ua,r=e,i=Au,o=dh(t),t=rf(n),n=IDBKeyRange.lowerBound(o,!0),t.Fs({index:Xc.readTimeIndex,range:n},function(t,e){var n=lh(r.fe,e);i=i.Ie(n.key,n),o=e.readTime}).next(function(){return{tr:i,readTime:yh(o)}});var e,n,r,i,o}).then(function(t){var e=t.tr,t=t.readTime;return s.Ua=t,e})}function Lf(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){return[2,(e=n).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return t=rf(t),r=Di.min(),t.Fs({index:Xc.readTimeIndex,reverse:!0},function(t,e,n){e.readTime&&(r=yh(e.readTime)),n.done()}).next(function(){return r});var r}).then(function(t){e.Ua=t})]})})}var Cf,Uf,Vf=(nl.prototype.ao=function(t,e){return Sa.resolve(this.Xa.get(e))},nl.prototype.uo=function(t,e){return this.Xa.set(e.id,{id:e.id,version:e.version,createTime:ra(e.createTime)}),Sa.resolve()},nl.prototype.ho=function(t,e){return Sa.resolve(this.Za.get(e))},nl.prototype.lo=function(t,e){return this.Za.set(e.name,{name:(e=e).name,query:Ih(e.bundledQuery),readTime:ra(e.readTime)}),Sa.resolve()},nl),Mf=(el.prototype.bt=function(){return this.tu.bt()},el.prototype.sc=function(t,e){e=new jf(t,e);this.tu=this.tu.add(e),this.nu=this.nu.add(e)},el.prototype.iu=function(t,e){var n=this;t.forEach(function(t){return n.sc(t,e)})},el.prototype.rc=function(t,e){this.ru(new jf(t,e))},el.prototype.ou=function(t,e){var n=this;t.forEach(function(t){return n.rc(t,e)})},el.prototype.cu=function(t){var e=this,n=new Ri(new xi([])),r=new jf(n,t),t=new jf(n,t+1),i=[];return this.nu.Qe([r,t],function(t){e.ru(t),i.push(t.key)}),i},el.prototype.au=function(){var e=this;this.tu.forEach(function(t){return e.ru(t)})},el.prototype.ru=function(t){this.tu=this.tu.delete(t),this.nu=this.nu.delete(t)},el.prototype.uu=function(t){var e=new Ri(new xi([])),n=new jf(e,t),t=new jf(e,t+1),r=ku();return this.nu.Qe([n,t],function(t){r=r.add(t.key)}),r},el.prototype.Mo=function(t){var e=new jf(t,0),e=this.tu.We(e);return null!==e&&t.isEqual(e.key)},el),jf=(tl.eu=function(t,e){return Ri.At(t.key,e.key)||Lr(t.hu,e.hu)},tl.su=function(t,e){return Lr(t.hu,e.hu)||Ri.At(t.key,e.key)},tl),Ff=(Zf.prototype.Ro=function(t){return Sa.resolve(0===this.Ra.length)},Zf.prototype.Po=function(t,e,n,r){var i=this.lu;this.lu++,0<this.Ra.length&&this.Ra[this.Ra.length-1];n=new pc(i,e,n,r);this.Ra.push(n);for(var o=0,s=r;o<s.length;o++){var u=s[o];this._u=this._u.add(new jf(u.key,i)),this.To.fo(t,u.key.path.yt())}return Sa.resolve(n)},Zf.prototype.yo=function(t,e){return Sa.resolve(this.fu(e))},Zf.prototype.po=function(t,e){e+=1,e=this.du(e),e=e<0?0:e;return Sa.resolve(this.Ra.length>e?this.Ra[e]:null)},Zf.prototype.bo=function(){return Sa.resolve(0===this.Ra.length?-1:this.lu-1)},Zf.prototype.vo=function(t){return Sa.resolve(this.Ra.slice())},Zf.prototype.So=function(t,e){var n=this,r=new jf(e,0),e=new jf(e,Number.POSITIVE_INFINITY),i=[];return this._u.Qe([r,e],function(t){t=n.fu(t.hu);i.push(t)}),Sa.resolve(i)},Zf.prototype.Do=function(t,e){var n=this,r=new _u(Lr);return e.forEach(function(t){var e=new jf(t,0),t=new jf(t,Number.POSITIVE_INFINITY);n._u.Qe([e,t],function(t){r=r.add(t.hu)})}),Sa.resolve(this.wu(r))},Zf.prototype.xo=function(t,e){var n=e.path,r=n.length+1,e=n;Ri.qt(e)||(e=e.child(""));var e=new jf(new Ri(e),0),i=new _u(Lr);return this._u.Ke(function(t){var e=t.key.path;return!!n.vt(e)&&(e.length===r&&(i=i.add(t.hu)),!0)},e),Sa.resolve(this.wu(i))},Zf.prototype.wu=function(t){var e=this,n=[];return t.forEach(function(t){t=e.fu(t);null!==t&&n.push(t)}),n},Zf.prototype.No=function(n,r){var i=this;kr(0===this.Eu(r.batchId,"removed")),this.Ra.shift();var o=this._u;return Sa.forEach(r.mutations,function(t){var e=new jf(t.key,r.batchId);return o=o.delete(e),i.Io.Oo(n,t.key)}).next(function(){i._u=o})},Zf.prototype.Fo=function(t){},Zf.prototype.Mo=function(t,e){var n=new jf(e,0),n=this._u.We(n);return Sa.resolve(e.isEqual(n&&n.key))},Zf.prototype.ko=function(t){return this.Ra.length,Sa.resolve()},Zf.prototype.Eu=function(t,e){return this.du(t)},Zf.prototype.du=function(t){return 0===this.Ra.length?0:t-this.Ra[0].batchId},Zf.prototype.fu=function(t){t=this.du(t);return t<0||t>=this.Ra.length?null:this.Ra[t]},Zf),qf=($f.prototype.Er=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,i=this.Tu(e);return this.docs=this.docs.Ie(r,{Ir:e,size:i,readTime:n}),this.size+=i-o,this.To.fo(t,r.path.yt())},$f.prototype.mr=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},$f.prototype.Ar=function(t,e){e=this.docs.get(e);return Sa.resolve(e?e.Ir:null)},$f.prototype.getEntries=function(t,e){var n=this,r=Au;return e.forEach(function(t){var e=n.docs.get(t);r=r.Ie(t,e?e.Ir:null)}),Sa.resolve(r)},$f.prototype.Pc=function(t,e,n){for(var r=Ou,i=new Ri(e.path.child("")),o=this.docs.Ve(i);o.Ce();){var s=o.De(),u=s.key,a=s.value,s=a.Ir,a=a.readTime;if(!e.path.vt(u.path))break;a.u(n)<=0||s instanceof bo&&Is(e,s)&&(r=r.Ie(s.key,s))}return Sa.resolve(r)},$f.prototype.Iu=function(t,e){return Sa.forEach(this.docs,function(t){return e(t)})},$f.prototype.lc=function(t){return new Bf(this)},$f.prototype.dc=function(t){return Sa.resolve(this.size)},$f),Bf=(h(Xf,Uf=o),Xf.prototype.yr=function(n){var r=this,i=[];return this._r.forEach(function(t,e){e&&e.Ir?i.push(r.gc.Er(n,e.Ir,r.wr(t))):r.gc.mr(t)}),Sa.hs(i)},Xf.prototype.Rr=function(t,e){return this.gc.Ar(t,e)},Xf.prototype.Pr=function(t,e){return this.gc.getEntries(t,e)},Xf),Gf=(Jf.prototype.Un=function(t,n){return this.mu.forEach(function(t,e){return n(e)}),Sa.resolve()},Jf.prototype.Wo=function(t){return Sa.resolve(this.lastRemoteSnapshotVersion)},Jf.prototype.jo=function(t){return Sa.resolve(this.Au)},Jf.prototype.Uo=function(t){return this.highestTargetId=this.Pu.next(),Sa.resolve(this.highestTargetId)},Jf.prototype.Go=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Au&&(this.Au=e),Sa.resolve()},Jf.prototype.Ho=function(t){this.mu.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.Pu=new qh(e),this.highestTargetId=e),t.sequenceNumber>this.Au&&(this.Au=t.sequenceNumber)},Jf.prototype.zo=function(t,e){return this.Ho(e),this.targetCount+=1,Sa.resolve()},Jf.prototype.Yo=function(t,e){return this.Ho(e),Sa.resolve()},Jf.prototype.Xo=function(t,e){return this.mu.delete(e.target),this.Ru.cu(e.targetId),--this.targetCount,Sa.resolve()},Jf.prototype.Br=function(n,r,i){var o=this,s=0,u=[];return this.mu.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.mu.delete(t),u.push(o.Zo(n,e.targetId)),s++)}),Sa.hs(u).next(function(){return s})},Jf.prototype.tc=function(t){return Sa.resolve(this.targetCount)},Jf.prototype.ec=function(t,e){e=this.mu.get(e)||null;return Sa.resolve(e)},Jf.prototype.nc=function(t,e,n){return this.Ru.iu(e,n),Sa.resolve()},Jf.prototype.ic=function(e,t,n){this.Ru.ou(t,n);var r=this.persistence.Io,i=[];return r&&t.forEach(function(t){i.push(r.Oo(e,t))}),Sa.hs(i)},Jf.prototype.Zo=function(t,e){return this.Ru.cu(e),Sa.resolve()},Jf.prototype.oc=function(t,e){e=this.Ru.uu(e);return Sa.resolve(e)},Jf.prototype.Mo=function(t,e){return Sa.resolve(this.Ru.Mo(e))},Jf),zf=(Yf.prototype.start=function(){return Promise.resolve()},Yf.prototype.$=function(){return this.Oc=!1,Promise.resolve()},Object.defineProperty(Yf.prototype,"Nr",{get:function(){return this.Oc},enumerable:!1,configurable:!0}),Yf.prototype.Xc=function(){},Yf.prototype.Zc=function(){},Yf.prototype.Ia=function(){return this.To},Yf.prototype.Ta=function(t){var e=this.yu[t.I()];return e||(e=new Ff(this.To,this.Io),this.yu[t.I()]=e),e},Yf.prototype.ac=function(){return this.Qc},Yf.prototype._c=function(){return this.Kc},Yf.prototype.ma=function(){return this.Wc},Yf.prototype.runTransaction=function(t,e,n){var r=this;Nr("MemoryPersistence","Starting transaction:",t);var i=new Hf(this.Fc.next());return this.Io.Vu(),n(i).next(function(t){return r.Io.pu(i).next(function(){return t})}).cs().then(function(t){return i.ki(),t})},Yf.prototype.bu=function(e,n){return Sa.ls(Object.values(this.yu).map(function(t){return function(){return t.Mo(e,n)}}))},Yf),Hf=(h(Qf,Cf=_e),Qf),Kf=(Wf.Du=function(t){return new Wf(t)},Object.defineProperty(Wf.prototype,"Cu",{get:function(){if(this.Su)return this.Su;throw xr()},enumerable:!1,configurable:!0}),Wf.prototype.sc=function(t,e,n){return this.vu.sc(n,e),this.Cu.delete(n.toString()),Sa.resolve()},Wf.prototype.rc=function(t,e,n){return this.vu.rc(n,e),this.Cu.add(n.toString()),Sa.resolve()},Wf.prototype.Oo=function(t,e){return this.Cu.add(e.toString()),Sa.resolve()},Wf.prototype.removeTarget=function(t,e){var n=this;this.vu.cu(e.targetId).forEach(function(t){return n.Cu.add(t.toString())});var r=this.persistence.ac();return r.oc(t,e.targetId).next(function(t){t.forEach(function(t){return n.Cu.add(t.toString())})}).next(function(){return r.Xo(t,e)})},Wf.prototype.Vu=function(){this.Su=new Set},Wf.prototype.pu=function(n){var r=this,i=this.persistence._c().lc();return Sa.forEach(this.Cu,function(t){var e=Ri.Lt(t);return r.xu(n,e).next(function(t){t||i.mr(e)})}).next(function(){return r.Su=null,i.apply(n)})},Wf.prototype.fc=function(t,e){var n=this;return this.xu(t,e).next(function(t){t?n.Cu.delete(e.toString()):n.Cu.add(e.toString())})},Wf.prototype.gu=function(t){return 0},Wf.prototype.xu=function(t,e){var n=this;return Sa.ls([function(){return Sa.resolve(n.vu.Mo(e))},function(){return n.persistence.ac().Mo(t,e)},function(){return n.persistence.bu(t,e)}])},Wf);function Wf(t){this.persistence=t,this.vu=new Mf,this.Su=null}function Qf(t){var e=this;return(e=Cf.call(this)||this).oo=t,e}function Yf(t,e){var n=this;this.yu={},this.Fc=new cc(0),this.Oc=!1,this.Oc=!0,this.Io=t(this),this.Qc=new Gf(this),this.To=new Nh,this.Kc=(t=this.To,new qf(t,function(t){return n.Io.gu(t)})),this.fe=new fh(e),this.Wc=new Vf(this.fe)}function Jf(t){this.persistence=t,this.mu=new yc(Oo,Do),this.lastRemoteSnapshotVersion=Di.min(),this.highestTargetId=0,this.Au=0,this.Ru=new Mf,this.targetCount=0,this.Pu=qh.Bo()}function Xf(t){var e=this;return(e=Uf.call(this)||this).gc=t,e}function $f(t,e){this.To=t,this.Tu=e,this.docs=new du(Ri.At),this.size=0}function Zf(t,e){this.To=t,this.Io=e,this.Ra=[],this.lu=1,this._u=new _u(jf.eu)}function tl(t,e){this.key=t,this.hu=e}function el(){this.tu=new _u(jf.eu),this.nu=new _u(jf.su)}function nl(t){this.fe=t,this.Xa=new Map,this.Za=new Map}function rl(t,e){return"firestore_clients_"+t+"_"+e}function il(t,e,n){n="firestore_mutations_"+t+"_"+n;return e.T()&&(n+="_"+e.uid),n}function ol(t,e){return"firestore_targets_"+t+"_"+e}var sl=(wl.Nu=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new qr(r.error.code,r.error.message)),i?new wl(t,e,r.state,o):(Sr("SharedClientState","Failed to parse mutation state for ID '"+e+"': "+n),null)},wl.prototype.Fu=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},wl),ul=(ml.Nu=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new qr(n.error.code,n.error.message)),r?new ml(t,n.state,i):(Sr("SharedClientState","Failed to parse target state for ID '"+t+"': "+e),null)},ml.prototype.Fu=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},ml),al=(gl.Nu=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=Pu,o=0;r&&o<n.activeTargetIds.length;++o)r=gi(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new gl(t,i):(Sr("SharedClientState","Failed to parse client data for instance '"+t+"': "+e),null)},gl),cl=(vl.Nu=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new vl(e.clientId,e.onlineState):(Sr("SharedClientState","Failed to parse online state: "+t),null)},vl),hl=(yl.prototype.Ou=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},yl.prototype.ku=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},yl.prototype.Fu=function(){var t={activeTargetIds:this.activeTargetIds.Dt(),updateTimeMs:Date.now()};return JSON.stringify(t)},yl),fl=(dl.G=function(t){return!(!t||!t.localStorage)},dl.prototype.start=function(){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,c,h,f=this;return v(this,function(t){switch(t.label){case 0:return[4,this.Lu.Ea()];case 1:for(s=t.sent(),e=0,n=s;e<n.length;e++)(r=n[e])!==this.Mu&&(i=this.getItem(rl(this.persistenceKey,r)))&&(o=al.Nu(r,i))&&(this.Uu=this.Uu.Ie(o.clientId,o));for(this.Yu(),(s=this.storage.getItem(this.Hu))&&(u=this.Xu(s))&&this.Zu(u),a=0,c=this.Qu;a<c.length;a++)h=c[a],this.qu(h);return this.Qu=[],this.window.addEventListener("unload",function(){return f.$()}),this.Nr=!0,[2]}})})},dl.prototype.Xi=function(t){this.setItem(this.Wu,JSON.stringify(t))},dl.prototype.th=function(){return this.eh(this.Uu)},dl.prototype.nh=function(n){var r=!1;return this.Uu.forEach(function(t,e){e.activeTargetIds.has(n)&&(r=!0)}),r},dl.prototype.sh=function(t){this.ih(t,"pending")},dl.prototype.rh=function(t,e,n){this.ih(t,e,n),this.oh(t)},dl.prototype.ah=function(t){var e,n="not-current";return this.nh(t)&&(!(e=this.storage.getItem(ol(this.persistenceKey,t)))||(e=ul.Nu(t,e))&&(n=e.state)),this.uh.Ou(t),this.Yu(),n},dl.prototype.hh=function(t){this.uh.ku(t),this.Yu()},dl.prototype.lh=function(t){return this.uh.activeTargetIds.has(t)},dl.prototype._h=function(t){this.removeItem(ol(this.persistenceKey,t))},dl.prototype.fh=function(t,e,n){this.dh(t,e,n)},dl.prototype.wh=function(t,e,n){var r=this;e.forEach(function(t){r.oh(t)}),this.currentUser=t,n.forEach(function(t){r.sh(t)})},dl.prototype.Eh=function(t){this.Th(t)},dl.prototype.Ih=function(){this.mh()},dl.prototype.$=function(){this.Nr&&(this.window.removeEventListener("storage",this.Bu),this.removeItem(this.Ku),this.Nr=!1)},dl.prototype.getItem=function(t){var e=this.storage.getItem(t);return Nr("SharedClientState","READ",t,e),e},dl.prototype.setItem=function(t,e){Nr("SharedClientState","SET",t,e),this.storage.setItem(t,e)},dl.prototype.removeItem=function(t){Nr("SharedClientState","REMOVE",t),this.storage.removeItem(t)},dl.prototype.qu=function(t){var e=this,o=t;if(o.storageArea===this.storage){if(Nr("SharedClientState","EVENT",o.key,o.newValue),o.key===this.Ku)return void Sr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.js.ea(function(){return y(e,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){if(this.Nr){if(null!==o.key)if(this.ju.test(o.key)){if(null==o.newValue)return e=this.Ah(o.key),[2,this.Rh(e,null)];if(e=this.Ph(o.key,o.newValue))return[2,this.Rh(e.clientId,e)]}else if(this.Gu.test(o.key)){if(null!==o.newValue&&(n=this.yh(o.key,o.newValue)))return[2,this.gh(n)]}else if(this.zu.test(o.key)){if(null!==o.newValue&&(r=this.Vh(o.key,o.newValue)))return[2,this.ph(r)]}else if(o.key===this.Hu){if(null!==o.newValue&&(i=this.Xu(o.newValue)))return[2,this.Zu(i)]}else if(o.key===this.Wu)(i=function(t){var e=cc.Zi;if(null!=t)try{var n=JSON.parse(t);kr("number"==typeof n),e=n}catch(t){Sr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(o.newValue))!==cc.Zi&&this.Hi(i);else if(o.key===this.Ju)return[2,this.Lu.bh()]}else this.Qu.push(o);return[2]})})})}},Object.defineProperty(dl.prototype,"uh",{get:function(){return this.Uu.get(this.Mu)},enumerable:!1,configurable:!0}),dl.prototype.Yu=function(){this.setItem(this.Ku,this.uh.Fu())},dl.prototype.ih=function(t,e,n){n=new sl(this.currentUser,t,e,n),t=il(this.persistenceKey,this.currentUser,t);this.setItem(t,n.Fu())},dl.prototype.oh=function(t){t=il(this.persistenceKey,this.currentUser,t);this.removeItem(t)},dl.prototype.Th=function(t){t={clientId:this.Mu,onlineState:t};this.storage.setItem(this.Hu,JSON.stringify(t))},dl.prototype.dh=function(t,e,n){var r=ol(this.persistenceKey,t),n=new ul(t,e,n);this.setItem(r,n.Fu())},dl.prototype.mh=function(){this.setItem(this.Ju,"value-not-used")},dl.prototype.Ah=function(t){t=this.ju.exec(t);return t?t[1]:null},dl.prototype.Ph=function(t,e){t=this.Ah(t);return al.Nu(t,e)},dl.prototype.yh=function(t,e){var n=this.Gu.exec(t),t=Number(n[1]),n=void 0!==n[2]?n[2]:null;return sl.Nu(new Jr(n),t,e)},dl.prototype.Vh=function(t,e){t=this.zu.exec(t),t=Number(t[1]);return ul.Nu(t,e)},dl.prototype.Xu=function(t){return cl.Nu(t)},dl.prototype.gh=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return e.user.uid===this.currentUser.uid?[2,this.Lu.Sh(e.batchId,e.state,e.error)]:(Nr("SharedClientState","Ignoring mutation for non-active user "+e.user.uid),[2])})})},dl.prototype.ph=function(t){return this.Lu.Dh(t.targetId,t.state,t.error)},dl.prototype.Rh=function(t,e){var n=this,r=e?this.Uu.Ie(t,e):this.Uu.remove(t),i=this.eh(this.Uu),o=this.eh(r),s=[],u=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||u.push(t)}),this.Lu.Ch(s,u).then(function(){n.Uu=r})},dl.prototype.Zu=function(t){this.Uu.get(t.clientId)&&this.$u(t.onlineState)},dl.prototype.eh=function(t){var n=Pu;return t.forEach(function(t,e){n=n.je(e.activeTargetIds)}),n},dl),ll=(pl.prototype.sh=function(t){},pl.prototype.rh=function(t,e,n){},pl.prototype.ah=function(t){return this.xh.Ou(t),this.Nh[t]||"not-current"},pl.prototype.fh=function(t,e,n){this.Nh[t]=e},pl.prototype.hh=function(t){this.xh.ku(t)},pl.prototype.lh=function(t){return this.xh.activeTargetIds.has(t)},pl.prototype._h=function(t){delete this.Nh[t]},pl.prototype.th=function(){return this.xh.activeTargetIds},pl.prototype.nh=function(t){return this.xh.activeTargetIds.has(t)},pl.prototype.start=function(){return this.xh=new hl,Promise.resolve()},pl.prototype.wh=function(t,e,n){},pl.prototype.Eh=function(t){},pl.prototype.$=function(){},pl.prototype.Xi=function(t){},pl.prototype.Ih=function(){},pl);function pl(){this.xh=new hl,this.Nh={},this.$u=null,this.Hi=null}function dl(t,e,n,r,i){this.window=t,this.js=e,this.persistenceKey=n,this.Mu=r,this.Lu=null,this.$u=null,this.Hi=null,this.Bu=this.qu.bind(this),this.Uu=new du(Lr),this.Nr=!1,this.Qu=[];n=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ku=rl(this.persistenceKey,this.Mu),this.Wu="firestore_sequence_number_"+this.persistenceKey,this.Uu=this.Uu.Ie(this.Mu,new hl),this.ju=new RegExp("^firestore_clients_"+n+"_([^_]*)$"),this.Gu=new RegExp("^firestore_mutations_"+n+"_(\\d+)(?:_(.*))?$"),this.zu=new RegExp("^firestore_targets_"+n+"_(\\d+)$"),this.Hu="firestore_online_state_"+this.persistenceKey,this.Ju="firestore_bundle_loaded_"+this.persistenceKey,this.window.addEventListener("storage",this.Bu)}function yl(){this.activeTargetIds=Pu}function vl(t,e){this.clientId=t,this.onlineState=e}function gl(t,e){this.clientId=t,this.activeTargetIds=e}function ml(t,e,n){this.targetId=t,this.state=e,this.error=n}function wl(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}function bl(){return"undefined"!=typeof window?window:null}function Il(){return"undefined"!=typeof document?document:null}function El(t,e,n,r,i){var o=this;this.Uh=t,this.Qh=e,this.ks=n,this.Kh={},this.Wh=[],this.jh=new Map,this.Gh=new Set,this.zh=[],this.Hh=i,this.Hh.L(function(t){n.Ws(function(){return y(o,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return Rl(this)?(Nr("RemoteStore","Restarting streams for network reachability change."),[4,function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return(e=n).Gh.add(4),[4,Nl(e)];case 1:return t.sent(),e.Jh.set("Unknown"),e.Gh.delete(4),[4,Al(e)];case 2:return t.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Jh=new _l(n,r)}var _l=(Tl.prototype.Mh=function(){var t=this;0===this.Fh&&(this.Lh("Unknown"),this.Oh=this.ks.ni("online_state_timeout",1e4,function(){return t.Oh=null,t.$h("Backend didn't respond within 10 seconds."),t.Lh("Offline"),Promise.resolve()}))},Tl.prototype.Bh=function(t){"Online"===this.state?this.Lh("Unknown"):(this.Fh++,1<=this.Fh&&(this.qh(),this.$h("Connection failed 1 times. Most recent error: "+t.toString()),this.Lh("Offline")))},Tl.prototype.set=function(t){this.qh(),this.Fh=0,"Online"===t&&(this.kh=!1),this.Lh(t)},Tl.prototype.Lh=function(t){t!==this.state&&(this.state=t,this.$u(t))},Tl.prototype.$h=function(t){t="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.kh?(Sr(t),this.kh=!1):Nr("OnlineStateTracker",t)},Tl.prototype.qh=function(){null!==this.Oh&&(this.Oh.cancel(),this.Oh=null)},Tl);function Tl(t,e){this.ks=t,this.$u=e,this.state="Unknown",this.Fh=0,this.Oh=null,this.kh=!0}function Al(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:if(!Rl(r))return[3,4];e=0,n=r.zh,t.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Nl(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:e=0,n=r.zh,t.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Sl(t,e){t.jh.has(e.targetId)||(t.jh.set(e.targetId,e),Pl(t)?kl(t):Bl(t).li()&&Dl(t,e))}function Ol(t,e){var n=t,t=Bl(n);n.jh.delete(e),t.li()&&xl(n,e),0===n.jh.size&&(t.li()?t.di():Rl(n)&&n.Jh.set("Unknown"))}function Dl(t,e){t.Yh.Dn(e.targetId),Bl(t).gi(e)}function xl(t,e){t.Yh.Dn(e),Bl(t).Vi(e)}function kl(e){e.Yh=new Bu({Xn:function(t){return e.Kh.Xn(t)},Zn:function(t){return e.jh.get(t)||null}}),Bl(e).start(),e.Jh.Mh()}function Pl(t){return Rl(t)&&!Bl(t).hi()&&0<t.jh.size}function Rl(t){return 0===t.Gh.size}function Ll(t){t.Yh=void 0}function Cl(s,u,a){return y(this,void 0,void 0,function(){var n,o;return v(this,function(t){switch(t.label){case 0:if(s.Jh.set("Online"),!(u instanceof Fu&&2===u.state&&u.cause))return[3,6];t.label=1;case 1:return t.trys.push([1,3,,5]),[4,function(o,s){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){switch(t.label){case 0:e=s.cause,n=0,r=s.targetIds,t.label=1;case 1:return n<r.length?(i=r[n],o.jh.has(i)?[4,o.Kh.Xh(i,e)]:[3,3]):[3,5];case 2:t.sent(),o.jh.delete(i),o.Yh.removeTarget(i),t.label=3;case 3:t.label=4;case 4:return n++,[3,1];case 5:return[2]}})})}(s,u)];case 2:return t.sent(),[3,5];case 3:return n=t.sent(),Nr("RemoteStore","Failed to remove targets %s: %s ",u.targetIds.join(","),n),[4,Ul(s,n)];case 4:return t.sent(),[3,5];case 5:return[3,13];case 6:if(u instanceof Mu?s.Yh.Ln(u):u instanceof ju?s.Yh.jn(u):s.Yh.qn(u),a.isEqual(Di.min()))return[3,13];t.label=7;case 7:return t.trys.push([7,11,,13]),[4,Nf(s.Uh)];case 8:return o=t.sent(),0<=a.u(o)?[4,(i=a,(e=(r=s).Yh.Hn(i)).rn.forEach(function(t,e){var n;0<t.resumeToken.o()&&((n=r.jh.get(e))&&r.jh.set(e,n.ae(t.resumeToken,i)))}),e.on.forEach(function(t){var e=r.jh.get(t);e&&(r.jh.set(t,e.ae(Vr.h,e.oe)),xl(r,t),e=new _s(e.target,t,1,e.sequenceNumber),Dl(r,e))}),r.Kh.Zh(e))]:[3,10];case 9:t.sent(),t.label=10;case 10:return[3,13];case 11:return Nr("RemoteStore","Failed to raise snapshot:",o=t.sent()),[4,Ul(s,o)];case 12:return t.sent(),[3,13];case 13:return[2]}var r,i,e})})}function Ul(n,r,i){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:if(!Va(r))throw r;return n.Gh.add(1),[4,Nl(n)];case 1:return t.sent(),n.Jh.set("Offline"),i=i||function(){return Nf(n.Uh)},n.ks.ea(function(){return y(e,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return Nr("RemoteStore","Retrying IndexedDB access"),[4,i()];case 1:return t.sent(),n.Gh.delete(1),[4,Al(n)];case 2:return t.sent(),[2]}})})}),[2]}})})}function Vl(e,n){return n().catch(function(t){return Ul(e,t,n)})}function Ml(a){return y(this,void 0,void 0,function(){var i,o,s,u;return v(this,function(t){switch(t.label){case 0:o=Gl(i=a),s=0<i.Wh.length?i.Wh[i.Wh.length-1].batchId:-1,t.label=1;case 1:if(!(Rl(i)&&i.Wh.length<10))return[3,7];t.label=2;case 2:return t.trys.push([2,4,,6]),[4,(e=i.Uh,n=s,(r=e).persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===n&&(n=-1),r.Ra.po(t,n)}))];case 3:return null===(u=t.sent())?(0===i.Wh.length&&o.di(),[3,7]):(s=u.batchId,function(t,e){t.Wh.push(e);t=Gl(t);t.li()&&t.bi&&t.vi(e.mutations)}(i,u),[3,6]);case 4:return u=t.sent(),[4,Ul(i,u)];case 5:return t.sent(),[3,6];case 6:return[3,1];case 7:return jl(i)&&Fl(i),[2]}var e,n,r})})}function jl(t){return Rl(t)&&!Gl(t).hi()&&0<t.Wh.length}function Fl(t){Gl(t).start()}function ql(n,r){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=n,r?(e.Gh.delete(2),[4,Al(e)]):[3,2];case 1:return t.sent(),[3,5];case 2:return r?[3,4]:(e.Gh.add(2),[4,Nl(e)]);case 3:t.sent(),e.Jh.set("Unknown"),t.label=4;case 4:t.label=5;case 5:return[2]}})})}function Bl(n){var t,e,r,i=this;return n.nl||(n.nl=(t=n.Qh,e=n.ks,r={Y:function(n){return y(this,void 0,void 0,function(){return v(this,function(t){return n.jh.forEach(function(t,e){Dl(n,t)}),[2]})})}.bind(null,n),Z:function(e,n){return y(this,void 0,void 0,function(){return v(this,function(t){return Ll(e),Pl(e)?(e.Jh.Bh(n),kl(e)):e.Jh.set("Unknown"),[2]})})}.bind(null,n),yi:Cl.bind(null,n)},t.Ni(),new Ja(e,t.ri,t.credentials,t.fe,r)),n.zh.push(function(e){return y(i,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e?(n.nl.fi(),Pl(n)?kl(n):n.Jh.set("Unknown"),[3,3]):[3,1];case 1:return[4,n.nl.stop()];case 2:t.sent(),Ll(n),t.label=3;case 3:return[2]}})})})),n.nl}function Gl(n){var t,e,r,i=this;return n.sl||(n.sl=(t=n.Qh,e=n.ks,r={Y:function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return Gl(e).Ci(),[2]})})}.bind(null,n),Z:function(e,n){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return n&&Gl(e).bi?[4,function(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return bi(n=i.code)&&n!==Fr.ABORTED?(e=r.Wh.shift(),Gl(r).fi(),[4,Vl(r,function(){return r.Kh.el(e.batchId,i)})]):[3,3];case 1:return t.sent(),[4,Ml(r)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}(e,n)]:[3,2];case 1:t.sent(),t.label=2;case 2:return jl(e)&&Fl(e),[2]}})})}.bind(null,n),Di:function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){for(e=Gl(o),n=0,r=o.Wh;n<r.length;n++)i=r[n],e.vi(i.mutations);return[2]})})}.bind(null,n),Si:function(r,i,o){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return e=r.Wh.shift(),n=dc.from(e,i,o),[4,Vl(r,function(){return r.Kh.tl(n)})];case 1:return t.sent(),[4,Ml(r)];case 2:return t.sent(),[2]}})})}.bind(null,n)},t.Ni(),new Xa(e,t.ri,t.credentials,t.fe,r)),n.zh.push(function(e){return y(i,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e?(n.sl.fi(),[4,Ml(n)]):[3,2];case 1:return t.sent(),[3,4];case 2:return[4,n.sl.stop()];case 3:t.sent(),0<n.Wh.length&&(Nr("RemoteStore","Stopping write stream with "+n.Wh.length+" pending writes"),n.Wh=[]),t.label=4;case 4:return[2]}})})})),n.sl}function zl(){this.queries=new yc(ws,ms),this.onlineState="Unknown",this.rl=new Set}var Hl=function(){this.il=void 0,this.listeners=[]};function Kl(s,u){return y(this,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){switch(t.label){case 0:if(e=s,n=u.query,r=!1,(i=e.queries.get(n))||(r=!0,i=new Hl),!r)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),o=i,[4,e.ol(n)];case 2:return o.il=t.sent(),[3,4];case 3:return o=t.sent(),o=Ha(o,"Initialization of query '"+bs(u.query)+"' failed"),[2,void u.onError(o)];case 4:return e.queries.set(n,i),i.listeners.push(u),u.cl(e.onlineState),i.il&&u.al(i.il)&&Ql(e),[2]}})})}function Wl(s,u){return y(this,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){return e=s,n=u.query,r=!1,(i=e.queries.get(n))&&0<=(o=i.listeners.indexOf(u))&&(i.listeners.splice(o,1),r=0===i.listeners.length),r?[2,(e.queries.delete(n),e.ul(n))]:[2]})})}function Ql(t){t.rl.forEach(function(t){t.next()})}var Yl=(np.prototype.al=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new Cu(t.query,t.docs,t.Ze,e,t.tn,t.fromCache,t.en,!0)}var o=!1;return this.ll?this.fl(t)&&(this.hl.next(t),o=!0):this.dl(t,this.onlineState)&&(this.wl(t),o=!0),this._l=t,o},np.prototype.onError=function(t){this.hl.error(t)},np.prototype.cl=function(t){this.onlineState=t;var e=!1;return this._l&&!this.ll&&this.dl(this._l,t)&&(this.wl(this._l),e=!0),e},np.prototype.dl=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.El&&n||t.docs.bt()&&"Offline"!==e)},np.prototype.fl=function(t){if(0<t.docChanges.length)return!0;var e=this._l&&this._l.hasPendingWrites!==t.hasPendingWrites;return!(!t.en&&!e)&&!0===this.options.includeMetadataChanges},np.prototype.wl=function(t){t=Cu.sn(t.query,t.docs,t.tn,t.fromCache),this.ll=!0,this.hl.next(t)},np),Jl=(ep.prototype.Tl=function(){return"metadata"in this.payload},ep),Xl=(tp.prototype.Ha=function(t){return ua(this.fe,t)},tp.prototype.Ja=function(t){return t.metadata.exists?pa(this.fe,t.document,!1):new Io(this.Ha(t.metadata.name),this.Ya(t.metadata.readTime))},tp.prototype.Ya=ra,tp),$l=(Zl.prototype.ml=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},Zl.prototype.Al=function(t){for(var e=new Map,n=new Xl(this.fe),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.Ha(o.metadata.name),u=0,a=o.metadata.queries;u<a.length;u++){var c=a[u],h=(e.get(c)||ku()).add(s);e.set(c,h)}}return e},Zl.prototype.complete=function(){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){switch(t.label){case 0:return[4,function(f,l,p,d){return y(this,void 0,void 0,function(){var n,r,i,o,e,s,u,a,c,h;return v(this,function(t){switch(t.label){case 0:for(n=f,r=ku(),i=Au,o=Du,e=0,s=p;e<s.length;e++)u=s[e],a=l.Ha(u.metadata.name),u.document&&(r=r.add(a)),i=i.Ie(a,l.Ja(u)),o=o.Ie(a,l.Ya(u.metadata.readTime));return c=n.Qa.lc({yc:!0}),[4,Df(n,vs(cs(xi.xt("__bundle__/docs/"+d))))];case 1:return h=t.sent(),[2,n.persistence.runTransaction("Apply bundle documents","readwrite",function(e){return Of(e,c,i,Di.min(),o).next(function(t){return c.apply(e),t}).next(function(t){return n.Qc.Zo(e,h.targetId).next(function(){return n.Qc.nc(e,r,h.targetId)}).next(function(){return n.Ka.pa(e,t)})})})]}})})}(this.Uh,new Xl(this.fe),this.documents,this.Il.id)];case 1:e=t.sent(),n=this.Al(this.documents),r=0,i=this.queries,t.label=2;case 2:return r<i.length?(i=i[r],[4,function(e,i,o){return void 0===o&&(o=ku()),y(this,void 0,void 0,function(){var n,r;return v(this,function(t){switch(t.label){case 0:return[4,Df(e,vs(Ih(i.bundledQuery)))];case 1:return n=t.sent(),[2,(r=e).persistence.runTransaction("Save named query","readwrite",function(t){var e=ra(i.readTime);if(0<=n.oe.u(e))return r.Wc.lo(t,i);e=n.ae(Vr.h,e);return r.Ba=r.Ba.Ie(e.targetId,e),r.Qc.Yo(t,e).next(function(){return r.Qc.Zo(t,n.targetId)}).next(function(){return r.Qc.nc(t,o,n.targetId)}).next(function(){return r.Wc.lo(t,i)})})]}})})}(this.Uh,i,n.get(i.name))]):[3,5];case 3:t.sent(),t.label=4;case 4:return r++,[3,2];case 5:return[2,(this.progress.taskState="Success",new lc(Object.assign({},this.progress),e))]}})})},Zl);function Zl(t,e,n){this.Il=t,this.Uh=e,this.fe=n,this.queries=[],this.documents=[],this.progress=rp(t)}function tp(t){this.fe=t}function ep(t,e){this.payload=t,this.byteLength=e}function np(t,e,n){this.query=t,this.hl=e,this.ll=!1,this._l=null,this.onlineState="Unknown",this.options=n||{}}function rp(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}var ip=function(t){this.key=t},op=function(t){this.key=t},sp=(Object.defineProperty(fp.prototype,"pl",{get:function(){return this.Rl},enumerable:!1,configurable:!0}),fp.prototype.bl=function(t,e){var s=this,u=e?e.vl:new Lu,a=(e||this).Vl,c=(e||this).tn,h=a,f=!1,l=hs(this.query)&&a.size===this.query.limit?a.last():null,p=fs(this.query)&&a.size===this.query.limit?a.first():null;if(t.Pe(function(t,e){var n=a.get(t),r=(r=e instanceof bo?e:null)&&(Is(s.query,r)?r:null),i=!!n&&s.tn.has(n.key),o=!!r&&(r.Jt||s.tn.has(r.key)&&r.hasCommittedMutations),e=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(u.track({type:3,doc:r}),e=!0):s.Sl(n,r)||(u.track({type:2,doc:r}),e=!0,(l&&0<s.gl(r,l)||p&&s.gl(r,p)<0)&&(f=!0)):!n&&r?(u.track({type:0,doc:r}),e=!0):n&&!r&&(u.track({type:1,doc:n}),e=!0,(l||p)&&(f=!0)),e&&(c=r?(h=h.add(r),o?c.add(t):c.delete(t)):(h=h.delete(t),c.delete(t)))}),hs(this.query)||fs(this.query))for(;h.size>this.query.limit;){var n=hs(this.query)?h.last():h.first(),h=h.delete(n.key),c=c.delete(n.key);u.track({type:1,doc:n})}return{Vl:h,vl:u,La:f,tn:c}},fp.prototype.Sl=function(t,e){return t.Jt&&e.hasCommittedMutations&&!e.Jt},fp.prototype.yr=function(t,e,n){var o=this,r=this.Vl;this.Vl=t.Vl,this.tn=t.tn;var i=t.vl.Xe();i.sort(function(t,e){return r=t.type,i=e.type,n(r)-n(i)||o.gl(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return xr()}}var r,i}),this.Dl(n);var s=e?this.Cl():[],n=0===this.yl.size&&this.ln?1:0,e=n!==this.Pl;return this.Pl=n,0!==i.length||e?{snapshot:new Cu(this.query,t.Vl,r,i,t.tn,0==n,e,!1),xl:s}:{xl:s}},fp.prototype.cl=function(t){return this.ln&&"Offline"===t?(this.ln=!1,this.yr({Vl:this.Vl,vl:new Lu,tn:this.tn,La:!1},!1)):{xl:[]}},fp.prototype.Nl=function(t){return!this.Rl.has(t)&&!!this.Vl.has(t)&&!this.Vl.get(t).Jt},fp.prototype.Dl=function(t){var e=this;t&&(t._n.forEach(function(t){return e.Rl=e.Rl.add(t)}),t.fn.forEach(function(t){}),t.dn.forEach(function(t){return e.Rl=e.Rl.delete(t)}),this.ln=t.ln)},fp.prototype.Cl=function(){var e=this;if(!this.ln)return[];var n=this.yl;this.yl=ku(),this.Vl.forEach(function(t){e.Nl(t.key)&&(e.yl=e.yl.add(t.key))});var r=[];return n.forEach(function(t){e.yl.has(t)||r.push(new op(t))}),this.yl.forEach(function(t){n.has(t)||r.push(new ip(t))}),r},fp.prototype.Fl=function(t){this.Rl=t.za,this.yl=ku();t=this.bl(t.documents);return this.yr(t,!0)},fp.prototype.Ol=function(){return Cu.sn(this.query,this.Vl,this.tn,0===this.Pl)},fp),up=function(t,e,n){this.query=t,this.targetId=e,this.view=n},ap=function(t){this.key=t,this.kl=!1},cp=(Object.defineProperty(hp.prototype,"Xl",{get:function(){return!0===this.Yl},enumerable:!1,configurable:!0}),hp);function hp(t,e,n,r,i,o){this.Uh=t,this.Ml=e,this.Ll=n,this.$l=r,this.currentUser=i,this.Bl=o,this.ql={},this.Ul=new yc(ws,ms),this.Ql=new Map,this.Kl=[],this.Wl=new du(Ri.At),this.jl=new Map,this.Gl=new Mf,this.zl={},this.Hl=new Map,this.Jl=qh.qo(),this.onlineState="Unknown",this.Yl=void 0}function fp(t,e){this.query=t,this.Rl=e,this.Pl=null,this.ln=!1,this.yl=ku(),this.tn=ku(),this.gl=Es(t),this.Vl=new Ru(this.gl)}function lp(i,o,s,u){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return i.Zl=function(t,e,n){return function(r,i,o,s){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return(e=i.view.bl(o)).La?[4,kf(r.Uh,i.query,!1).then(function(t){t=t.documents;return i.view.bl(t,e)})]:[3,2];case 1:e=t.sent(),t.label=2;case 2:return n=s&&s.rn.get(i.targetId),n=i.view.yr(e,r.Xl,n),[2,(Ep(r,i.targetId,n.xl),n.snapshot)]}})})}(i,t,e,n)},[4,kf(i.Uh,o,!0)];case 1:return n=t.sent(),r=new sp(o,n.za),e=r.bl(n.documents),n=Vu.hn(s,u&&"Offline"!==i.onlineState),n=r.yr(e,i.Xl,n),Ep(i,s,n.xl),r=new up(o,s,r),[2,(i.Ul.set(o,r),i.Ql.has(s)?i.Ql.get(s).push(o):i.Ql.set(s,[o]),n.snapshot)]}})})}function pp(l,p,d){return y(this,void 0,void 0,function(){var s,u;return v(this,function(t){switch(t.label){case 0:u=kp(l),t.label=1;case 1:return t.trys.push([1,5,,6]),[4,(i=u.Uh,a=p,h=i,f=Oi.now(),o=a.reduce(function(t,e){return t.add(e.key)},ku()),h.persistence.runTransaction("Locally write mutations","readwrite",function(u){return h.Ka.Va(u,o).next(function(t){c=t;for(var e,n=[],r=0,i=a;r<i.length;r++){var o=i[r],s=(e=o,s=c.get(o.key),void 0!==e.fieldTransforms?function(t,e){for(var n=null,r=0,i=t;r<i.length;r++){var o=i[r],s=e instanceof bo?e.field(o.field):void 0,s=Os(o.transform,s||null);null!=s&&(n=(null==n?new po:n).set(o.field,s))}return n?n.Gt():null}(e.fieldTransforms,s):null);null!=s&&n.push(new nu(o.key,s,function s(t){var u=[];return zi(t.fields||{},function(t,e){var n=new Pi([t]);if(fo(e))if(0===(e=s(e.mapValue).fields).length)u.push(n);else for(var r=0,i=e;r<i.length;r++){var o=i[r];u.push(n.child(o))}else u.push(n)}),new Ki(u)}(s.proto.mapValue),Ws.exists(!0)))}return h.Ra.Po(u,f,n,a)})}).then(function(t){var e=t.rr(c);return{batchId:t.batchId,_r:e}}))];case 2:return s=t.sent(),u.$l.sh(s.batchId),e=u,n=s.batchId,r=d,i=(i=(i=e.zl[e.currentUser.I()])||new du(Lr)).Ie(n,r),e.zl[e.currentUser.I()]=i,[4,Tp(u,s._r)];case 3:return t.sent(),[4,Ml(u.Ml)];case 4:return t.sent(),[3,6];case 5:return u=t.sent(),u=Ha(u,"Failed to persist write"),d.reject(u),[3,6];case 6:return[2]}var e,n,r,i,a,c,h,f,o})})}function dp(r,i){return y(this,void 0,void 0,function(){var n,e;return v(this,function(t){switch(t.label){case 0:n=r,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,Sf(n.Uh,i)];case 2:return e=t.sent(),i.rn.forEach(function(t,e){e=n.jl.get(e);e&&(kr(t._n.size+t.fn.size+t.dn.size<=1),0<t._n.size?e.kl=!0:0<t.fn.size?kr(e.kl):0<t.dn.size&&(kr(e.kl),e.kl=!1))}),[4,Tp(n,e,i)];case 3:return t.sent(),[3,6];case 4:return[4,fc(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})}function yp(t,n,e){var r,t=t;(t.Xl&&0===e||!t.Xl&&1===e)&&(r=[],t.Ul.forEach(function(t,e){e=e.view.cl(n);e.snapshot&&r.push(e.snapshot)}),function(t,i){t.onlineState=i;var o=!1;t.queries.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++)r[n].cl(i)&&(o=!0)}),o&&Ql(t)}(t.Ll,n),r.length&&t.ql.yi(r),t.onlineState=n,t.Xl&&t.$l.Eh(n))}function vp(s,u,a){return y(this,void 0,void 0,function(){var n,o;return v(this,function(t){switch(t.label){case 0:n=s,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,(e=n.Uh,r=u,(i=e).persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return i.Ra.yo(e,r).next(function(t){return kr(null!==t),n=t.keys(),i.Ra.No(e,t)}).next(function(){return i.Ra.ko(e)}).next(function(){return i.Ka.Va(e,n)})}))];case 2:return o=t.sent(),wp(n,u,a),mp(n,u),n.$l.rh(u,"rejected",a),[4,Tp(n,o)];case 3:return t.sent(),[3,6];case 4:return[4,fc(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}var e,r,i})})}function gp(o,s){return y(this,void 0,void 0,function(){var n,r,i;return v(this,function(t){switch(t.label){case 0:Rl((n=o).Ml)||Nr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,(e=n.Uh).persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e.Ra.bo(t)})];case 2:return-1===(r=t.sent())?[2,void s.resolve()]:((i=n.Hl.get(r)||[]).push(s),n.Hl.set(r,i),[3,4]);case 3:return i=t.sent(),i=Ha(i,"Initialization of waitForPendingWrites() operation failed"),s.reject(i),[3,4];case 4:return[2]}var e})})}function mp(t,e){(t.Hl.get(e)||[]).forEach(function(t){t.resolve()}),t.Hl.delete(e)}function wp(t,e,n){var r=t,i=r.zl[r.currentUser.I()];i&&((t=i.get(e))&&(n?t.reject(n):t.resolve(),i=i.remove(e)),r.zl[r.currentUser.I()]=i)}function bp(e,t,n){void 0===n&&(n=null),e.$l.hh(t);for(var r=0,i=e.Ql.get(t);r<i.length;r++){var o=i[r];e.Ul.delete(o),n&&e.ql.t_(o,n)}e.Ql.delete(t),e.Xl&&e.Gl.cu(t).forEach(function(t){e.Gl.Mo(t)||Ip(e,t)})}function Ip(t,e){var n=t.Wl.get(e);null!==n&&(Ol(t.Ml,n),t.Wl=t.Wl.remove(e),t.jl.delete(n),_p(t))}function Ep(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof ip?(t.Gl.sc(o.key,e),function(t,e){e=e.key;t.Wl.get(e)||(Nr("SyncEngine","New document in limbo: "+e),t.Kl.push(e),_p(t))}(t,o)):o instanceof op?(Nr("SyncEngine","Document no longer in limbo: "+o.key),t.Gl.rc(o.key,e),t.Gl.Mo(o.key)||Ip(t,o.key)):xr()}}function _p(t){for(;0<t.Kl.length&&t.Wl.size<t.Bl;){var e=t.Kl.shift(),n=t.Jl.next();t.jl.set(n,new ap(e)),t.Wl=t.Wl.Ie(e,n),Sl(t.Ml,new _s(vs(cs(e.path)),n,2,cc.Zi))}}function Tp(e,s,u){return y(this,void 0,void 0,function(){var n,r,i,o;return v(this,function(t){switch(t.label){case 0:return r=[],i=[],o=[],(n=e).Ul.bt()?[3,3]:(n.Ul.forEach(function(t,e){o.push(n.Zl(e,s,u).then(function(t){t&&(n.Xl&&n.$l.fh(e.targetId,t.fromCache?"not-current":"current"),r.push(t),t=vf.Na(e.targetId,t),i.push(t))}))}),[4,Promise.all(o)]);case 1:return t.sent(),n.ql.yi(r),[4,function(a,c){return y(this,void 0,void 0,function(){var r,e,n,i,o,s,u;return v(this,function(t){switch(t.label){case 0:r=a,t.label=1;case 1:return t.trys.push([1,3,,4]),[4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return Sa.forEach(c,function(e){return Sa.forEach(e.Ca,function(t){return r.persistence.Io.sc(n,e.targetId,t)}).next(function(){return Sa.forEach(e.xa,function(t){return r.persistence.Io.rc(n,e.targetId,t)})})})})];case 2:return t.sent(),[3,4];case 3:if(!Va(e=t.sent()))throw e;return Nr("LocalStore","Failed to update sequence numbers: "+e),[3,4];case 4:for(n=0,i=c;n<i.length;n++)u=i[n],o=u.targetId,u.fromCache||(s=r.Ba.get(o),u=s.oe,u=s.ue(u),r.Ba=r.Ba.Ie(o,u));return[2]}})})}(n.Uh,i)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}function Ap(i,o){return y(this,void 0,void 0,function(){var n,r;return v(this,function(t){switch(t.label){case 0:return(n=i).currentUser.isEqual(o)?[3,3]:(Nr("SyncEngine","User change. New user:",o.I()),[4,Tf(n.Uh,o)]);case 1:return r=t.sent(),n.currentUser=o,(e=n).Hl.forEach(function(t){t.forEach(function(t){t.reject(new qr(Fr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Hl.clear(),n.$l.wh(o,r.ja,r.Ga),[4,Tp(n,r.Wa)];case 2:t.sent(),t.label=3;case 3:return[2]}var e})})}function Np(u,a,c,h){return y(this,void 0,void 0,function(){var o,s;return v(this,function(t){switch(t.label){case 0:return[4,(e=(o=u).Uh,n=a,i=(r=e).Ra,r.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return i.Vo(e,n).next(function(t){return t?r.Ka.Va(e,t):Sa.resolve(null)})}))];case 1:return null===(s=t.sent())?[3,6]:"pending"!==c?[3,3]:[4,Ml(o.Ml)];case 2:return t.sent(),[3,4];case 3:"acknowledged"===c||"rejected"===c?(wp(o,a,h||null),mp(o,a),o.Uh.Ra.Fo(a)):xr(),t.label=4;case 4:return[4,Tp(o,s)];case 5:return t.sent(),[3,7];case 6:Nr("SyncEngine","Cannot apply mutation batch with id: "+a),t.label=7;case 7:return[2]}var e,n,r,i})})}function Sp(h,f){return y(this,void 0,void 0,function(){var r,e,i,o,s,u,a,c;return v(this,function(t){switch(t.label){case 0:return xp(r=h),kp(r),!0!==f||!0===r.Yl?[3,3]:(e=r.$l.th(),[4,Op(r,e.Dt())]);case 1:return i=t.sent(),r.Yl=!0,[4,ql(r.Ml,!0)];case 2:for(t.sent(),o=0,s=i;o<s.length;o++)u=s[o],Sl(r.Ml,u);return[3,7];case 3:return!1!==f||!1===r.Yl?[3,7]:(a=[],c=Promise.resolve(),r.Ql.forEach(function(t,e){r.$l.lh(e)?a.push(e):c=c.then(function(){return bp(r,e),xf(r.Uh,e,!0)}),Ol(r.Ml,e)}),[4,c]);case 4:return t.sent(),[4,Op(r,a)];case 5:return t.sent(),(n=r).jl.forEach(function(t,e){Ol(n.Ml,e)}),n.Gl.au(),n.jl=new Map,n.Wl=new du(Ri.At),r.Yl=!1,[4,ql(r.Ml,!1)];case 6:t.sent(),t.label=7;case 7:return[2]}var n})})}function Op(p,d){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,c,h,f,l;return v(this,function(t){switch(t.label){case 0:e=p,n=[],r=[],i=0,o=d,t.label=1;case 1:return i<o.length?(s=o[i],u=void 0,(a=e.Ql.get(s))&&0!==a.length?[4,Df(e.Uh,vs(a[0]))]:[3,7]):[3,13];case 2:u=t.sent(),c=0,h=a,t.label=3;case 3:return c<h.length?(f=h[c],f=e.Ul.get(f),[4,function(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,kf((e=r).Uh,i.query,!0)];case 1:return n=t.sent(),n=i.view.Fl(n),[2,(e.Xl&&Ep(e,i.targetId,n.xl),n)]}})})}(e,f)]):[3,6];case 4:(f=t.sent()).snapshot&&r.push(f.snapshot),t.label=5;case 5:return c++,[3,3];case 6:return[3,11];case 7:return[4,Pf(e.Uh,s)];case 8:return l=t.sent(),[4,Df(e.Uh,l)];case 9:return u=t.sent(),[4,lp(e,Dp(l),s,!1)];case 10:t.sent(),t.label=11;case 11:n.push(u),t.label=12;case 12:return i++,[3,1];case 13:return[2,(e.ql.yi(r),n)]}})})}function Dp(t){return as(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function xp(t){return t.Ml.Kh.Zh=dp.bind(null,t),t.Ml.Kh.Xn=function(t,e){var n=t;if((t=n.jl.get(e))&&t.kl)return ku().add(t.key);var r=ku();if(!(e=n.Ql.get(e)))return r;for(var i=0,o=e;i<o.length;i++)var s=o[i],s=n.Ul.get(s),r=r.je(s.view.pl);return r}.bind(null,t),t.Ml.Kh.Xh=function(o,s,u){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){switch(t.label){case 0:return(e=o).$l.fh(s,"rejected",u),i=e.jl.get(s),(n=i&&i.key)?(r=(r=new du(Ri.At)).Ie(n,new Io(n,Di.min())),i=ku().add(n),i=new Uu(Di.min(),new Map,new _u(Lr),r,i),[4,dp(e,i)]):[3,2];case 1:return t.sent(),e.Wl=e.Wl.remove(n),e.jl.delete(s),_p(e),[3,4];case 2:return[4,xf(e.Uh,s,!1).then(function(){return bp(e,s,u)}).catch(fc)];case 3:t.sent(),t.label=4;case 4:return[2]}})})}.bind(null,t),t.ql.yi=function(t,e){for(var n=t,r=!1,i=0,o=e;i<o.length;i++){var s=o[i],u=s.query,u=n.queries.get(u);if(u){for(var a=0,c=u.listeners;a<c.length;a++)c[a].al(s)&&(r=!0);u.il=s}}r&&Ql(n)}.bind(null,t.Ll),t.ql.t_=function(t,e,n){var r=t;if(t=r.queries.get(e))for(var i=0,o=t.listeners;i<o.length;i++)o[i].onError(n);r.queries.delete(e)}.bind(null,t.Ll),t}function kp(t){return t.Ml.Kh.tl=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:e=i,n=o.batch.batchId,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,Af(e.Uh,o)];case 2:return r=t.sent(),wp(e,n,null),mp(e,n),e.$l.rh(n,"acknowledged"),[4,Tp(e,r)];case 3:return t.sent(),[3,6];case 4:return[4,fc(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})}.bind(null,t),t.Ml.Kh.el=vp.bind(null,t),t}function Pp(t,e,n){var r=t;(function(l,p,d){return y(this,void 0,void 0,function(){var u,a,c,h,f;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,14,,15]),[4,p.getMetadata()];case 1:return u=t.sent(),[4,(r=l.Uh,o=r,s=ra((i=u).createTime),o.persistence.runTransaction("hasNewerBundle","readonly",function(t){return o.Wc.ao(t,i.id)}).then(function(t){return!!t&&0<=t.createTime.u(s)}))];case 2:return t.sent()?[4,p.close()]:[3,4];case 3:return[2,(t.sent(),void d.e_({taskState:"Success",documentsLoaded:u.totalDocuments,bytesLoaded:u.totalBytes,totalDocuments:u.totalDocuments,totalBytes:u.totalBytes}))];case 4:return d.n_(rp(u)),a=new $l(u,l.Uh,p.fe),[4,p.s_()];case 5:c=t.sent(),t.label=6;case 6:return c?[4,a.ml(c)]:[3,10];case 7:return(h=t.sent())&&d.n_(h),[4,p.s_()];case 8:c=t.sent(),t.label=9;case 9:return[3,6];case 10:return[4,a.complete()];case 11:return f=t.sent(),[4,Tp(l,f.tr,void 0)];case 12:return t.sent(),[4,(r=l.Uh,e=u,(n=r).persistence.runTransaction("Save bundle","readwrite",function(t){return n.Wc.uo(t,e)}))];case 13:return t.sent(),d.e_(f.progress),[3,15];case 14:return Or("SyncEngine","Loading bundle failed with "+(f=t.sent())),d.i_(f),[3,15];case 15:return[2]}var e,n,r,i,o,s})})})(r,e,n).then(function(){r.$l.Ih()})}var Rp,Lp,Cp=(Bp.prototype.initialize=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.fe=Aa(e.rt.O),this.$l=this.r_(e),this.persistence=this.o_(e),[4,this.persistence.start()];case 1:return t.sent(),this.c_=this.a_(e),this.Uh=this.u_(e),[2]}})})},Bp.prototype.a_=function(t){return null},Bp.prototype.u_=function(t){return _f(this.persistence,new gf,t.h_,this.fe)},Bp.prototype.o_=function(t){return new zf(Kf.Du,this.fe)},Bp.prototype.r_=function(t){return new ll},Bp.prototype.terminate=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.c_&&this.c_.stop(),[4,this.$l.$()];case 1:return t.sent(),[4,this.persistence.$()];case 2:return t.sent(),[2]}})})},Bp),Up=(h(qp,Lp=Cp),qp.prototype.initialize=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,Lp.prototype.initialize.call(this,e)];case 1:return t.sent(),[4,Lf(this.Uh)];case 2:return t.sent(),[4,this.l_.initialize(this,e)];case 3:return t.sent(),[4,kp(this.l_.Lu)];case 4:return t.sent(),[4,Ml(this.l_.Ml)];case 5:return t.sent(),[2]}})})},qp.prototype.u_=function(t){return _f(this.persistence,new gf,t.h_,this.fe)},qp.prototype.a_=function(t){var e=this.persistence.Io.vr;return new Ec(e,t.ks)},qp.prototype.o_=function(t){var e=df(t.rt.O,t.rt.persistenceKey),n=void 0!==this.cacheSizeBytes?ec.Ki(this.cacheSizeBytes):ec.Gi;return new hf(this.synchronizeTabs,e,t.clientId,n,t.ks,bl(),Il(),this.fe,this.$l,!!this.forceOwnership)},qp.prototype.r_=function(t){return new ll},qp),Vp=(h(Fp,Rp=Up),Fp.prototype.initialize=function(r){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:return[4,Rp.prototype.initialize.call(this,r)];case 1:return t.sent(),e=this.l_.Lu,this.$l instanceof fl?(this.$l.Lu={Sh:Np.bind(null,e),Dh:function(i,o,s,u){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return(e=i).Yl?(Nr("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!e.Ql.has(o))return[3,8];switch(s){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,Rf(e.Uh)];case 3:return n=t.sent(),r=Uu.un(o,"current"===s),[4,Tp(e,n,r)];case 4:return t.sent(),[3,8];case 5:return[4,xf(e.Uh,o,!0)];case 6:return t.sent(),bp(e,o,u),[3,8];case 7:xr(),t.label=8;case 8:return[2]}})})}.bind(null,e),Ch:function(c,h,f){return y(this,void 0,void 0,function(){var n,e,r,i,o,s,u,a;return v(this,function(t){switch(t.label){case 0:if(!(n=xp(c)).Yl)return[3,10];e=0,r=h,t.label=1;case 1:return e<r.length?(r=r[e],n.Ql.has(r)?(Nr("SyncEngine","Adding an already active target "+r),[3,5]):[4,Pf(n.Uh,r)]):[3,6];case 2:return i=t.sent(),[4,Df(n.Uh,i)];case 3:return o=t.sent(),[4,lp(n,Dp(i),o.targetId,!1)];case 4:t.sent(),Sl(n.Ml,o),t.label=5;case 5:return e++,[3,1];case 6:s=function(e){return v(this,function(t){switch(t.label){case 0:return n.Ql.has(e)?[4,xf(n.Uh,e,!1).then(function(){Ol(n.Ml,e),bp(n,e)}).catch(fc)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})},u=0,a=f,t.label=7;case 7:return u<a.length?(a=a[u],[5,s(a)]):[3,10];case 8:t.sent(),t.label=9;case 9:return u++,[3,7];case 10:return[2]}})})}.bind(null,e),Ea:function(t){return t.Uh.persistence.Ea()}.bind(null,e),bh:function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){return[2,Rf((e=n).Uh).then(function(t){return Tp(e,t)})]})})}.bind(null,e)},[4,this.$l.start()]):[3,3];case 2:t.sent(),t.label=3;case 3:return[4,this.persistence.Yc(function(e){return y(n,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,Sp(this.l_.Lu,e)];case 1:return t.sent(),this.c_&&(e&&!this.c_.Nr?this.c_.start(this.Uh):e||this.c_.stop()),[2]}})})})];case 4:return t.sent(),[2]}})})},Fp.prototype.r_=function(t){var e=bl();if(!fl.G(e))throw new qr(Fr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=df(t.rt.O,t.rt.persistenceKey);return new fl(e,t.ks,n,t.clientId,t.h_)},Fp),Mp=(jp.prototype.initialize=function(n,r){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:return this.Uh?[3,2]:(this.Uh=n.Uh,this.$l=n.$l,this.Qh=this.__(r),this.Ml=this.f_(r),this.Ll=this.d_(r),this.Lu=this.w_(r,!n.synchronizeTabs),this.$l.$u=function(t){return yp(e.Lu,t,1)},this.Ml.Kh.E_=Ap.bind(null,this.Lu),[4,ql(this.Ml,this.Lu.Xl)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},jp.prototype.d_=function(t){return new zl},jp.prototype.__=function(t){var e=Aa(t.rt.O),n=(n=t.rt,new Si(n));return t=t.credentials,new $a(t,n,e)},jp.prototype.f_=function(t){var e=this,n=this.Uh,r=this.Qh,i=t.ks,o=function(t){return yp(e.Lu,t,0)},t=new(ui.G()?ui:si);return new El(n,r,i,o,t)},jp.prototype.w_=function(t,e){return function(t,e,n,r,i,o,s){o=new cp(t,e,n,r,i,o);return s&&(o.Yl=!0),o}(this.Uh,this.Ml,this.Ll,this.$l,t.h_,t.Bl,e)},jp.prototype.terminate=function(){return function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=n,Nr("RemoteStore","RemoteStore shutting down."),e.Gh.add(5),[4,Nl(e)];case 1:return t.sent(),e.Hh.$(),e.Jh.set("Unknown"),[2]}})})}(this.Ml)},jp);function jp(){}function Fp(t,e){var n=this;return(n=Rp.call(this,t,e,!1)||this).l_=t,n.cacheSizeBytes=e,n.synchronizeTabs=!0,n}function qp(t,e,n){var r=this;return(r=Lp.call(this)||this).l_=t,r.cacheSizeBytes=e,r.forceOwnership=n,r.synchronizeTabs=!1,r}function Bp(){this.synchronizeTabs=!1}function Gp(n,r){void 0===r&&(r=10240);var i=0;return{read:function(){return y(this,void 0,void 0,function(){var e;return v(this,function(t){return i<n.byteLength?(e={value:n.slice(i,i+r),done:!1},[2,(i+=r,e)]):[2,{done:!0}]})})},cancel:function(){return y(this,void 0,void 0,function(){return v(this,function(t){return[2]})})},releaseLock:function(){}}}var zp,Hp=(rd.prototype.next=function(t){this.observer.next&&this.T_(this.observer.next,t)},rd.prototype.error=function(t){this.observer.error?this.T_(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},rd.prototype.I_=function(){this.muted=!0},rd.prototype.T_=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},rd),Kp=(nd.prototype.close=function(){return this.m_.cancel()},nd.prototype.getMetadata=function(){return y(this,void 0,void 0,function(){return v(this,function(t){return[2,this.metadata.promise]})})},nd.prototype.s_=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.R_())]}})})},nd.prototype.R_=function(){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return[4,this.P_()];case 1:return null===(e=t.sent())?[2,null]:(r=this.A_.decode(e),n=Number(r),isNaN(n)&&this.y_("length string ("+r+") is not valid number"),[4,this.g_(n)]);case 2:return r=t.sent(),[2,new Jl(JSON.parse(r),e.length+n)]}})})},nd.prototype.V_=function(){return this.buffer.findIndex(function(t){return t==="{".charCodeAt(0)})},nd.prototype.P_=function(){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return this.V_()<0?[4,this.p_()]:[3,3];case 1:if(t.sent())return[3,3];t.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((e=this.V_())<0&&this.y_("Reached the end of bundle when a length string is expected."),n=this.buffer.slice(0,e),[2,(this.buffer=this.buffer.slice(e),n)])}})})},nd.prototype.g_=function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.buffer.length<n?[4,this.p_()]:[3,3];case 1:t.sent()&&this.y_("Reached the end of bundle when more is expected."),t.label=2;case 2:return[3,0];case 3:return e=this.A_.decode(this.buffer.slice(0,n)),[2,(this.buffer=this.buffer.slice(n),e)]}})})},nd.prototype.y_=function(t){throw this.m_.cancel(),new Error("Invalid bundle format: "+t)},nd.prototype.p_=function(){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,this.m_.read()];case 1:return(e=t.sent()).done||((n=new Uint8Array(this.buffer.length+e.value.length)).set(this.buffer),n.set(e.value,this.buffer.length),this.buffer=n),[2,e.done]}})})},nd),Wp=(ed.prototype.isEqual=function(t){return this.b_.isEqual(t.b_)},ed),Qp=function(t){this._methodName=t},Yp=(Object.defineProperty(td.prototype,"D_",{get:function(){return this.S_.path},enumerable:!1,configurable:!0}),Object.defineProperty(td.prototype,"id",{get:function(){return this.S_.path.Vt()},enumerable:!1,configurable:!0}),Object.defineProperty(td.prototype,"path",{get:function(){return this.S_.path.Ct()},enumerable:!1,configurable:!0}),Object.defineProperty(td.prototype,"parent",{get:function(){return new Xp(this.firestore,this.v_,this.S_.path.yt())},enumerable:!1,configurable:!0}),td.prototype.withConverter=function(t){return new td(this.firestore,t,this.S_)},td),Jp=(Zp.prototype.withConverter=function(t){return new Zp(this.firestore,t,this.C_)},Zp),Xp=(h($p,zp=Jp),Object.defineProperty($p.prototype,"id",{get:function(){return this.C_.path.Vt()},enumerable:!1,configurable:!0}),Object.defineProperty($p.prototype,"path",{get:function(){return this.C_.path.Ct()},enumerable:!1,configurable:!0}),Object.defineProperty($p.prototype,"parent",{get:function(){var t=this.D_.yt();return t.bt()?null:new Yp(this.firestore,null,new Ri(t))},enumerable:!1,configurable:!0}),$p.prototype.withConverter=function(t){return new $p(this.firestore,t,this.D_)},$p);function $p(t,e,n){var r=this;return(r=zp.call(this,t,e,cs(n))||this).firestore=t,r.D_=n,r.type="collection",r}function Zp(t,e,n){this.v_=e,this.C_=n,this.type="query",this.firestore=t}function td(t,e,n){this.v_=e,this.S_=n,this.type="document",this.firestore=t}function ed(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new qr(Fr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.b_=new Pi(t)}function nd(t,e){var n=this;this.m_=t,this.fe=e,this.metadata=new Ni,this.buffer=new Uint8Array,this.A_=new TextDecoder("utf-8"),this.R_().then(function(t){t&&t.Tl()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))},function(t){return n.metadata.reject(t)})}function rd(t){this.observer=t,this.muted=!1}function id(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t instanceof Gr&&(t=t._),Sc("collection","path",e),t instanceof Vc)return kc(n=xi.xt.apply(xi,f([e],r))),new Xp(t,null,n);if(!(t instanceof Yp||t instanceof Xp))throw new qr(Fr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return kc(n=xi.xt.apply(xi,f([t.path],r)).child(xi.xt(e))),new Xp(t.firestore,null,n)}function od(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t instanceof Gr&&(t=t._),1===arguments.length&&(e=Pr.t()),Sc("doc","path",e),t instanceof Vc)return xc(n=xi.xt.apply(xi,f([e],r))),new Yp(t,null,new Ri(n));if(!(t instanceof Yp||t instanceof Xp))throw new qr(Fr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return xc(n=t.D_.child(xi.xt.apply(xi,f([e],r)))),new Yp(t.firestore,t instanceof Xp?t.v_:null,new Ri(n))}function sd(t,e){return t instanceof Gr&&(t=t._),e instanceof Gr&&(e=e._),(t instanceof Yp||t instanceof Xp)&&(e instanceof Yp||e instanceof Xp)&&t.firestore===e.firestore&&t.path===e.path&&t.v_===e.v_}function ud(t,e){return t instanceof Gr&&(t=t._),e instanceof Gr&&(e=e._),t instanceof Jp&&e instanceof Jp&&t.firestore===e.firestore&&ms(t.C_,e.C_)&&t.v_===e.v_}var ad=(Object.defineProperty(dd.prototype,"latitude",{get:function(){return this.x_},enumerable:!1,configurable:!0}),Object.defineProperty(dd.prototype,"longitude",{get:function(){return this.N_},enumerable:!1,configurable:!0}),dd.prototype.isEqual=function(t){return this.x_===t.x_&&this.N_===t.N_},dd.prototype.toJSON=function(){return{latitude:this.x_,longitude:this.N_}},dd.prototype.dt=function(t){return Lr(this.x_,t.x_)||Lr(this.N_,t.N_)},dd),cd=/^__.*__$/,hd=(pd.prototype.F_=function(t,e){return null!==this.Te?new nu(t,this.data,this.Te,e,this.fieldTransforms):new eu(t,this.data,e,this.fieldTransforms)},pd),fd=(ld.prototype.F_=function(t,e){return new nu(t,this.data,this.Te,e,this.fieldTransforms)},ld);function ld(t,e,n){this.data=t,this.Te=e,this.fieldTransforms=n}function pd(t,e,n){this.data=t,this.Te=e,this.fieldTransforms=n}function dd(t,e){if(!isFinite(t)||t<-90||90<t)throw new qr(Fr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new qr(Fr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.x_=t,this.N_=e}function yd(t){switch(t){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw xr()}}var vd=(Object.defineProperty(wd.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(wd.prototype,"k_",{get:function(){return this.settings.k_},enumerable:!1,configurable:!0}),wd.prototype.M_=function(t){return new wd(Object.assign(Object.assign({},this.settings),t),this.O,this.fe,this.ignoreUndefinedProperties,this.fieldTransforms,this.Te)},wd.prototype.L_=function(t){var e=null===(e=this.path)||void 0===e?void 0:e.child(t),e=this.M_({path:e,B_:!1});return e.q_(t),e},wd.prototype.U_=function(t){var e,t=null===(e=this.path)||void 0===e?void 0:e.child(t),t=this.M_({path:t,B_:!1});return t.O_(),t},wd.prototype.Q_=function(t){return this.M_({path:void 0,B_:!0})},wd.prototype.K_=function(t){return Qd(t,this.settings.methodName,this.settings.W_||!1,this.path,this.settings.j_)},wd.prototype.contains=function(e){return void 0!==this.Te.find(function(t){return e.vt(t)})||void 0!==this.fieldTransforms.find(function(t){return e.vt(t.field)})},wd.prototype.O_=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.q_(this.path.get(t))},wd.prototype.q_=function(t){if(0===t.length)throw this.K_("Document fields must not be empty");if(yd(this.k_)&&cd.test(t))throw this.K_('Document fields cannot begin and end with "__"')},wd),gd=(md.prototype.G_=function(t,e,n,r){return void 0===r&&(r=!1),new vd({k_:t,methodName:e,j_:n,path:Pi.Nt(),B_:!1,W_:r},this.O,this.fe,this.ignoreUndefinedProperties)},md);function md(t,e,n){this.O=t,this.ignoreUndefinedProperties=e,this.fe=n||Aa(t)}function wd(t,e,n,r,i,o){this.settings=t,this.O=e,this.fe=n,this.ignoreUndefinedProperties=r,void 0===i&&this.O_(),this.fieldTransforms=i||[],this.Te=o||[]}function bd(t){var e=t.so(),n=Aa(t.zr);return new gd(t.zr,!!e.ignoreUndefinedProperties,n)}function Id(t,e,n,r,i,o){void 0===o&&(o={});var s=t.G_(o.merge||o.mergeFields?2:0,e,n,i);zd("Data must be an object, but it was:",s,r);var u,a,r=Bd(r,s);if(o.merge)u=new Ki(s.Te),a=s.fieldTransforms;else if(o.mergeFields){for(var c=[],h=0,f=o.mergeFields;h<f.length;h++){var l=Hd(e,f[h],n);if(!s.contains(l))throw new qr(Fr.INVALID_ARGUMENT,"Field '"+l+"' is specified in your field mask but missing from your input data.");Yd(c,l)||c.push(l)}u=new Ki(c),a=s.fieldTransforms.filter(function(t){return u.Qt(t.field)})}else u=null,a=s.fieldTransforms;return new hd(new lo(r),u,a)}var Ed,_d=(h(Td,Ed=Qp),Td.prototype.z_=function(t){if(2!==t.k_)throw 1===t.k_?t.K_(this._methodName+"() can only appear at the top level of your update data"):t.K_(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.Te.push(t.path),null},Td.prototype.isEqual=function(t){return t instanceof Td},Td);function Td(){return null!==Ed&&Ed.apply(this,arguments)||this}function Ad(t,e,n){return new vd({k_:3,j_:e.settings.j_,methodName:t._methodName,B_:n},e.O,e.fe,e.ignoreUndefinedProperties)}var Nd,Sd,Od,Dd,xd=(h(Vd,Dd=Qp),Vd.prototype.z_=function(t){return new Ks(t.path,new ks)},Vd.prototype.isEqual=function(t){return t instanceof Vd},Vd),kd=(h(Ud,Od=Qp),Ud.prototype.z_=function(t){var e=Ad(this,t,!0),n=this.H_.map(function(t){return qd(t,e)}),n=new Ps(n);return new Ks(t.path,n)},Ud.prototype.isEqual=function(t){return this===t},Ud),Pd=(h(Cd,Sd=Qp),Cd.prototype.z_=function(t){var e=Ad(this,t,!0),n=this.H_.map(function(t){return qd(t,e)}),n=new Vs(n);return new Ks(t.path,n)},Cd.prototype.isEqual=function(t){return this===t},Cd),Rd=(h(Ld,Nd=Qp),Ld.prototype.z_=function(t){var e=new qs(t.fe,Ss(t.fe,this.J_));return new Ks(t.path,e)},Ld.prototype.isEqual=function(t){return this===t},Ld);function Ld(t,e){var n=this;return(n=Nd.call(this,t)||this).J_=e,n}function Cd(t,e){var n=this;return(n=Sd.call(this,t)||this).H_=e,n}function Ud(t,e){var n=this;return(n=Od.call(this,t)||this).H_=e,n}function Vd(){return null!==Dd&&Dd.apply(this,arguments)||this}function Md(t,r,i,e){var o=t.G_(1,r,i);zd("Data must be an object, but it was:",o,e);var s=[],u=new po;zi(e,function(t,e){var n=Wd(r,t,i);e instanceof Gr&&(e=e._);t=o.U_(n);e instanceof _d?s.push(n):null!=(t=qd(e,t))&&(s.push(n),u.set(n,t))});e=new Ki(s);return new fd(u.Gt(),e,o.fieldTransforms)}function jd(t,e,n,r,i,o){var s=t.G_(1,e,n),u=[Hd(e,r,n)],a=[i];if(o.length%2!=0)throw new qr(Fr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)u.push(Hd(e,o[c])),a.push(o[c+1]);for(var h,f,l,p=[],d=new po,y=u.length-1;0<=y;--y){Yd(p,u[y])||(h=u[y],(f=a[y])instanceof Gr&&(f=f._),l=s.U_(h),f instanceof _d?p.push(h):null!=(l=qd(f,l))&&(p.push(h),d.set(h,l)))}i=new Ki(p);return new fd(d.Gt(),i,s.fieldTransforms)}function Fd(t,e,n,r){return void 0===r&&(r=!1),qd(n,t.G_(r?4:3,e))}function qd(s,t){if(s instanceof Gr&&(s=s._),Gd(s))return zd("Unsupported field value:",t,s),Bd(s,t);if(s instanceof Qp)return function(t,e){if(!yd(e.k_))throw e.K_(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.K_(t._methodName+"() is not currently supported inside arrays");t=t.z_(e);t&&e.fieldTransforms.push(t)}(s,t),null;if(t.path&&t.Te.push(t.path),s instanceof Array){if(t.settings.B_&&4!==t.k_)throw t.K_("Nested arrays are not supported");return function(t){for(var e=[],n=0,r=0,i=s;r<i.length;r++){var o=qd(i[r],t.Q_(n));null==o&&(o={nullValue:"NULL_VALUE"}),e.push(o),n++}return{arrayValue:{values:e}}}(t)}return function(t,e){if(t instanceof Gr&&(t=t._),null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Ss(e.fe,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Oi.fromDate(t);return{timestampValue:ea(e.fe,n)}}if(t instanceof Oi)return n=new Oi(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:ea(e.fe,n)};if(t instanceof ad)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Br)return{bytesValue:na(e.fe,t.l)};if(t instanceof Yp){n=e.O;var r=t.firestore.zr;if(!r.isEqual(n))throw e.K_("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:ia(t.firestore.zr||e.O,t.S_.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.K_("Unsupported field value: "+Pc(t))}(s,t)}function Bd(t,n){var r={};return Hi(t)?n.path&&0<n.path.length&&n.Te.push(n.path):zi(t,function(t,e){e=qd(e,n.L_(t));null!=e&&(r[t]=e)}),{mapValue:{fields:r}}}function Gd(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Oi||t instanceof ad||t instanceof Br||t instanceof Yp||t instanceof Qp)}function zd(t,e,n){if(!Gd(n)||("object"!=typeof(r=n)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r))){n=Pc(n);throw"an object"===n?e.K_(t+" a custom object"):e.K_(t+" "+n)}var r}function Hd(t,e,n){if(e instanceof Gr&&(e=e._),e instanceof Wp)return e.b_;if("string"==typeof e)return Wd(t,e);throw Qd("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var Kd=new RegExp("[~\\*/\\[\\]]");function Wd(e,n,r){if(0<=n.search(Kd))throw Qd("Invalid field path ("+n+"). Paths must not contain '~', '*', '/', '[', or ']'",e,!1,void 0,r);try{return(new(Wp.bind.apply(Wp,f([void 0],n.split("."))))).b_}catch(t){throw Qd("Invalid field path ("+n+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",e,!1,void 0,r)}}function Qd(t,e,n,r,i){var o=r&&!r.bt(),s=void 0!==i,e="Function "+e+"() called with invalid data";n&&(e+=" (via `toFirestore()`)");n="";return(o||s)&&(n+=" (found",o&&(n+=" in field "+r),s&&(n+=" in document "+i),n+=")"),new qr(Fr.INVALID_ARGUMENT,(e+=". ")+t+n)}function Yd(t,e){return t.some(function(t){return t.isEqual(e)})}var Jd=(ey.prototype.ef=function(r){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(this.nf(),0<this.mutations.length)throw new qr(Fr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(s,u){return y(this,void 0,void 0,function(){var n,e,r,i,o;return v(this,function(t){switch(t.label){case 0:return e=ha((n=s).fe)+"/documents",r={documents:u.map(function(t){return sa(n.fe,t)})},[4,n._t("BatchGetDocuments",e,r)];case 1:return r=t.sent(),i=new Map,r.forEach(function(t){var e,t=(e=n.fe,"found"in(t=t)?function(t,e){kr(!!e.found),e.found.name,e.found.updateTime;var n=ua(t,e.found.name),t=ra(e.found.updateTime),e=new lo({mapValue:{fields:e.found.fields}});return new bo(n,t,e,{})}(e,t):"missing"in t?function(t,e){kr(!!e.missing),kr(!!e.readTime);t=ua(t,e.missing),e=ra(e.readTime);return new Io(t,e)}(e,t):xr());i.set(t.key.toString(),t)}),o=[],[2,(u.forEach(function(t){t=i.get(t.toString());kr(!!t),o.push(t)}),o)]}})})}(this.Qh,r)];case 1:return[2,((e=t.sent()).forEach(function(t){t instanceof Io||t instanceof bo?n.sf(t):xr()}),e)]}})})},ey.prototype.set=function(t,e){this.write(e.F_(t,this.Ee(t))),this.tf.add(t.toString())},ey.prototype.update=function(t,e){try{this.write(e.F_(t,this.rf(t)))}catch(t){this.Z_=t}this.tf.add(t.toString())},ey.prototype.delete=function(t){this.write(new lu(t,this.Ee(t))),this.tf.add(t.toString())},ey.prototype.commit=function(){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(this.nf(),this.Z_)throw this.Z_;return e=this.Y_,this.mutations.forEach(function(t){e.delete(t.key.toString())}),e.forEach(function(t,e){e=Ri.Lt(e);n.mutations.push(new pu(e,n.Ee(e)))}),[4,function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return n=ha((e=i).fe)+"/documents",r={writes:o.map(function(t){return da(e.fe,t)})},[4,e.at("Commit",n,r)];case 1:return t.sent(),[2]}})})}(this.Qh,this.mutations)];case 1:return t.sent(),this.X_=!0,[2]}})})},ey.prototype.sf=function(t){var e;if(t instanceof bo)e=t.version;else{if(!(t instanceof Io))throw xr();e=Di.min()}var n=this.Y_.get(t.key.toString());if(n){if(!e.isEqual(n))throw new qr(Fr.ABORTED,"Document version changed between two reads.")}else this.Y_.set(t.key.toString(),e)},ey.prototype.Ee=function(t){var e=this.Y_.get(t.toString());return!this.tf.has(t.toString())&&e?Ws.updateTime(e):Ws.de()},ey.prototype.rf=function(t){var e=this.Y_.get(t.toString());if(this.tf.has(t.toString())||!e)return Ws.exists(!0);if(e.isEqual(Di.min()))throw new qr(Fr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ws.updateTime(e)},ey.prototype.write=function(t){this.nf(),this.mutations.push(t)},ey.prototype.nf=function(){},ey),Xd=(ty.prototype.run=function(){this.af()},ty.prototype.af=function(){var t=this;this.ui.ti(function(){return y(t,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){return e=new Jd(this.Qh),(n=this.uf(e))&&n.then(function(t){r.ks.Ws(function(){return e.commit().then(function(){r.Bs.resolve(t)}).catch(function(t){r.hf(t)})})}).catch(function(t){r.hf(t)}),[2]})})})},ty.prototype.uf=function(t){try{var e=this.updateFunction(t);return!yi(e)&&e.catch&&e.then?e:(this.Bs.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.Bs.reject(t),null}},ty.prototype.hf=function(t){var e=this;0<this.cf&&this.lf(t)?(--this.cf,this.ks.Ws(function(){return e.af(),Promise.resolve()})):this.Bs.reject(t)},ty.prototype.lf=function(t){if("FirebaseError"!==t.name)return!1;t=t.code;return"aborted"===t||"failed-precondition"===t||!bi(t)},ty),$d=(Zd.prototype.getConfiguration=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.S.promise];case 1:return[2,(t.sent(),{ks:this.ks,rt:this.rt,clientId:this.clientId,credentials:this.credentials,h_:this.user,Bl:100})]}})})},Zd.prototype.ff=function(t){var e=this;this._f=t,this.S.promise.then(function(){return e._f(e.user)})},Zd.prototype.df=function(){if(this.ks.wf)throw new qr(Fr.FAILED_PRECONDITION,"The client has already been terminated.")},Zd.prototype.terminate=function(){var t=this;this.ks.Ef();var n=new Ni;return this.ks.Tf(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,5,,6]),this.If?[4,this.If.terminate()]:[3,2];case 1:t.sent(),t.label=2;case 2:return this.mf?[4,this.mf.terminate()]:[3,4];case 3:t.sent(),t.label=4;case 4:return this.credentials.p(),n.resolve(),[3,6];case 5:return e=t.sent(),e=Ha(e,"Failed to shutdown persistence"),n.reject(e),[3,6];case 6:return[2]}})})}),n.promise},Zd);function Zd(t,e,n){var r=this;this.credentials=t,this.ks=e,this.rt=n,this.user=Jr.UNAUTHENTICATED,this.clientId=Pr.t(),this._f=function(){},this.S=new Ni,this.credentials.V(function(t){Nr("FirestoreClient","Received user=",t.uid),r.user.isEqual(t)||(r.user=t,r._f(t)),r.S.resolve()})}function ty(t,e,n,r){this.ks=t,this.Qh=e,this.updateFunction=n,this.Bs=r,this.cf=5,this.ui=new Ya(this.ks,"transaction_retry")}function ey(t){this.Qh=t,this.Y_=new Map,this.mutations=[],this.X_=!1,this.Z_=null,this.tf=new Set}function ny(r,i){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:return r.ks.Af(),Nr("FirestoreClient","Initializing OfflineComponentProvider"),[4,r.getConfiguration()];case 1:return e=t.sent(),[4,i.initialize(e)];case 2:return t.sent(),r.ff(function(e){return r.ks.ea(function(){return y(n,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,Tf(i.Uh,e)];case 1:return t.sent(),[2]}})})})}),i.persistence.Xc(function(){return r.terminate()}),r.mf=i,[2]}})})}function ry(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return r.ks.Af(),[4,iy(r)];case 1:return e=t.sent(),Nr("FirestoreClient","Initializing OnlineComponentProvider"),[4,r.getConfiguration()];case 2:return n=t.sent(),[4,i.initialize(e,n)];case 3:return t.sent(),r.ff(function(t){return r.ks.ea(function(){return function(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return(e=r).ks.Af(),Nr("RemoteStore","RemoteStore received new credentials"),n=Rl(e),e.Gh.add(3),[4,Nl(e)];case 1:return t.sent(),n&&e.Jh.set("Unknown"),[4,e.Kh.E_(i)];case 2:return t.sent(),e.Gh.delete(3),[4,Al(e)];case 3:return t.sent(),[2]}})})}(i.Ml,t)})}),r.If=i,[2]}})})}function iy(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e.mf?[3,2]:(Nr("FirestoreClient","Using default OfflineComponentProvider"),[4,ny(e,new Cp)]);case 1:t.sent(),t.label=2;case 2:return[2,e.mf]}})})}function oy(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e.If?[3,2]:(Nr("FirestoreClient","Using default OnlineComponentProvider"),[4,ry(e,new Mp)]);case 1:t.sent(),t.label=2;case 2:return[2,e.If]}})})}function sy(t){return iy(t).then(function(t){return t.persistence})}function uy(t){return iy(t).then(function(t){return t.Uh})}function ay(t){return oy(t).then(function(t){return t.Ml})}function cy(t){return oy(t).then(function(t){return t.Lu})}function hy(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,oy(r)];case 1:return e=t.sent(),[2,((n=e.Ll).ol=function(s,u){return y(this,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){switch(t.label){case 0:return e=xp(s),(o=e.Ul.get(u))?(n=o.targetId,e.$l.ah(n),r=o.view.Ol(),[3,4]):[3,1];case 1:return[4,Df(e.Uh,vs(u))];case 2:return i=t.sent(),o=e.$l.ah(i.targetId),n=i.targetId,[4,lp(e,u,n,"current"===o)];case 3:r=t.sent(),e.Xl&&Sl(e.Ml,i),t.label=4;case 4:return[2,r]}})})}.bind(null,e.Lu),n.ul=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return n=(e=i).Ul.get(o),1<(r=e.Ql.get(n.targetId)).length?[2,(e.Ql.set(n.targetId,r.filter(function(t){return!ms(t,o)})),void e.Ul.delete(o))]:e.Xl?(e.$l.hh(n.targetId),e.$l.nh(n.targetId)?[3,2]:[4,xf(e.Uh,n.targetId,!1).then(function(){e.$l._h(n.targetId),Ol(e.Ml,n.targetId),bp(e,n.targetId)}).catch(fc)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return bp(e,n.targetId),[4,xf(e.Uh,n.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})}.bind(null,e.Lu),n)]}})})}function fy(n,r,i){var t=this;void 0===i&&(i={});var o=new Ni;return n.ks.Ws(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(n,r,i,o,s){var t=new Hp({next:function(t){r.Ws(function(){return Wl(n,u)});var e=t.docs.has(i);!e&&t.fromCache?s.reject(new qr(Fr.UNAVAILABLE,"Failed to get document because the client is offline.")):e&&t.fromCache&&o&&"server"===o.source?s.reject(new qr(Fr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(t)},error:function(t){return s.reject(t)}}),u=new Yl(cs(i.path),t,{includeMetadataChanges:!0,El:!0});return Kl(n,u)},[4,hy(n)];case 1:return[2,e.apply(void 0,[t.sent(),n.ks,r,i,o])]}})})}),o.promise}function ly(n,r,i){var t=this;void 0===i&&(i={});var o=new Ni;return n.ks.Ws(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(e,n,t,r,i){var o=new Hp({next:function(t){n.Ws(function(){return Wl(e,s)}),t.fromCache&&"server"===r.source?i.reject(new qr(Fr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(t)},error:function(t){return i.reject(t)}}),s=new Yl(t,o,{includeMetadataChanges:!0,El:!0});return Kl(e,s)},[4,hy(n)];case 1:return[2,e.apply(void 0,[t.sent(),n.ks,r,i,o])]}})})}),o.promise}var py,dy=(Object.defineProperty(gy.prototype,"wf",{get:function(){return this.yf},enumerable:!1,configurable:!0}),gy.prototype.Ws=function(t){this.enqueue(t)},gy.prototype.Tf=function(t){this.Sf(),this.Df(t)},gy.prototype.Ef=function(){var t;this.yf||(this.yf=!0,(t=Il())&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.vf))},gy.prototype.enqueue=function(t){return this.Sf(),this.yf?new Promise(function(t){}):this.Df(t)},gy.prototype.ea=function(t){var e=this;this.Ws(function(){return e.Pf.push(t),e.Cf()})},gy.prototype.Cf=function(){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(0===this.Pf.length)return[3,5];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.Pf[0]()];case 2:return t.sent(),this.Pf.shift(),this.ui.reset(),[3,4];case 3:if(!Va(e=t.sent()))throw e;return Nr("AsyncQueue","Operation failed with retryable error: "+e),[3,4];case 4:0<this.Pf.length&&this.ui.ti(function(){return n.Cf()}),t.label=5;case 5:return[2]}})})},gy.prototype.Df=function(t){var r=this,e=this.Rf.then(function(){return r.pf=!0,t().catch(function(t){throw r.Vf=t,r.pf=!1,Sr("INTERNAL UNHANDLED ERROR: ",(n=(e=t).message||"",e.stack&&(n=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),n)),t;var e,n}).then(function(t){return r.pf=!1,t})});return this.Rf=e},gy.prototype.ni=function(t,e,n){var r=this;this.Sf(),-1<this.bf.indexOf(t)&&(e=0);n=Ga.qs(this,t,e,n,function(t){return r.xf(t)});return this.gf.push(n),n},gy.prototype.Sf=function(){this.Vf&&xr()},gy.prototype.Af=function(){},gy.prototype.Nf=function(){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return[4,e=this.Rf];case 1:t.sent(),t.label=2;case 2:if(e!==this.Rf)return[3,0];t.label=3;case 3:return[2]}})})},gy.prototype.Ff=function(t){for(var e=0,n=this.gf;e<n.length;e++)if(n[e].Ms===t)return!0;return!1},gy.prototype.Of=function(r){var i=this;return this.Nf().then(function(){i.gf.sort(function(t,e){return t.Ls-e.Ls});for(var t=0,e=i.gf;t<e.length;t++){var n=e[t];if(n.Ks(),"all"!==r&&n.Ms===r)break}return i.Nf()})},gy.prototype.kf=function(t){this.bf.push(t)},gy.prototype.xf=function(t){t=this.gf.indexOf(t);this.gf.splice(t,1)},gy),yy=(h(vy,py=Vc),vy.prototype.io=function(){return this.Lf||wy(this),this.Lf.terminate()},vy);function vy(t,e){var n=this;return(n=py.call(this,t,e)||this).Mf=new dy,n.Wr="name"in t?t.name:"[DEFAULT]",n}function gy(){var e=this;this.Rf=Promise.resolve(),this.Pf=[],this.yf=!1,this.gf=[],this.Vf=null,this.pf=!1,this.bf=[],this.ui=new Ya(this,"async_queue_retry"),this.vf=function(){var t=Il();t&&Nr("AsyncQueue","Visibility state changed to "+t.visibilityState),e.ui.si()};var t=Il();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.vf)}function my(t){return t.Lf||wy(t),t.Lf.df(),t.Lf}function wy(t){var e,n,r=t.so(),r=(e=t.zr,n=t.Wr,new ii(e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling));t.Lf=new $d(t.Hr,t.Mf,r)}function by(n,r,i){var t=this,o=new Ni;return n.ks.enqueue(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,ny(n,i)];case 1:return t.sent(),[4,ry(n,r)];case 2:return t.sent(),o.resolve(),[3,4];case 3:if(!("FirebaseError"===(t=e=t.sent()).name?t.code===Fr.FAILED_PRECONDITION||t.code===Fr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw e;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+e),o.reject(e),[3,4];case 4:return[2]}})})}).then(function(){return o.promise})}function Iy(t){if(t.Yr||t.Xr)throw new qr(Fr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Ey,o=(Sy.prototype.$f=function(t,e){switch(void 0===e&&(e="none"),to(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Ji(t.integerValue||t.doubleValue);case 3:return this.Bf(t.timestampValue);case 4:return this.qf(t,e);case 5:return t.stringValue;case 6:return this.Uf(Xi(t.bytesValue));case 7:return this.Qf(t.referenceValue);case 8:return this.Kf(t.geoPointValue);case 9:return this.Wf(t.arrayValue,e);case 10:return this.jf(t.mapValue,e);default:throw xr()}},Sy.prototype.jf=function(t,n){var r=this,i={};return zi(t.fields||{},function(t,e){i[t]=r.$f(e,n)}),i},Sy.prototype.Kf=function(t){return new ad(Ji(t.latitude),Ji(t.longitude))},Sy.prototype.Wf=function(t,e){var n=this;return(t.values||[]).map(function(t){return n.$f(t,e)})},Sy.prototype.qf=function(t,e){switch(e){case"previous":var n=function t(e){e=e.mapValue.fields.__previous_value__;return $i(e)?t(e):e}(t);return null==n?null:this.$f(n,e);case"estimate":return this.Bf(Zi(t));default:return null}},Sy.prototype.Bf=function(t){t=Yi(t);return new Oi(t.seconds,t.nanos)},Sy.prototype.Gf=function(t,e){var n=xi.xt(t);kr(Ta(n));t=new oi(n.get(1),n.get(3)),n=new Ri(n.Pt(5));return t.isEqual(e)||Sr("Document "+n+" contains a document reference within a different database ("+t.projectId+"/"+t.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),n},Sy),_y=(Object.defineProperty(Ny.prototype,"id",{get:function(){return this.S_.path.Vt()},enumerable:!1,configurable:!0}),Object.defineProperty(Ny.prototype,"ref",{get:function(){return new Yp(this.zf,this.v_,this.S_)},enumerable:!1,configurable:!0}),Ny.prototype.exists=function(){return null!==this.Jf},Ny.prototype.data=function(){if(this.Jf){if(this.v_){var t=new Ty(this.zf,this.Hf,this.S_,this.Jf,null);return this.v_.fromFirestore(t)}return this.Hf.$f(this.Jf.Yt())}},Ny.prototype.get=function(t){if(this.Jf){t=this.Jf.data().field(Oy("DocumentSnapshot.get",t));if(null!==t)return this.Hf.$f(t)}},Ny),Ty=(h(Ay,Ey=_y),Ay.prototype.data=function(){return Ey.prototype.data.call(this)},Ay);function Ay(){return null!==Ey&&Ey.apply(this,arguments)||this}function Ny(t,e,n,r,i){this.zf=t,this.Hf=e,this.S_=n,this.Jf=r,this.v_=i}function Sy(){}function Oy(t,e){return"string"==typeof e?Wd(t,e):(e instanceof Gr?e._:e).b_}function Dy(t){if(fs(t)&&0===t.ne.length)throw new qr(Fr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}_e=function(){};function xy(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){t=i[r].Yf(t)}return t}var ky,Py,Ry,Ly,Cy,Uy=(h(Hy,Cy=_e),Hy.prototype.Yf=function(t){var e=bd(t.firestore),e=function(t,e,n,r,i,o){if(r.Ot()){if("array-contains"===i||"array-contains-any"===i)throw new qr(Fr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+i+"' queries on FieldPath.documentId().");if("in"===i||"not-in"===i){Qy(o,i);for(var s=[],u=0,a=o;u<a.length;u++){var c=a[u];s.push(Wy(n,t,c))}h={arrayValue:{values:s}}}else h=Wy(n,t,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||Qy(o,i),h=Fd(e,"where",o,"in"===i||"not-in"===i);var h=Po.create(r,i,h);return function(t,e){if(e.ee()){var n=ps(t);if(null!==n&&!n.isEqual(e.field))throw new qr(Fr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");n=ls(t);null!==n&&Yy(0,e.field,n)}t=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(0<=e.indexOf(i.op))return i.op}return null}(t,function(){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==t)throw t===e.op?new qr(Fr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new qr(Fr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+t.toString()+"' filters.")}(t,h),h}(t.C_,e,t.firestore.zr,this.Xf,this.Zf,this.td);return new Jp(t.firestore,t.v_,(t=t.C_,e=t.filters.concat([e]),new us(t.path,t.collectionGroup,t.ne.slice(),e,t.limit,t.limitType,t.startAt,t.endAt)))},Hy),Vy=(h(zy,Ly=_e),zy.prototype.Yf=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new qr(Fr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new qr(Fr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new is(e,n);return e=r,null!==ls(n=t)||null!==(t=ps(n))&&Yy(0,t,e.field),r}(t.C_,this.Xf,this.ed);return new Jp(t.firestore,t.v_,(t=t.C_,e=t.ne.concat([e]),new us(t.path,t.collectionGroup,e,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))},zy),My=(h(Gy,Ry=_e),Gy.prototype.Yf=function(t){return new Jp(t.firestore,t.v_,gs(t.C_,this.nd,this.sd))},Gy),jy=(h(By,Py=_e),By.prototype.Yf=function(t){var e=Ky(t,this.type,this.rd,this.od);return new Jp(t.firestore,t.v_,(t=t.C_,e=e,new us(t.path,t.collectionGroup,t.ne.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)))},By),Fy=(h(qy,ky=_e),qy.prototype.Yf=function(t){var e=Ky(t,this.type,this.rd,this.od);return new Jp(t.firestore,t.v_,(t=t.C_,e=e,new us(t.path,t.collectionGroup,t.ne.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)))},qy);function qy(t,e,n){var r=this;return(r=ky.call(this)||this).type=t,r.rd=e,r.od=n,r}function By(t,e,n){var r=this;return(r=Py.call(this)||this).type=t,r.rd=e,r.od=n,r}function Gy(t,e,n){var r=this;return(r=Ry.call(this)||this).type=t,r.nd=e,r.sd=n,r}function zy(t,e){var n=this;return(n=Ly.call(this)||this).Xf=t,n.ed=e,n.type="orderBy",n}function Hy(t,e,n){var r=this;return(r=Cy.call(this)||this).Xf=t,r.Zf=e,r.td=n,r.type="where",r}function Ky(t,c,e,n){if(e[0]instanceof Gr&&(e[0]=e[0]._),e[0]instanceof _y)return function(t,e,n,r){if(!n)throw new qr(Fr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+c+"().");for(var i=[],o=0,s=ys(t);o<s.length;o++){var u=s[o];if(u.field.Ot())i.push(so(e,n.key));else{var a=n.field(u.field);if($i(a))throw new qr(Fr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===a){u=u.field.Ct();throw new qr(Fr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}i.push(a)}}return new $o(i,r)}(t.C_,t.firestore.zr,e[0].Jf,n);var r=bd(t.firestore);return function(t,e,n,r,i,o){var s=t.ne;if(i.length>s.length)throw new qr(Fr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var u=[],a=0;a<i.length;a++){var c=i[a];if(s[a].field.Ot()){if("string"!=typeof c)throw new qr(Fr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!ds(t)&&-1!==c.indexOf("/"))throw new qr(Fr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(xi.xt(c));if(!Ri.qt(h))throw new qr(Fr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");h=new Ri(h);u.push(so(e,h))}else{c=Fd(n,r,c);u.push(c)}}return new $o(u,o)}(t.C_,t.firestore.zr,r,c,e,n)}function Wy(t,e,n){if(n instanceof Gr&&(n=n._),"string"==typeof n){if(""===n)throw new qr(Fr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!ds(e)&&-1!==n.indexOf("/"))throw new qr(Fr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");e=e.path.child(xi.xt(n));if(!Ri.qt(e))throw new qr(Fr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return so(t,new Ri(e))}if(n instanceof Yp)return so(t,n.S_);throw new qr(Fr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Pc(n)+".")}function Qy(t,e){if(!Array.isArray(t)||0===t.length)throw new qr(Fr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new qr(Fr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function Yy(t,e,n){if(!n.isEqual(e))throw new qr(Fr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}function Jy(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Xy,$y=(h(Zy,Xy=o),Zy.prototype.Uf=function(t){return new Br(t)},Zy.prototype.Qf=function(t){t=this.Gf(t,this.firestore.zr);return new Yp(this.firestore,null,t)},Zy);function Zy(t){var e=this;return(e=Xy.call(this)||this).firestore=t,e}function tv(i){return function(){if("object"==typeof i&&null!==i)for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return 1}}()}var ev,nv,rv=(hv.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},hv),iv=(h(cv,nv=_y),cv.prototype.exists=function(){return nv.prototype.exists.call(this)},cv.prototype.data=function(t){if(void 0===t&&(t={}),this.Jf){if(this.v_){var e=new ov(this.zf,this.Hf,this.S_,this.Jf,this.metadata,null);return this.v_.fromFirestore(e,t)}return this.Hf.$f(this.Jf.Yt(),t.serverTimestamps)}},cv.prototype.get=function(t,e){if(void 0===e&&(e={}),this.Jf){t=this.Jf.data().field(Oy("DocumentSnapshot.get",t));if(null!==t)return this.Hf.$f(t,e.serverTimestamps)}},cv),ov=(h(av,ev=iv),av.prototype.data=function(t){return void 0===t&&(t={}),ev.prototype.data.call(this,t)},av),sv=(Object.defineProperty(uv.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!1,configurable:!0}),Object.defineProperty(uv.prototype,"size",{get:function(){return this.ud.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(uv.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),uv.prototype.forEach=function(e,n){var r=this;this.ud.docs.forEach(function(t){e.call(n,new ov(r.zf,r.Hf,t.key,t,new rv(r.ud.tn.has(t.key),r.ud.fromCache),r.query.v_))})},uv.prototype.docChanges=function(t){void 0===t&&(t={});t=!!t.includeMetadataChanges;if(t&&this.ud.nn)throw new qr(Fr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.hd&&this.ld===t||(this.hd=function(i,e){if(i.ud.Ze.bt()){var n=0;return i.ud.docChanges.map(function(t){var e=new ov(i.zf,i.Hf,t.doc.key,t.doc,new rv(i.ud.tn.has(t.doc.key),i.ud.fromCache),i.query.v_);return t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:n++}})}var o=i.ud.Ze;return i.ud.docChanges.filter(function(t){return e||3!==t.type}).map(function(t){var e=new ov(i.zf,i.Hf,t.doc.key,t.doc,new rv(i.ud.tn.has(t.doc.key),i.ud.fromCache),i.query.v_),n=-1,r=-1;return 0!==t.type&&(n=o.indexOf(t.doc.key),o=o.delete(t.doc.key)),1!==t.type&&(r=(o=o.add(t.doc)).indexOf(t.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return xr()}}(t.type),doc:e,oldIndex:n,newIndex:r}})}(this,t),this.ld=t),this.hd},uv);function uv(t,e,n,r){this.zf=t,this.Hf=e,this.ud=r,this.metadata=new rv(r.hasPendingWrites,r.fromCache),this.query=n}function av(){return null!==ev&&ev.apply(this,arguments)||this}function cv(t,e,n,r,i,o){var s=this;return(s=nv.call(this,t,e,n,r,o)||this).zf=t,s.ad=t,s.metadata=i,s}function hv(t,e){this.hasPendingWrites=t,this.fromCache=e}function fv(t,e){return t instanceof iv&&e instanceof iv?t.zf===e.zf&&t.S_.isEqual(e.S_)&&(null===t.Jf?null===e.Jf:t.Jf.isEqual(e.Jf))&&t.v_===e.v_:t instanceof sv&&e instanceof sv&&t.zf===e.zf&&ud(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t.ud.isEqual(e.ud)}var lv,pv=(h(dv,lv=o),dv.prototype.Uf=function(t){return new Br(t)},dv.prototype.Qf=function(t){t=this.Gf(t,this.firestore.zr);return new Yp(this.firestore,null,t)},dv);function dv(t){var e=this;return(e=lv.call(this)||this).firestore=t,e}function yv(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=Rc(t,Yp);var o=Rc(t.firestore,yy),s=bd(o);return e instanceof Gr&&(e=e._),gv(o,[("string"==typeof e||e instanceof Wp?jd(s,"updateDoc",t.S_,e,n,r):Md(s,"updateDoc",t.S_,e)).F_(t.S_,Ws.exists(!0))])}function vv(e){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];e instanceof Gr&&(e=e._);var r={includeMetadataChanges:!1},i=0;"object"!=typeof n[i]||tv(n[i])||(r=n[i],i++);var o,s,u,a,c,h,f={includeMetadataChanges:r.includeMetadataChanges};return tv(n[i])&&(o=n[i],n[i]=null===(r=o.next)||void 0===r?void 0:r.bind(o),n[i+1]=null===(r=o.error)||void 0===r?void 0:r.bind(o),n[i+2]=null===(r=o.complete)||void 0===r?void 0:r.bind(o)),e instanceof Yp?(u=Rc(e.firestore,yy),a=cs(e.S_.path),h={next:function(t){n[i]&&n[i](mv(u,e,t))},error:n[i+1],complete:n[i+2]}):(s=Rc(e,Jp),u=Rc(s.firestore,yy),a=s.C_,c=new pv(u),h={next:function(t){n[i]&&n[i](new sv(u,c,s,t))},error:n[i+1],complete:n[i+2]},Dy(e.C_)),function(n,t,e){var r=this,i=new Hp(h),o=new Yl(t,i,e);return n.ks.Ws(function(){return y(r,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=Kl,[4,hy(n)];case 1:return[2,e.apply(void 0,[t.sent(),o])]}})})}),function(){i.I_(),n.ks.Ws(function(){return y(r,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=Wl,[4,hy(n)];case 1:return[2,e.apply(void 0,[t.sent(),o])]}})})})}}(my(u),a,f)}function gv(t,e){return function(n,r){var t=this,i=new Ni;return n.ks.Ws(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=pp,[4,cy(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(my(t),e)}function mv(t,e,n){var r=n.docs.get(e.S_),i=new pv(t);return new iv(t,i,e.S_,r,new rv(n.hasPendingWrites,n.fromCache),e.v_)}var wv=(bv.prototype.set=function(t,e,n){this.Ed();t=Iv(t,this.zf),e=Jy(t.v_,e,n),n=Id(this.wd,"WriteBatch.set",t.S_,e,null!==t.v_,n);return this.fd.push(n.F_(t.S_,Ws.de())),this},bv.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this.Ed();t=Iv(t,this.zf);return e instanceof Gr&&(e=e._),e="string"==typeof e||e instanceof Wp?jd(this.wd,"WriteBatch.update",t.S_,e,n,r):Md(this.wd,"WriteBatch.update",t.S_,e),this.fd.push(e.F_(t.S_,Ws.exists(!0))),this},bv.prototype.delete=function(t){this.Ed();t=Iv(t,this.zf);return this.fd=this.fd.concat(new lu(t.S_,Ws.de())),this},bv.prototype.commit=function(){return this.Ed(),this.dd=!0,0<this.fd.length?this._d(this.fd):Promise.resolve()},bv.prototype.Ed=function(){if(this.dd)throw new qr(Fr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},bv);function bv(t,e){this.zf=t,this._d=e,this.fd=[],this.dd=!1,this.wd=bd(t)}function Iv(t,e){if(t instanceof Gr&&(t=t._),t.firestore!==e)throw new qr(Fr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var Ev,_v,Tv,Av=(Rv.prototype.get=function(t){var e=this,n=Iv(t,this.zf),r=new $y(this.zf);return this.Td.ef([n.S_]).then(function(t){if(!t||1!==t.length)return xr();t=t[0];if(t instanceof Io)return new _y(e.zf,r,n.S_,null,n.v_);if(t instanceof bo)return new _y(e.zf,r,t.key,t,n.v_);throw xr()})},Rv.prototype.set=function(t,e,n){t=Iv(t,this.zf),e=Jy(t.v_,e,n),n=Id(this.wd,"Transaction.set",t.S_,e,null!==t.v_,n);return this.Td.set(t.S_,n),this},Rv.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=Iv(t,this.zf);return e instanceof Gr&&(e=e._),e="string"==typeof e||e instanceof Wp?jd(this.wd,"Transaction.update",t.S_,e,n,r):Md(this.wd,"Transaction.update",t.S_,e),this.Td.update(t.S_,e),this},Rv.prototype.delete=function(t){t=Iv(t,this.zf);return this.Td.delete(t.S_),this},h(Pv,Tv=Rv),Pv.prototype.get=function(t){var e=this,n=Iv(t,this.zf),r=new pv(this.zf);return Tv.prototype.get.call(this,t).then(function(t){return new iv(e.zf,r,n.S_,t.Jf,new rv(!1,!1),n.v_)})},Pv),Nv=(kv.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){Iy(t=Rc(t,yy));var n=my(t),r=t.so(),t=new Mp;return by(n,t,new Up(t,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._,{forceOwnership:e})},kv.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){Iy(t=Rc(t,yy));var e=my(t),n=t.so(),t=new Mp;return by(e,t,new Vp(t,n.cacheSizeBytes))}(t._)},kv.prototype.clearIndexedDbPersistence=function(t){return function(n){var t=this;if(n.Yr&&!n.Xr)throw new qr(Fr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var r=new Ni;return n.Mf.Tf(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return Da.G()?(e=n+"main",[4,Da.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})}(df(n.zr,n.Wr))];case 1:return t.sent(),r.resolve(),[3,3];case 2:return e=t.sent(),r.reject(e),[3,3];case 3:return[2]}})})}),r.promise}(t._)},kv),Sv=(h(xv,_v=Gr),Object.defineProperty(xv.prototype,"zr",{get:function(){return this._.zr},enumerable:!1,configurable:!0}),xv.prototype.settings=function(t){t.merge&&delete(t=Object.assign(Object.assign({},this._.no()),t)).merge,this._.eo(t)},xv.prototype.useEmulator=function(t,e){"firestore.googleapis.com"!==this._.no().host&&Or("Host has been set in both settings() and useEmulator(), emulator host will be used"),this.settings({host:t+":"+e,ssl:!1,merge:!0})},xv.prototype.enableNetwork=function(){return function(r){var t=this;return r.ks.enqueue(function(){return y(t,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,sy(r)];case 1:return e=t.sent(),[4,ay(r)];case 2:return n=t.sent(),[2,(e.Zc(!0),(t=n).Gh.delete(0),Al(t))]}})})})}(my(Rc(this._,yy)))},xv.prototype.disableNetwork=function(){return function(r){var t=this;return r.ks.enqueue(function(){return y(t,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,sy(r)];case 1:return e=t.sent(),[4,ay(r)];case 2:return n=t.sent(),[2,(e.Zc(!1),function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return(e=n).Gh.add(0),[4,Nl(e)];case 1:return t.sent(),e.Jh.set("Offline"),[2]}})})}(n))]}})})})}(my(Rc(this._,yy)))},xv.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&Dc("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Id.enableMultiTabIndexedDbPersistence(this):this.Id.enableIndexedDbPersistence(this,n)},xv.prototype.clearPersistence=function(){return this.Id.clearIndexedDbPersistence(this)},xv.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.app._removeServiceInstance("firestore-exp"),this._._delete()},xv.prototype.waitForPendingWrites=function(){return function(n){var t=this,r=new Ni;return n.ks.Ws(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=gp,[4,cy(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})}),r.promise}(my(Rc(this._,yy)))},xv.prototype.onSnapshotsInSync=function(t){return e=this._,t=t,function(n,t){var e=this,r=new Hp(t);return n.ks.Ws(function(){return y(e,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(t,e){t.rl.add(e),e.next()},[4,hy(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})}),function(){r.I_(),n.ks.Ws(function(){return y(e,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(t,e){t.rl.delete(e)},[4,hy(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})})}}(my(Rc(e,yy)),tv(t)?t:{next:t});var e},Object.defineProperty(xv.prototype,"app",{get:function(){if(!this.md)throw new qr(Fr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.md},enumerable:!1,configurable:!0}),xv.prototype.collection=function(t){try{return new rg(this,id(this._,t))}catch(t){throw Gv(t,"collection()","Firestore.collection()")}},xv.prototype.doc=function(t){try{return new jv(this,od(this._,t))}catch(t){throw Gv(t,"doc()","Firestore.doc()")}},xv.prototype.collectionGroup=function(t){try{return new tg(this,function(t,e){if(t=Rc(t,Vc),Sc("collectionGroup","collection id",e),0<=e.indexOf("/"))throw new qr(Fr.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new Jp(t,null,(e=e,new us(xi.Nt(),e)))}(this._,t))}catch(t){throw Gv(t,"collectionGroup()","Firestore.collectionGroup()")}},xv.prototype.runTransaction=function(e){var n,r=this;return function(n,r){var t=this,i=new Ni;return n.ks.Ws(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return[4,oy(n).then(function(t){return t.Qh})];case 1:return e=t.sent(),new Xd(n.ks,e,r,i).run(),[2]}})})}),i.promise}(my(n=this._),function(t){return t=new Av(n,t),e(new Vv(r,t))})},xv.prototype.batch=function(){var e=this;return my(this._),new Mv(new wv(this._,function(t){return gv(e._,t)}))},xv.prototype.loadBundle=function(t){throw new qr(Fr.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},xv.prototype.namedQuery=function(t){throw new qr(Fr.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},xv),Ov=(h(Dv,Ev=o),Dv.prototype.Uf=function(t){return new Yr(new Br(t))},Dv.prototype.Qf=function(t){t=this.Gf(t,this.firestore.zr);return jv.Ad(t,this.firestore,null)},Dv);function Dv(t){var e=this;return(e=Ev.call(this)||this).firestore=t,e}function xv(t,e,n){var r=this;return(r=_v.call(this,e)||this).Id=n,r.INTERNAL={delete:function(){return r.terminate()}},t instanceof oi||(r.md=t),r}function kv(){}function Pv(t,e){var n=this;return(n=Tv.call(this,t,e)||this).zf=t,n}function Rv(t,e){this.zf=t,this.Td=e,this.wd=bd(t)}var Lv,Cv,Uv,Vv=(h(Bv,Uv=Gr),Bv.prototype.get=function(t){var e=this,t=hg(t);return this._.get(t).then(function(t){return new $v(e.zf,t)})},Bv.prototype.set=function(t,e,n){t=hg(t);return n?(Oc("Transaction.set",n),this._.set(t,e,n)):this._.set(t,e),this},Bv.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=hg(t);return 2===arguments.length?this._.update(o,e):(t=this._).update.apply(t,f([o,e,n],r)),this},Bv.prototype.delete=function(t){t=hg(t);return this._.delete(t),this},Bv),Mv=(h(qv,Cv=Gr),qv.prototype.set=function(t,e,n){t=hg(t);return n?(Oc("WriteBatch.set",n),this._.set(t,e,n)):this._.set(t,e),this},qv.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=hg(t);return 2===arguments.length?this._.update(o,e):(t=this._).update.apply(t,f([o,e,n],r)),this},qv.prototype.delete=function(t){t=hg(t);return this._.delete(t),this},qv.prototype.commit=function(){return this._.commit()},qv),jv=(h(Fv,Lv=Gr),Fv.Rd=function(t,e,n){if(t.length%2!=0)throw new qr(Fr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.Ct()+" has "+t.length);return new Fv(e,new Yp(e._,n,new Ri(t)))},Fv.Ad=function(t,e,n){return new Fv(e,new Yp(e._,n,t))},Object.defineProperty(Fv.prototype,"id",{get:function(){return this._.id},enumerable:!1,configurable:!0}),Object.defineProperty(Fv.prototype,"parent",{get:function(){return new rg(this.firestore,this._.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(Fv.prototype,"path",{get:function(){return this._.path},enumerable:!1,configurable:!0}),Fv.prototype.collection=function(t){try{return new rg(this.firestore,id(this._,t))}catch(t){throw Gv(t,"collection()","DocumentReference.collection()")}},Fv.prototype.isEqual=function(t){return t instanceof Gr&&(t=t._),t instanceof Yp&&sd(this._,t)},Fv.prototype.set=function(t,e){e=Oc("DocumentReference.set",e);try{return function(t,e,n){t=Rc(t,Yp);var r=Rc(t.firestore,yy),e=Jy(t.v_,e,n);return gv(r,[Id(bd(r),"setDoc",t.S_,e,null!==t.v_,n).F_(t.S_,Ws.de())])}(this._,t,e)}catch(t){throw Gv(t,"setDoc()","DocumentReference.set()")}},Fv.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?yv(this._,t):yv.apply(void 0,f([this._,t,e],n))}catch(t){throw Gv(t,"updateDoc()","DocumentReference.update()")}},Fv.prototype.delete=function(){return gv(Rc((t=this._).firestore,yy),[new lu(t.S_,Ws.de())]);var t},Fv.prototype.onSnapshot=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=zv(t),i=Hv(t,function(t){return new $v(e.firestore,new iv(e.firestore._,e.Hf,t.S_,t.Jf,t.metadata,e._.v_))});return vv(this._,r,i)},Fv.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(e){e=Rc(e,Yp);var n=Rc(e.firestore,yy),t=my(n),r=new pv(n);return function(n,r){var t=this,i=new Ni;return n.ks.Ws(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(o,s,u){return y(this,void 0,void 0,function(){var r,i;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,(e=s,(n=o).persistence.runTransaction("read document","readonly",function(t){return n.Ka.Pa(t,e)}))];case 1:return(i=t.sent())instanceof bo?u.resolve(i):i instanceof Io?u.resolve(null):u.reject(new qr(Fr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=t.sent(),i=Ha(r,"Failed to get document '"+s+" from cache"),u.reject(i),[3,3];case 3:return[2]}var e,n})})},[4,uy(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(t,e.S_).then(function(t){return new iv(n,r,e.S_,t,new rv(t instanceof bo&&t.Jt,!0),e.v_)})}:"server"===(null==t?void 0:t.source)?function(e){e=Rc(e,Yp);var n=Rc(e.firestore,yy);return fy(my(n),e.S_,{source:"server"}).then(function(t){return mv(n,e,t)})}:function(e){e=Rc(e,Yp);var n=Rc(e.firestore,yy);return fy(my(n),e.S_).then(function(t){return mv(n,e,t)})})(this._).then(function(t){return new $v(e.firestore,new iv(e.firestore._,e.Hf,t.S_,t.Jf,t.metadata,e._.v_))})},Fv.prototype.withConverter=function(t){return new Fv(this.firestore,this._.withConverter(t))},Fv);function Fv(t,e){var n=this;return(n=Lv.call(this,e)||this).firestore=t,n.Hf=new Ov(t),n}function qv(){return null!==Cv&&Cv.apply(this,arguments)||this}function Bv(t,e){var n=this;return(n=Uv.call(this,e)||this).zf=t,n}function Gv(t,e,n){return t.message=t.message.replace(e,n),t}function zv(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!tv(r))return r}return{}}function Hv(t,e){var n;return{next:function(t){n.next&&n.next(e(t))},error:null===(t=(n=tv(t[0])?t[0]:tv(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===t?void 0:t.bind(n),complete:null===(t=n.complete)||void 0===t?void 0:t.bind(n)}}var Kv,Wv,Qv,Yv,Jv,Xv,$v=(h(cg,Xv=Gr),Object.defineProperty(cg.prototype,"ref",{get:function(){return new jv(this.zf,this._.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(cg.prototype,"id",{get:function(){return this._.id},enumerable:!1,configurable:!0}),Object.defineProperty(cg.prototype,"metadata",{get:function(){return this._.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(cg.prototype,"exists",{get:function(){return this._.exists()},enumerable:!1,configurable:!0}),cg.prototype.data=function(t){return this._.data(t)},cg.prototype.get=function(t,e){return this._.get(t,e)},cg.prototype.isEqual=function(t){return fv(this._,t._)},cg),Zv=(h(ag,Jv=$v),ag.prototype.data=function(t){return this._.data(t)},ag),tg=(h(ug,Yv=Gr),ug.prototype.where=function(t,e,n){try{return new ug(this.firestore,xy(this._,(r=n,i=e,o=Oy("where",t),new Uy(o,i,r))))}catch(t){throw Gv(t,/(orderBy|where)\(\)/,"Query.$1()")}var r,i,o},ug.prototype.orderBy=function(n,t){try{return new ug(this.firestore,xy(this._,function(t){void 0===t&&(t="asc");var e=t,t=Oy("orderBy",n);return new Vy(t,e)}(t)))}catch(n){throw Gv(n,/(orderBy|where)\(\)/,"Query.$1()")}},ug.prototype.limit=function(t){try{return new ug(this.firestore,xy(this._,(Lc("limit",e=t),new My("limit",e,"F"))))}catch(t){throw Gv(t,"limit()","Query.limit()")}var e},ug.prototype.limitToLast=function(t){try{return new ug(this.firestore,xy(this._,(Lc("limitToLast",e=t),new My("limitToLast",e,"L"))))}catch(t){throw Gv(t,"limitToLast()","Query.limitToLast()")}var e},ug.prototype.startAt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new ug(this.firestore,xy(this._,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new jy("startAt",t,!0)}.apply(void 0,t)))}catch(t){throw Gv(t,"startAt()","Query.startAt()")}},ug.prototype.startAfter=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new ug(this.firestore,xy(this._,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new jy("startAfter",t,!1)}.apply(void 0,t)))}catch(t){throw Gv(t,"startAfter()","Query.startAfter()")}},ug.prototype.endBefore=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new ug(this.firestore,xy(this._,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Fy("endBefore",t,!0)}.apply(void 0,t)))}catch(t){throw Gv(t,"endBefore()","Query.endBefore()")}},ug.prototype.endAt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new ug(this.firestore,xy(this._,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Fy("endAt",t,!1)}.apply(void 0,t)))}catch(t){throw Gv(t,"endAt()","Query.endAt()")}},ug.prototype.isEqual=function(t){return ud(this._,t._)},ug.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(e){e=Rc(e,Jp);var n=Rc(e.firestore,yy),t=my(n),r=new pv(n);return function(n,r){var t=this,i=new Ni;return n.ks.Ws(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(i,o,s){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,kf(i,o,!0)];case 1:return r=t.sent(),e=new sp(o,r.za),n=e.bl(r.documents),n=e.yr(n,!1),s.resolve(n.snapshot),[3,3];case 2:return n=t.sent(),r=Ha(n,"Failed to execute query '"+o+" against cache"),s.reject(r),[3,3];case 3:return[2]}})})},[4,uy(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(t,e.C_).then(function(t){return new sv(n,r,e,t)})}:"server"===(null==t?void 0:t.source)?function(e){e=Rc(e,Jp);var n=Rc(e.firestore,yy),t=my(n),r=new pv(n);return ly(t,e.C_,{source:"server"}).then(function(t){return new sv(n,r,e,t)})}:function(e){e=Rc(e,Jp);var n=Rc(e.firestore,yy),t=my(n),r=new pv(n);return Dy(e.C_),ly(t,e.C_).then(function(t){return new sv(n,r,e,t)})})(this._).then(function(t){return new ng(e.firestore,new sv(e.firestore._,e.Hf,e._,t.ud))})},ug.prototype.onSnapshot=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=zv(t),i=Hv(t,function(t){return new ng(e.firestore,new sv(e.firestore._,e.Hf,e._,t.ud))});return vv(this._,r,i)},ug.prototype.withConverter=function(t){return new ug(this.firestore,this._.withConverter(t))},ug),eg=(h(sg,Qv=Gr),Object.defineProperty(sg.prototype,"type",{get:function(){return this._.type},enumerable:!1,configurable:!0}),Object.defineProperty(sg.prototype,"doc",{get:function(){return new Zv(this.zf,this._.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(sg.prototype,"oldIndex",{get:function(){return this._.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(sg.prototype,"newIndex",{get:function(){return this._.newIndex},enumerable:!1,configurable:!0}),sg),ng=(h(og,Wv=Gr),Object.defineProperty(og.prototype,"query",{get:function(){return new tg(this.zf,this._.query)},enumerable:!1,configurable:!0}),Object.defineProperty(og.prototype,"metadata",{get:function(){return this._.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(og.prototype,"size",{get:function(){return this._.size},enumerable:!1,configurable:!0}),Object.defineProperty(og.prototype,"empty",{get:function(){return this._.empty},enumerable:!1,configurable:!0}),Object.defineProperty(og.prototype,"docs",{get:function(){var e=this;return this._.docs.map(function(t){return new Zv(e.zf,t)})},enumerable:!1,configurable:!0}),og.prototype.docChanges=function(t){var e=this;return this._.docChanges(t).map(function(t){return new eg(e.zf,t)})},og.prototype.forEach=function(e,n){var r=this;this._.forEach(function(t){e.call(n,new Zv(r.zf,t))})},og.prototype.isEqual=function(t){return fv(this._,t._)},og),rg=(h(ig,Kv=tg),Object.defineProperty(ig.prototype,"id",{get:function(){return this._.id},enumerable:!1,configurable:!0}),Object.defineProperty(ig.prototype,"path",{get:function(){return this._.path},enumerable:!1,configurable:!0}),Object.defineProperty(ig.prototype,"parent",{get:function(){var t=this._.parent;return t?new jv(this.firestore,t):null},enumerable:!1,configurable:!0}),ig.prototype.doc=function(t){try{return new jv(this.firestore,void 0===t?od(this._):od(this._,t))}catch(t){throw Gv(t,"doc()","CollectionReference.doc()")}},ig.prototype.add=function(t){var e,n,r,i=this;return e=this._,n=t,t=Rc(e.firestore,yy),r=od(e),n=Jy(e.v_,n),gv(t,[Id(bd(e.firestore),"addDoc",r.S_,n,null!==e.v_,{}).F_(r.S_,Ws.exists(!1))]).then(function(){return r}).then(function(t){return new jv(i.firestore,t)})},ig.prototype.isEqual=function(t){return sd(this._,t._)},ig.prototype.withConverter=function(t){return new ig(this.firestore,this._.withConverter(t))},ig);function ig(t,e){var n=this;return(n=Kv.call(this,t,e)||this).firestore=t,n._=e,n}function og(t,e){var n=this;return(n=Wv.call(this,e)||this).zf=t,n}function sg(t,e){var n=this;return(n=Qv.call(this,e)||this).zf=t,n}function ug(t,e){var n=this;return(n=Yv.call(this,e)||this).firestore=t,n.Hf=new Ov(t),n}function ag(){return null!==Jv&&Jv.apply(this,arguments)||this}function cg(t,e){var n=this;return(n=Xv.call(this,e)||this).zf=t,n}function hg(t){return t instanceof Gr&&(t=t._),Rc(t,Yp)}var fg,lg,_e=(h(vg,lg=Gr),vg.documentId=function(){return new vg(Pi.kt().Ct())},vg.prototype.isEqual=function(t){return t instanceof Gr&&(t=t._),t instanceof Wp&&this._.b_.isEqual(t.b_)},vg),o=(h(yg,fg=Gr),yg.serverTimestamp=function(){var t=new xd("serverTimestamp");return t._methodName="FieldValue.serverTimestamp",new yg(t)},yg.delete=function(){var t=new _d("deleteField");return t._methodName="FieldValue.delete",new yg(t)},yg.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new kd("arrayUnion",t)}.apply(void 0,t);return n._methodName="FieldValue.arrayUnion",new yg(n)},yg.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Pd("arrayRemove",t)}.apply(void 0,t);return n._methodName="FieldValue.arrayRemove",new yg(n)},yg.increment=function(t){t=new Rd("increment",t);return t._methodName="FieldValue.increment",new yg(t)},yg.prototype.isEqual=function(t){return this._.isEqual(t._)},yg),pg=(dg.prototype.onProgress=function(t,e,n){this.Pd={next:t,error:e,complete:n}},dg.prototype.catch=function(t){return this.yd.promise.catch(t)},dg.prototype.then=function(t,e){return this.yd.promise.then(t,e)},dg.prototype.e_=function(t){this.n_(t),this.Pd.complete&&this.Pd.complete(),this.yd.resolve(t)},dg.prototype.i_=function(t){this.gd.taskState="Error",this.Pd.next&&this.Pd.next(this.gd),this.Pd.error&&this.Pd.error(t),this.yd.reject(t)},dg.prototype.n_=function(t){this.gd=t,this.Pd.next&&this.Pd.next(t)},dg);function dg(){this.Pd={},this.yd=new Ni,this.gd={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}function yg(){return null!==fg&&fg.apply(this,arguments)||this}function vg(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return lg.call(this,new(Wp.bind.apply(Wp,f([void 0],t))))||this}function gg(t,s){var e=new pg;return function(n,t,r){var e,i=this,o=(e=s,t=Aa(t),e=function(t){if(t instanceof Uint8Array)return Gp(t,void 0);if(t instanceof ArrayBuffer)return Gp(new Uint8Array(t),void 0);if(t instanceof ReadableStream)return t.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof e?(new TextEncoder).encode(e):e),new Kp(e,t));n.ks.Ws(function(){return y(i,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=Pp,[4,cy(n)];case 1:return e.apply(void 0,[t.sent(),o,r]),[2]}})})})}(my(t._),t.zr,e),e}var mg=(wg.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},wg.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},wg.prototype.setServiceProps=function(t){return this.serviceProps=t,this},wg);function wg(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var bg,Ig,Eg={Firestore:Sv,GeoPoint:ad,Timestamp:Oi,Blob:Yr,Transaction:Vv,WriteBatch:Mv,DocumentReference:jv,DocumentSnapshot:$v,Query:tg,QueryDocumentSnapshot:Zv,QuerySnapshot:ng,CollectionReference:rg,FieldPath:_e,FieldValue:o,setLogLevel:function(t){Tr.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};(bg=e.default).INTERNAL.registerComponent(new mg("firestore",function(t){var e=t.getProvider("app").getImmediate();return e=e,t=t.getProvider("auth-internal"),new Sv(e,new yy(e,t),new Nv)},"PUBLIC").setServiceProps(Object.assign({},Eg))),bg.registerVersion("@firebase/firestore","2.1.0"),(Ig=Sv).prototype.loadBundle=function(t){return gg(this,t)},Ig.prototype.namedQuery=function(t){return t=t,function(n,r){var t=this;return n.ks.enqueue(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(t,e){var n=t;return n.persistence.runTransaction("Get named query","readonly",function(t){return n.Wc.ho(t,e)})},[4,uy(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})})}(my((e=this)._),t).then(function(t){return t?new tg(e,new Jp(e._,null,t.query)):null});var e}}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});
//# sourceMappingURL=firebase-firestore.js.map
